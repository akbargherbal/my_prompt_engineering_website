<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOCUMENT_02</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6; 
            color: #333; 
            background: #fff;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: #2c3e50; 
            color: white; 
            padding: 1rem 0; 
            position: sticky; 
            top: 0; 
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: #e74c3c; 
            color: white; 
            padding: 12px 16px; 
            border-radius: 50px; 
            text-decoration: none; 
            font-weight: bold; 
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .home-btn:hover { background: #c0392b; transform: translateY(-2px); }
        .breadcrumb { 
            background: #ecf0f1; 
            padding: 10px 0; 
            margin-bottom: 20px; 
            font-size: 14px;
        }
        .breadcrumb a { color: #3498db; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { font-weight: bold; color: #333; }
        .content { 
            background: white; 
            padding: 2rem; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1rem; 
            margin: 2rem 0; 
        }
        .file-item { 
            padding: 1rem; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #f8f9fa;
            transition: all 0.3s;
        }
        .file-item:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        }
        .file-item a { 
            color: #2c3e50; 
            text-decoration: none; 
            font-weight: 500; 
            display: block;
        }
        .file-item a:hover { color: #3498db; }
        .file-type { 
            font-size: 12px; 
            color: #7f8c8d; 
            margin-top: 5px; 
        }
        .tree { font-family: monospace; white-space: pre-line; background: #f8f9fa; padding: 1rem; border-radius: 8px; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 1rem; border-radius: 8px; overflow-x: auto; }
        code { background: #ecf0f1; padding: 2px 4px; border-radius: 4px; font-size: 0.9em; }
        pre code { background: none; padding: 0; }
        h1, h2, h3, h4, h5, h6 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h1 { border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        a { color: #3498db; }
        a:hover { color: #2980b9; }
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: #7f8c8d; 
            border-top: 1px solid #ecf0f1; 
            margin-top: 3rem; 
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>DOCUMENT_02</h1>
        </div>
    </div>
    <a href="../../../../../../../../index.html" class="home-btn">üè† Home</a>
    <div class="container">
        <div class="breadcrumb">
            <a href="../../../../../../../../index.html">Home</a> / <a href="../../../../../../../../FRAMEWORK_ARCHITECTURE/index.html">FRAMEWORK_ARCHITECTURE</a> / <a href="../../../../../../../../FRAMEWORK_ARCHITECTURE/FRAMEWORKS/index.html">FRAMEWORKS</a> / <a href="../../../../../../../../FRAMEWORK_ARCHITECTURE/FRAMEWORKS/PDP_FRAMEWORK/index.html">PDP_FRAMEWORK</a> / <a href="../../../../../../../../FRAMEWORK_ARCHITECTURE/FRAMEWORKS/PDP_FRAMEWORK/REWRITE_PDP/index.html">REWRITE_PDP</a> / <a href="../../../../../../../../FRAMEWORK_ARCHITECTURE/FRAMEWORKS/PDP_FRAMEWORK/REWRITE_PDP/REWRITE/index.html">REWRITE</a> / <a href="../../../../../../../../FRAMEWORK_ARCHITECTURE/FRAMEWORKS/PDP_FRAMEWORK/REWRITE_PDP/REWRITE/PROJECT/index.html">PROJECT</a> / <a href="../../../../../../../../FRAMEWORK_ARCHITECTURE/FRAMEWORKS/PDP_FRAMEWORK/REWRITE_PDP/REWRITE/PROJECT/01_PLANNING/index.html">01_PLANNING</a> / <a href="../../../../../../../../FRAMEWORK_ARCHITECTURE/FRAMEWORKS/PDP_FRAMEWORK/REWRITE_PDP/REWRITE/PROJECT/01_PLANNING/OUTPUT/index.html">OUTPUT</a>
        </div>
        <div class="content">
            <h1 id="technical-foundation-specification-gemini-cli-vs-code-bridge">Technical Foundation Specification: Gemini CLI VS Code Bridge</h1>
<h2 id="technology-stack-decisions">Technology Stack Decisions</h2>
<h3 id="backend-architecture">Backend Architecture</h3>
<ul>
<li><strong>Framework</strong>: Python 3.8+ (standard library focused)</li>
<li><strong>Runtime</strong>: Python 3.8+ (updated for enhanced threading and subprocess support)</li>
<li><strong>Key Dependencies</strong>:</li>
<li><code>watchdog</code>: File system monitoring with cross-platform event handling</li>
<li><code>subprocess</code>: Child process management for Gemini CLI integration</li>
<li><code>threading</code>: Two-thread coordination model for concurrent I/O operations</li>
<li><code>queue</code>: Thread-safe communication between main and output reader threads</li>
<li><code>pathlib</code>: Cross-platform file path handling</li>
<li><strong>Development Tools</strong>: pytest framework, pylint for code quality, black for formatting</li>
</ul>
<h3 id="process-architecture">Process Architecture</h3>
<ul>
<li><strong>Process Management</strong>: Single persistent Gemini CLI subprocess with captured stdin/stdout streams</li>
<li><strong>Threading Model</strong>: Two-thread sequential processing (main thread + dedicated output reader)</li>
<li><strong>Communication Strategy</strong>: Bounded queue (maxsize=100) with threading.Event for shutdown coordination</li>
<li><strong>Error Recovery</strong>: Automatic subprocess restart on failure with graceful degradation modes</li>
</ul>
<h3 id="file-system-integration">File System Integration</h3>
<ul>
<li><strong>File Monitoring</strong>: Debounced watchdog observers (200ms delay) to prevent rapid-fire processing</li>
<li><strong>I/O Strategy</strong>: Append-only response logging with UTF-8 encoding support</li>
<li><strong>File Handling</strong>: Atomic read operations for prompt.md, buffered writes to response.md</li>
<li><strong>Cross-Platform</strong>: Path normalization and encoding handling across Windows, macOS, Linux</li>
</ul>
<h2 id="api-contract-specifications">API Contract Specifications</h2>
<h3 id="process-management-interface">Process Management Interface</h3>
<h4 id="subprocess-initialization">Subprocess Initialization</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Gemini CLI process configuration</span>
<span class="n">process_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;gemini&quot;</span><span class="p">],</span>
    <span class="s2">&quot;stdin&quot;</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="s2">&quot;stdout&quot;</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="s2">&quot;stderr&quot;</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;bufsize&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># Line buffering for real-time response</span>
    <span class="s2">&quot;universal_newlines&quot;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">}</span>

<span class="c1"># Platform-specific timeout and retry settings</span>
<span class="n">SUBPROCESS_TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># seconds</span>
<span class="n">MAX_RESTART_ATTEMPTS</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">RESTART_DELAY</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># seconds between restart attempts</span>
</code></pre></div>

<h4 id="thread-communication-protocol">Thread Communication Protocol</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Output queue message format</span>
<span class="n">OutputMessage</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;response&quot;</span> <span class="o">|</span> <span class="s2">&quot;error&quot;</span> <span class="o">|</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span>
    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;stdout&quot;</span> <span class="o">|</span> <span class="s2">&quot;stderr&quot;</span>
<span class="p">}</span>

<span class="c1"># Shutdown coordination</span>
<span class="n">shutdown_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
<span class="n">output_queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div>

<h3 id="file-system-event-handling">File System Event Handling</h3>
<h4 id="file-watcher-configuration">File Watcher Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Watchdog event handler specification</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PromptHandler</span><span class="p">(</span><span class="n">FileSystemEventHandler</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_directory</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">src_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;prompt.md&#39;</span><span class="p">):</span>
            <span class="c1"># Debounce mechanism - 200ms delay</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schedule_prompt_processing</span><span class="p">()</span>

<span class="c1"># File processing pipeline</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_prompt_file</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read entire content of prompt.md and send to Gemini CLI</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if successful, False if error occurred</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If prompt.md doesn&#39;t exist</span>
<span class="sd">        UnicodeDecodeError: If file contains invalid UTF-8</span>
<span class="sd">        ProcessLookupError: If Gemini CLI process is not running</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>

<h4 id="response-file-management">Response File Management</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">append_response</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Append Gemini CLI response to response.md</span>

<span class="sd">    Args:</span>
<span class="sd">        content: Raw output from Gemini CLI stdout</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if write successful</span>

<span class="sd">    Error Handling:</span>
<span class="sd">        - Disk space full: Log error, continue operation</span>
<span class="sd">        - File permissions: Attempt chmod, fallback to console output</span>
<span class="sd">        - Encoding errors: Use &#39;replace&#39; strategy for invalid characters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;response.md&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>  <span class="c1"># Ensure immediate write to disk</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write response: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>

<h2 id="data-model-architecture">Data Model Architecture</h2>
<h3 id="process-state-management">Process State Management</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GeminiProcess</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manages lifecycle and communication with Gemini CLI subprocess</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_running</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_activity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Gemini CLI subprocess&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">send_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send prompt to Gemini CLI stdin&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_healthy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if process is responsive&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">restart</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restart failed Gemini CLI process&quot;&quot;&quot;</span>
</code></pre></div>

<h3 id="thread-coordination-model">Thread Coordination Model</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BridgeCoordinator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coordinates file watching and subprocess communication</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gemini_process</span> <span class="o">=</span> <span class="n">GeminiProcess</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown_event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_thread</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start_bridge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize all components and start monitoring&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop_bridge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Graceful shutdown with resource cleanup&quot;&quot;&quot;</span>
</code></pre></div>

<h3 id="error-classification-system">Error Classification System</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ErrorType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RECOVERABLE_FILE_ERROR</span> <span class="o">=</span> <span class="s2">&quot;recoverable_file&quot;</span>
    <span class="n">RECOVERABLE_PROCESS_ERROR</span> <span class="o">=</span> <span class="s2">&quot;recoverable_process&quot;</span>
    <span class="n">FATAL_CONFIGURATION_ERROR</span> <span class="o">=</span> <span class="s2">&quot;fatal_config&quot;</span>
    <span class="n">NETWORK_CONNECTIVITY_ERROR</span> <span class="o">=</span> <span class="s2">&quot;network&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ErrorHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Centralized error handling with recovery strategies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">handle_error</span><span class="p">(</span><span class="n">error_type</span><span class="p">:</span> <span class="n">ErrorType</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process error and attempt recovery</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if recovery successful, False if fatal</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>

<h2 id="integration-architecture">Integration Architecture</h2>
<h3 id="cross-platform-compatibility-layer">Cross-Platform Compatibility Layer</h3>
<h4 id="platform-specific-configurations">Platform-Specific Configurations</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PlatformConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Platform-specific settings for optimal compatibility</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_platform_config</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_platform_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;windows&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;subprocess_creation_flags&#39;</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CREATE_NEW_PROCESS_GROUP</span><span class="p">,</span>
                <span class="s1">&#39;file_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8-sig&#39;</span><span class="p">,</span>  <span class="c1"># Handle BOM</span>
                <span class="s1">&#39;path_separator&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gemini_command&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gemini.exe&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">&#39;darwin&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;subprocess_creation_flags&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;file_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
                <span class="s1">&#39;path_separator&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gemini_command&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gemini&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">&#39;linux&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;subprocess_creation_flags&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;file_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
                <span class="s1">&#39;path_separator&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
                <span class="s1">&#39;gemini_command&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gemini&#39;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span> <span class="n">configs</span><span class="p">[</span><span class="s1">&#39;linux&#39;</span><span class="p">])</span>
</code></pre></div>

<h4 id="file-system-event-normalization">File System Event Normalization</h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">watchdog.observers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observer</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CrossPlatformFileWatcher</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalize file system events across platforms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="nb">callable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observer</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_platform_specific_watching</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_platform_specific_watching</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure file watching for platform-specific behaviors</span>

<span class="sd">        Windows: Handle file locking and delayed write notifications</span>
<span class="sd">        macOS: Manage FSEvents volume-level notifications  </span>
<span class="sd">        Linux: Process inotify events with proper debouncing</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>

<h3 id="configuration-management">Configuration Management</h3>
<h4 id="environment-variable-schema">Environment Variable Schema</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Core Configuration</span>
<span class="nv">GEMINI_CLI_PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin/gemini&quot;</span><span class="w">        </span><span class="c1"># Custom Gemini CLI location</span>
<span class="nv">BRIDGE_WORK_DIR</span><span class="o">=</span><span class="s2">&quot;/path/to/project&quot;</span><span class="w">             </span><span class="c1"># Working directory for files</span>
<span class="nv">BRIDGE_LOG_LEVEL</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="w">                        </span><span class="c1"># DEBUG, INFO, WARNING, ERROR</span>

<span class="c1"># File Configuration  </span>
<span class="nv">BRIDGE_PROMPT_FILE</span><span class="o">=</span><span class="s2">&quot;prompt.md&quot;</span><span class="w">                 </span><span class="c1"># Input file name</span>
<span class="nv">BRIDGE_RESPONSE_FILE</span><span class="o">=</span><span class="s2">&quot;response.md&quot;</span><span class="w">             </span><span class="c1"># Output file name</span>
<span class="nv">BRIDGE_BACKUP_RESPONSES</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="w">                 </span><span class="c1"># Enable response file backup</span>

<span class="c1"># Process Configuration</span>
<span class="nv">GEMINI_SUBPROCESS_TIMEOUT</span><span class="o">=</span><span class="s2">&quot;30&quot;</span><span class="w">                 </span><span class="c1"># Subprocess timeout in seconds</span>
<span class="nv">BRIDGE_MAX_RESTART_ATTEMPTS</span><span class="o">=</span><span class="s2">&quot;3&quot;</span><span class="w">                </span><span class="c1"># Maximum process restart attempts</span>
<span class="nv">BRIDGE_DEBOUNCE_DELAY</span><span class="o">=</span><span class="s2">&quot;200&quot;</span><span class="w">                    </span><span class="c1"># File watch debounce in milliseconds</span>

<span class="c1"># Threading Configuration</span>
<span class="nv">BRIDGE_OUTPUT_QUEUE_SIZE</span><span class="o">=</span><span class="s2">&quot;100&quot;</span><span class="w">                 </span><span class="c1"># Maximum queued output messages</span>
<span class="nv">BRIDGE_SHUTDOWN_TIMEOUT</span><span class="o">=</span><span class="s2">&quot;5&quot;</span><span class="w">                    </span><span class="c1"># Graceful shutdown timeout</span>
</code></pre></div>

<h4 id="configuration-validation">Configuration Validation</h4>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConfigValidator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate configuration and provide sensible defaults</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">REQUIRED_CONFIGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GEMINI_CLI_PATH&#39;</span><span class="p">]</span>
    <span class="n">DEFAULT_VALUES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;BRIDGE_WORK_DIR&#39;</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;BRIDGE_LOG_LEVEL&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
        <span class="s1">&#39;BRIDGE_PROMPT_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;prompt.md&#39;</span><span class="p">,</span>
        <span class="s1">&#39;BRIDGE_RESPONSE_FILE&#39;</span><span class="p">:</span> <span class="s1">&#39;response.md&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GEMINI_SUBPROCESS_TIMEOUT&#39;</span><span class="p">:</span> <span class="s1">&#39;30&#39;</span><span class="p">,</span>
        <span class="s1">&#39;BRIDGE_MAX_RESTART_ATTEMPTS&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span>
        <span class="s1">&#39;BRIDGE_DEBOUNCE_DELAY&#39;</span><span class="p">:</span> <span class="s1">&#39;200&#39;</span>
    <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_and_load</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate environment configuration and return normalized settings</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConfigurationError: If required settings missing or invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>

<h2 id="development-environment-setup">Development Environment Setup</h2>
<h3 id="local-development-requirements">Local Development Requirements</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># System Requirements</span>
Python<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span><span class="m">3</span>.8.0
OS:<span class="w"> </span>Windows<span class="w"> </span><span class="m">10</span>+,<span class="w"> </span>macOS<span class="w"> </span><span class="m">12</span>+,<span class="w"> </span>or<span class="w"> </span>Ubuntu<span class="w"> </span><span class="m">20</span>+
Memory:<span class="w"> </span>50MB<span class="w"> </span>available<span class="w"> </span>RAM
Disk:<span class="w"> </span>10MB<span class="w"> </span>free<span class="w"> </span>space<span class="w"> </span><span class="k">for</span><span class="w"> </span>logs<span class="w"> </span>and<span class="w"> </span>temporary<span class="w"> </span>files

<span class="c1"># Installation Steps</span>
<span class="m">1</span>.<span class="w"> </span>Clone<span class="w"> </span>repository:<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>&lt;repository-url&gt;
<span class="m">2</span>.<span class="w"> </span>Create<span class="w"> </span>virtual<span class="w"> </span>environment:<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="m">3</span>.<span class="w"> </span>Activate<span class="w"> </span>environment:<span class="w"> </span><span class="nb">source</span><span class="w"> </span>venv/bin/activate<span class="w"> </span><span class="o">(</span>Linux/Mac<span class="o">)</span><span class="w"> </span>or<span class="w"> </span>venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate<span class="w"> </span><span class="o">(</span>Windows<span class="o">)</span>
<span class="m">4</span>.<span class="w"> </span>Install<span class="w"> </span>dependencies:<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>watchdog
<span class="m">5</span>.<span class="w"> </span>Verify<span class="w"> </span>Gemini<span class="w"> </span>CLI:<span class="w"> </span>gemini<span class="w"> </span>--version
<span class="m">6</span>.<span class="w"> </span>Configure<span class="w"> </span>environment<span class="w"> </span>variables<span class="w"> </span><span class="o">(</span>see<span class="w"> </span>Configuration<span class="w"> </span>section<span class="o">)</span>
<span class="m">7</span>.<span class="w"> </span>Run<span class="w"> </span>bridge:<span class="w"> </span>python<span class="w"> </span>bridge.py
</code></pre></div>

<h3 id="testing-framework">Testing Framework</h3>
<ul>
<li><strong>Unit Testing</strong>: pytest framework with subprocess mocking for isolated testing</li>
<li><strong>Integration Testing</strong>: Real Gemini CLI process testing with temporary file fixtures</li>
<li><strong>Cross-Platform Testing</strong>: Automated testing across Windows, macOS, and Linux environments</li>
<li><strong>Stress Testing</strong>: 1000+ rapid file changes without deadlocks or memory leaks</li>
<li><strong>Error Scenario Testing</strong>: Process crashes, file permission failures, network interruptions</li>
</ul>
<h3 id="test-data-management">Test Data Management</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="c1"># Test fixtures for integration testing</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sample_prompts</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide sample prompts for testing&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Explain quantum computing in simple terms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Write a Python function to reverse a string&quot;</span>
    <span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">expected_response_patterns</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expected response patterns for validation&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="sa">r</span><span class="s2">&quot;Paris is the capital&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;quantum.*superposition&quot;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;def.*reverse.*string&quot;</span>
    <span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">[</span>
    <span class="s2">&quot;invalid_gemini_path&quot;</span><span class="p">,</span>
    <span class="s2">&quot;readonly_response_file&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;missing_prompt_file&quot;</span><span class="p">,</span>
    <span class="s2">&quot;process_sudden_termination&quot;</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">error_scenarios</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parametrized fixture for error scenario testing&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>
</code></pre></div>

<h3 id="performance-monitoring">Performance Monitoring</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PerformanceMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Track bridge performance and resource usage</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_usage</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log_prompt_processed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processing_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record prompt processing metrics&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_performance_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return comprehensive performance statistics&quot;&quot;&quot;</span>
</code></pre></div>

<h2 id="implementation-validation-checklist">Implementation Validation Checklist</h2>
<h3 id="pre-development-validation">Pre-Development Validation</h3>
<ul>
<li>[ ] <strong>Strategic Decision Translation</strong>: All architectural decisions from strategic blueprint correctly implemented in technical specifications</li>
<li>[ ] <strong>Database Schema Validation</strong>: File-based storage model supports all required conversation persistence features</li>
<li>[ ] <strong>API Contract Coverage</strong>: Process management and file I/O operations completely specified</li>
<li>[ ] <strong>External Integration Specs</strong>: Gemini CLI subprocess integration patterns clearly defined</li>
<li>[ ] <strong>Development Environment</strong>: Complete setup documentation with cross-platform considerations</li>
</ul>
<h3 id="post-implementation-validation">Post-Implementation Validation</h3>
<ul>
<li>[ ] <strong>Process Communication</strong>: Gemini CLI subprocess responds correctly to stdin prompts across all platforms</li>
<li>[ ] <strong>File System Integration</strong>: File watching triggers immediate and reliable prompt processing</li>
<li>[ ] <strong>Thread Coordination</strong>: Two-thread model operates without deadlocks through 1000+ prompt cycles</li>
<li>[ ] <strong>Error Recovery</strong>: Automatic process restart functions correctly after subprocess failures</li>
<li>[ ] <strong>Cross-Platform Compatibility</strong>: Identical functionality verified on Windows, macOS, and Linux</li>
</ul>
<h3 id="quality-assurance-standards">Quality Assurance Standards</h3>
<ul>
<li>[ ] <strong>Memory Stability</strong>: 48-hour continuous operation without memory leaks or performance degradation</li>
<li>[ ] <strong>Response Time</strong>: Sub-500ms latency from file save to subprocess stdin delivery</li>
<li>[ ] <strong>Error Handling</strong>: 95% of error scenarios recover automatically without user intervention</li>
<li>[ ] <strong>Data Integrity</strong>: Zero data loss during normal operation and graceful shutdown procedures</li>
<li>[ ] <strong>Resource Usage</strong>: Memory consumption under 50MB during 8-hour development sessions</li>
</ul>
<h2 id="next-phase-handoff">Next Phase Handoff</h2>
<p><strong>For MVP Prioritization</strong>: Technical foundation supports all Must Have features from MoSCoW analysis. Two-thread architecture provides sufficient complexity management while maintaining real-time responsiveness. File-based I/O model eliminates need for complex state management or database dependencies.</p>
<p><strong>Implementation Risks</strong>: 
- Threading coordination complexity requires iterative testing and debugging
- Cross-platform subprocess behavior variations need comprehensive validation
- Gemini CLI process stability depends on external network conditions and API availability</p>
<p><strong>Decision Points</strong>: 
- Sequential vs parallel prompt processing may need adjustment based on performance testing
- Error recovery strategies may require refinement based on real-world failure patterns<br />
- Configuration management approach could expand if user customization requests increase</p>
        </div>
        <div class="footer">
            Generated on 2025-08-30 08:39:17
        </div>
    </div>
</body>
</html>