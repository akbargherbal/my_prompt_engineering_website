<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ipev_loop_revised</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6; 
            color: #333; 
            background: #fff;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: #2c3e50; 
            color: white; 
            padding: 1rem 0; 
            position: sticky; 
            top: 0; 
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: #e74c3c; 
            color: white; 
            padding: 12px 16px; 
            border-radius: 50px; 
            text-decoration: none; 
            font-weight: bold; 
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .home-btn:hover { background: #c0392b; transform: translateY(-2px); }
        .breadcrumb { 
            background: #ecf0f1; 
            padding: 10px 0; 
            margin-bottom: 20px; 
            font-size: 14px;
        }
        .breadcrumb a { color: #3498db; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .content { 
            background: white; 
            padding: 2rem; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1rem; 
            margin: 2rem 0; 
        }
        .file-item { 
            padding: 1rem; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #f8f9fa;
            transition: all 0.3s;
        }
        .file-item:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        }
        .file-item a { 
            color: #2c3e50; 
            text-decoration: none; 
            font-weight: 500; 
            display: block;
        }
        .file-item a:hover { color: #3498db; }
        .file-type { 
            font-size: 12px; 
            color: #7f8c8d; 
            margin-top: 5px; 
        }
        .tree { font-family: monospace; white-space: pre-line; background: #f8f9fa; padding: 1rem; border-radius: 8px; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 1rem; border-radius: 8px; overflow-x: auto; }
        code { background: #ecf0f1; padding: 2px 4px; border-radius: 4px; font-size: 0.9em; }
        pre code { background: none; padding: 0; }
        h1, h2, h3, h4, h5, h6 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h1 { border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        a { color: #3498db; }
        a:hover { color: #2980b9; }
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: #7f8c8d; 
            border-top: 1px solid #ecf0f1; 
            margin-top: 3rem; 
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ipev_loop_revised</h1>
        </div>
    </div>
    <a href="/" class="home-btn">üè† Home</a>
    <div class="container">
        <div class="breadcrumb">
            <a href="/">Home</a> / <a href="/IPEV_LOOP_FACTORY/">IPEV_LOOP_FACTORY</a> / <a href="/IPEV_LOOP_FACTORY/RELEASES/">RELEASES</a> / <a href="/IPEV_LOOP_FACTORY/RELEASES/V21/">V21</a>
        </div>
        <div class="content">
            <h1 id="the-ipev-loop-21-a-practical-resilient-framework-for-agentic-ai">The IPEV Loop 2.1: A Practical &amp; Resilient Framework for Agentic AI</h1>
<h2 id="introduction">Introduction</h2>
<p>If you've used an Agentic LLM like Gemini CLI for a complex task, you have likely felt the frustration of watching it fail in baffling ways‚Äîgetting stuck in logic loops or silently overwriting its own work.</p>
<p>The core lesson from these failures is that our mental model for instructing these agents must evolve. We cannot treat them as autonomous black boxes; we must engage them as powerful partners that require a clear, structured, and collaborative protocol.</p>
<p>This guide provides that battle-tested strategy. It introduces the <strong>Intent-Plan-Execute-Verify (IPEV) Loop 2.1</strong>, a design pattern that transforms agents into transparent, predictable, and genuinely resilient partners.</p>
<h2 id="part-i-the-core-concepts">Part I: The Core Concepts</h2>
<h3 id="the-two-party-system">The Two-Party System</h3>
<p>Effective agentic workflow requires understanding that there are two distinct parties involved:</p>
<ul>
<li><strong>The User:</strong> You, the developer. You are the operator and strategist. You issue high-level goals, provide course corrections via <strong>Directives</strong>, and perform actions outside the agent's capabilities, such as saving the session history (<code>/chat save</code>).</li>
<li><strong>The Agent:</strong> The Gemini CLI process. The agent is the tactical executor. It can write code, run shell commands, and edit files. It operates within a strict loop and follows the protocols you provide. It <strong>cannot</strong> control its own application shell or perform user-level commands.</li>
</ul>
<h3 id="the-core-ipev-loop">The Core IPEV Loop</h3>
<p>The IPEV loop is the fundamental protocol that governs the agent's actions for every significant step it takes.</p>
<h4 id="1-intent-the-what">1. <strong>Intent (The "What")</strong></h4>
<p>The agent begins by stating its high-level objective for the immediate next step.</p>
<ul>
<li><strong>Purpose:</strong> To set the context and confirm it understands the goal.</li>
<li><strong>Example:</strong> <code>"My intent is to process '01-intro.md' and append the result to 'output.md'."</code></li>
</ul>
<h4 id="2-plan-the-how">2. <strong>Plan (The "How")</strong></h4>
<p>This is the heart of the framework. The agent must translate its intent into a low-level, unambiguous execution plan, specifying the <strong>exact tool, command, and parameters</strong> it will use.</p>
<ul>
<li><strong>Purpose:</strong> To eliminate ambiguity and expose flawed logic <em>before</em> execution.</li>
<li><strong>Good Plan (Unambiguous):</strong> <code>"PLAN: I will call the</code>edit<code>tool to modify 'output.md', ensuring my change appends the new text to the end of the file."</code></li>
<li><strong>Bad Plan (Ambiguous):</strong> <code>"PLAN: I will save the output to the file."</code></li>
</ul>
<h4 id="3-execute-the-do">3. <strong>Execute (The "Do")</strong></h4>
<p>The agent executes the <em>exact</em> plan it just declared.</p>
<ul>
<li><strong>Purpose:</strong> To perform the state-changing action in a predictable way.</li>
</ul>
<h4 id="4-verify-the-proof">4. <strong>Verify (The "Proof")</strong></h4>
<p>After execution, the agent must perform a check to confirm the action had the intended effect. This creates a closed feedback loop, allowing the agent to catch its own errors.</p>
<ul>
<li><strong>Purpose:</strong> To confirm success and detect failure immediately.</li>
<li><strong>Example:</strong> <code>"VERIFY: I will now run</code>ls -l output.md<code>and confirm its file size has increased."</code></li>
</ul>
<h2 id="part-ii-the-resilient-system-protocols">Part II: The Resilient System Protocols</h2>
<p>The core loop provides clarity, but resilience comes from handling failure. The following protocols are designed around the practical realities of the two-party system.</p>
<h3 id="1-the-collaborative-checkpointing-protocol">1. The Collaborative Checkpointing Protocol</h3>
<p>The agent cannot save its own session history, but it can‚Äîand must‚Äîsave the state of the codebase. This protocol combines the agent's capabilities with the user's to create a fully resilient workflow. It MUST be performed after every successful <code>VERIFY</code> step.</p>
<p><strong>Step A: Code Checkpoint (Autonomous Agent Action)</strong>
The agent uses its shell tool access to <code>git</code> to create a durable, revertible checkpoint of the project's state.</p>
<ul>
<li><strong>Agent's Task:</strong> Upon successful verification, the agent's next plan MUST be to run <code>git add .</code> and <code>git commit -m "Verified: [description of the completed step]"</code>.</li>
</ul>
<p><strong>Step B: Session Checkpoint (Collaborative User Action)</strong>
After the <code>git commit</code> is successful, the agent must <strong>PAUSE</strong> and prompt the user to save the session history.</p>
<ul>
<li><strong>Agent's Task:</strong> The agent MUST output the exact phrase: <code>**CODE CHECKPOINT COMPLETE. Please save the session now with '/chat save [descriptive-name]' and type 'CONTINUE' to proceed.**</code></li>
<li><strong>User's Task:</strong> The user then executes the <code>/chat save</code> command in the CLI and replies with <code>CONTINUE</code> to the agent.</li>
</ul>
<h3 id="2-the-directive-protocol-the-users-control-channel">2. The Directive Protocol: The User's Control Channel</h3>
<p>The Directive Protocol is the formal mechanism for the <strong>User</strong> to interrupt, inspect, or override the <strong>Agent's</strong> current task flow. The agent MUST treat any instruction it receives that is prefixed with <code>DIRECTIVE:</code> as an immediate, high-priority task.</p>
<ul>
<li><strong>Primary Uses:</strong> Inspection (<code>DIRECTIVE: Show me...</code>), state checks (<code>DIRECTIVE: Run 'git status'...</code>), and manual overrides.</li>
<li><strong>Scope and Limitations:</strong> A directive can only instruct the agent to perform actions possible with its standard tools. It does not grant the agent new capabilities. The user must translate their intent into an actionable command.</li>
</ul>
<h3 id="3-diagnostic-mode-intelligent-meta-debugging">3. Diagnostic Mode: Intelligent Meta-Debugging</h3>
<p>When a <code>VERIFY</code> step fails unexpectedly, the agent's mission should pivot to diagnosing the verification process itself. It should use more verbose flags (<code>-v</code>) or break the command into smaller pieces to isolate the failure.</p>
<h3 id="4-tool-instability-external-execution">4. Tool Instability &amp; External Execution</h3>
<p>If a specific command consistently freezes the agent's environment, the protocol is to ask the user to run it externally. The agent should state the command it needs run, and the user can paste the results back for the agent to use in its <code>VERIFY</code> step.</p>
<hr />
<h2 id="part-iii-the-complete-ipev-21-prompt-template">Part III: The Complete IPEV 2.1 Prompt Template</h2>
<p>This is a ready-to-use template. Copy this into the start of your mission file (e.g., <code>mission.md</code>).</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Mission: [Your High-Level Goal]</span>

<span class="gu">## 1. Core Protocol: The IPEV Loop with Collaborative Checkpointing</span>

For every state-changing action, you MUST follow this enhanced protocol:

<span class="k">1.</span>  <span class="gs">**INTENT:**</span> State your immediate objective.
<span class="k">2.</span>  <span class="gs">**PLAN:**</span> Propose precise, unambiguous commands with exact parameters.
<span class="k">3.</span>  <span class="gs">**EXECUTE:**</span> Run the exact command from your plan.
<span class="k">4.</span>  <span class="gs">**VERIFY:**</span> Perform a check to prove success.

<span class="gu">### **CRITICAL** Checkpointing Protocol (After a successful VERIFY):</span>

<span class="k">5.</span>  <span class="gs">**CODE CHECKPOINT:**</span> Use the <span class="sb">`shell`</span> tool to save the successful changes to git. Your plan must include <span class="sb">`git add .`</span> and <span class="sb">`git commit -m &quot;Verified: [brief description of change]&quot;`</span>.
<span class="k">6.</span>  <span class="gs">**SESSION CHECKPOINT (PAUSE):**</span> After the git commit is successful, you MUST PAUSE and output the following exact phrase: &quot;<span class="gs">**CODE CHECKPOINT COMPLETE. Please save the session now with `/chat save [descriptive-name]` and type &#39;CONTINUE&#39; to proceed.**</span>&quot; You will not proceed until I respond with &quot;CONTINUE&quot;.

<span class="gu">## 2. Directive Protocol</span>

I (The User) may interrupt you with a <span class="sb">`DIRECTIVE:`</span> prefix. You must execute my instruction immediately and then return to your previous task.

<span class="gu">## 3. Mission Parameters</span>

<span class="k">-</span><span class="w"> </span><span class="gs">**Input(s):**</span> [Describe source data, files, APIs]
<span class="k">-</span><span class="w"> </span><span class="gs">**Output(s):**</span> [Describe the desired final state]
<span class="k">-</span><span class="w"> </span><span class="gs">**Known Unstable Commands:**</span> [List any commands requiring external execution]

<span class="gu">## 4. Execution Flow</span>

<span class="k">1.</span>  <span class="gs">**Acknowledge:**</span> Acknowledge these instructions and the collaborative checkpointing protocol.
<span class="k">2.</span>  <span class="gs">**Survey:**</span> Perform an initial survey of the environment (<span class="sb">`ls -F`</span>, <span class="sb">`git status`</span>).
<span class="k">3.</span>  <span class="gs">**Execute:**</span> Begin the first IPEV loop.
<span class="k">4.</span>  <span class="gs">**Loop &amp; Checkpoint:**</span> Continue with the full IPEV &amp; Checkpointing protocol for every subsequent step until the mission is complete.
<span class="k">5.</span>  <span class="gs">**Complete:**</span> Signal completion and perform a final checkpoint.

Now, begin.
</code></pre></div>
        </div>
        <div class="footer">
            Generated on 2025-08-30 07:50:58
        </div>
    </div>
</body>
</html>