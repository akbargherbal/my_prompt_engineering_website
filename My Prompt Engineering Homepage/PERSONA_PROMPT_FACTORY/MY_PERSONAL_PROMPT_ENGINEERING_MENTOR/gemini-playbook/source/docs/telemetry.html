<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>telemetry</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6; 
            color: #333; 
            background: #fff;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: #2c3e50; 
            color: white; 
            padding: 1rem 0; 
            position: sticky; 
            top: 0; 
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: #e74c3c; 
            color: white; 
            padding: 12px 16px; 
            border-radius: 50px; 
            text-decoration: none; 
            font-weight: bold; 
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .home-btn:hover { background: #c0392b; transform: translateY(-2px); }
        .breadcrumb { 
            background: #ecf0f1; 
            padding: 10px 0; 
            margin-bottom: 20px; 
            font-size: 14px;
        }
        .breadcrumb a { color: #3498db; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .breadcrumb span { font-weight: bold; color: #333; }
        .content { 
            background: white; 
            padding: 2rem; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1rem; 
            margin: 2rem 0; 
        }
        .file-item { 
            padding: 1rem; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #f8f9fa;
            transition: all 0.3s;
        }
        .file-item:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        }
        .file-item a { 
            color: #2c3e50; 
            text-decoration: none; 
            font-weight: 500; 
            display: block;
        }
        .file-item a:hover { color: #3498db; }
        .file-type { 
            font-size: 12px; 
            color: #7f8c8d; 
            margin-top: 5px; 
        }
        .tree { font-family: monospace; white-space: pre-line; background: #f8f9fa; padding: 1rem; border-radius: 8px; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 1rem; border-radius: 8px; overflow-x: auto; }
        code { background: #ecf0f1; padding: 2px 4px; border-radius: 4px; font-size: 0.9em; }
        pre code { background: none; padding: 0; }
        h1, h2, h3, h4, h5, h6 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h1 { border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        a { color: #3498db; }
        a:hover { color: #2980b9; }
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: #7f8c8d; 
            border-top: 1px solid #ecf0f1; 
            margin-top: 3rem; 
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>telemetry</h1>
        </div>
    </div>
    <a href="../../../../../index.html" class="home-btn">üè† Home</a>
    <div class="container">
        <div class="breadcrumb">
            <a href="../../../../../index.html">Home</a> / <a href="../../../../../PERSONA_PROMPT_FACTORY/index.html">PERSONA_PROMPT_FACTORY</a> / <a href="../../../../../PERSONA_PROMPT_FACTORY/MY_PERSONAL_PROMPT_ENGINEERING_MENTOR/index.html">MY_PERSONAL_PROMPT_ENGINEERING_MENTOR</a> / <a href="../../../../../PERSONA_PROMPT_FACTORY/MY_PERSONAL_PROMPT_ENGINEERING_MENTOR/gemini-playbook/index.html">gemini-playbook</a> / <a href="../../../../../PERSONA_PROMPT_FACTORY/MY_PERSONAL_PROMPT_ENGINEERING_MENTOR/gemini-playbook/source/index.html">source</a> / <a href="../../../../../PERSONA_PROMPT_FACTORY/MY_PERSONAL_PROMPT_ENGINEERING_MENTOR/gemini-playbook/source/docs/index.html">docs</a>
        </div>
        <div class="content">
            <h1 id="gemini-cli-observability-guide">Gemini CLI Observability Guide</h1>
<p>Telemetry provides data about Gemini CLI's performance, health, and usage. By enabling it, you can monitor operations, debug issues, and optimize tool usage through traces, metrics, and structured logs.</p>
<p>Gemini CLI's telemetry system is built on the <strong><a href="https://opentelemetry.io/">OpenTelemetry</a> (OTEL)</strong> standard, allowing you to send data to any compatible backend.</p>
<h2 id="enabling-telemetry">Enabling telemetry</h2>
<p>You can enable telemetry in multiple ways. Configuration is primarily managed via the <a href="./cli/configuration.md"><code>.gemini/settings.json</code> file</a> and environment variables, but CLI flags can override these settings for a specific session.</p>
<h3 id="order-of-precedence">Order of precedence</h3>
<p>The following lists the precedence for applying telemetry settings, with items listed higher having greater precedence:</p>
<ol>
<li>
<p><strong>CLI flags (for <code>gemini</code> command):</strong></p>
<ul>
<li><code>--telemetry</code> / <code>--no-telemetry</code>: Overrides <code>telemetry.enabled</code>.</li>
<li><code>--telemetry-target &lt;local|gcp&gt;</code>: Overrides <code>telemetry.target</code>.</li>
<li><code>--telemetry-otlp-endpoint &lt;URL&gt;</code>: Overrides <code>telemetry.otlpEndpoint</code>.</li>
<li><code>--telemetry-log-prompts</code> / <code>--no-telemetry-log-prompts</code>: Overrides <code>telemetry.logPrompts</code>.</li>
<li><code>--telemetry-outfile &lt;path&gt;</code>: Redirects telemetry output to a file. See <a href="#exporting-to-a-file">Exporting to a file</a>.</li>
</ul>
</li>
<li>
<p><strong>Environment variables:</strong></p>
<ul>
<li><code>OTEL_EXPORTER_OTLP_ENDPOINT</code>: Overrides <code>telemetry.otlpEndpoint</code>.</li>
</ul>
</li>
<li>
<p><strong>Workspace settings file (<code>.gemini/settings.json</code>):</strong> Values from the <code>telemetry</code> object in this project-specific file.</p>
</li>
<li>
<p><strong>User settings file (<code>~/.gemini/settings.json</code>):</strong> Values from the <code>telemetry</code> object in this global user file.</p>
</li>
<li>
<p><strong>Defaults:</strong> applied if not set by any of the above.</p>
<ul>
<li><code>telemetry.enabled</code>: <code>false</code></li>
<li><code>telemetry.target</code>: <code>local</code></li>
<li><code>telemetry.otlpEndpoint</code>: <code>http://localhost:4317</code></li>
<li><code>telemetry.logPrompts</code>: <code>true</code></li>
</ul>
</li>
</ol>
<p><strong>For the <code>npm run telemetry -- --target=&lt;gcp|local&gt;</code> script:</strong>
The <code>--target</code> argument to this script <em>only</em> overrides the <code>telemetry.target</code> for the duration and purpose of that script (i.e., choosing which collector to start). It does not permanently change your <code>settings.json</code>. The script will first look at <code>settings.json</code> for a <code>telemetry.target</code> to use as its default.</p>
<h3 id="example-settings">Example settings</h3>
<p>The following code can be added to your workspace (<code>.gemini/settings.json</code>) or user (<code>~/.gemini/settings.json</code>) settings to enable telemetry and send the output to Google Cloud:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;telemetry&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gcp&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;sandbox&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="exporting-to-a-file">Exporting to a file</h3>
<p>You can export all telemetry data to a file for local inspection.</p>
<p>To enable file export, use the <code>--telemetry-outfile</code> flag with a path to your desired output file. This must be run using <code>--telemetry-target=local</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set your desired output file path</span>
<span class="nv">TELEMETRY_FILE</span><span class="o">=</span><span class="s2">&quot;.gemini/telemetry.log&quot;</span>

<span class="c1"># Run Gemini CLI with local telemetry</span>
<span class="c1"># NOTE: --telemetry-otlp-endpoint=&quot;&quot; is required to override the default</span>
<span class="c1"># OTLP exporter and ensure telemetry is written to the local file.</span>
gemini<span class="w"> </span>--telemetry<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--telemetry-target<span class="o">=</span><span class="nb">local</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--telemetry-otlp-endpoint<span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--telemetry-outfile<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TELEMETRY_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--prompt<span class="w"> </span><span class="s2">&quot;What is OpenTelemetry?&quot;</span>
</code></pre></div>

<h2 id="running-an-otel-collector">Running an OTEL Collector</h2>
<p>An OTEL Collector is a service that receives, processes, and exports telemetry data.
The CLI sends data using the OTLP/gRPC protocol.</p>
<p>Learn more about OTEL exporter standard configuration in <a href="https://opentelemetry.io/docs/languages/sdk-configuration/otlp-exporter/">documentation</a>.</p>
<h3 id="local">Local</h3>
<p>Use the <code>npm run telemetry -- --target=local</code> command to automate the process of setting up a local telemetry pipeline, including configuring the necessary settings in your <code>.gemini/settings.json</code> file. The underlying script installs <code>otelcol-contrib</code> (the OpenTelemetry Collector) and <code>jaeger</code> (The Jaeger UI for viewing traces). To use it:</p>
<ol>
<li>
<p><strong>Run the command</strong>:
    Execute the command from the root of the repository:</p>
<p><code>bash
npm run telemetry -- --target=local</code></p>
<p>The script will:
- Download Jaeger and OTEL if needed.
- Start a local Jaeger instance.
- Start an OTEL collector configured to receive data from Gemini CLI.
- Automatically enable telemetry in your workspace settings.
- On exit, disable telemetry.</p>
</li>
<li>
<p><strong>View traces</strong>:
    Open your web browser and navigate to <strong>http://localhost:16686</strong> to access the Jaeger UI. Here you can inspect detailed traces of Gemini CLI operations.</p>
</li>
<li>
<p><strong>Inspect logs and metrics</strong>:
    The script redirects the OTEL collector output (which includes logs and metrics) to <code>~/.gemini/tmp/&lt;projectHash&gt;/otel/collector.log</code>. The script will provide links to view and a command to tail your telemetry data (traces, metrics, logs) locally.</p>
</li>
<li>
<p><strong>Stop the services</strong>:
    Press <code>Ctrl+C</code> in the terminal where the script is running to stop the OTEL Collector and Jaeger services.</p>
</li>
</ol>
<h3 id="google-cloud">Google Cloud</h3>
<p>Use the <code>npm run telemetry -- --target=gcp</code> command to automate setting up a local OpenTelemetry collector that forwards data to your Google Cloud project, including configuring the necessary settings in your <code>.gemini/settings.json</code> file. The underlying script installs <code>otelcol-contrib</code>. To use it:</p>
<ol>
<li>
<p><strong>Prerequisites</strong>:</p>
<ul>
<li>Have a Google Cloud project ID.</li>
<li>Export the <code>GOOGLE_CLOUD_PROJECT</code> environment variable to make it available to the OTEL collector.
  <code>bash
  export OTLP_GOOGLE_CLOUD_PROJECT="your-project-id"</code></li>
<li>Authenticate with Google Cloud (e.g., run <code>gcloud auth application-default login</code> or ensure <code>GOOGLE_APPLICATION_CREDENTIALS</code> is set).</li>
<li>Ensure your Google Cloud account/service account has the necessary IAM roles: "Cloud Trace Agent", "Monitoring Metric Writer", and "Logs Writer".</li>
</ul>
</li>
<li>
<p><strong>Run the command</strong>:
    Execute the command from the root of the repository:</p>
<p><code>bash
npm run telemetry -- --target=gcp</code></p>
<p>The script will:
- Download the <code>otelcol-contrib</code> binary if needed.
- Start an OTEL collector configured to receive data from Gemini CLI and export it to your specified Google Cloud project.
- Automatically enable telemetry and disable sandbox mode in your workspace settings (<code>.gemini/settings.json</code>).
- Provide direct links to view traces, metrics, and logs in your Google Cloud Console.
- On exit (Ctrl+C), it will attempt to restore your original telemetry and sandbox settings.</p>
</li>
<li>
<p><strong>Run Gemini CLI:</strong>
    In a separate terminal, run your Gemini CLI commands. This generates telemetry data that the collector captures.</p>
</li>
<li>
<p><strong>View telemetry in Google Cloud</strong>:
    Use the links provided by the script to navigate to the Google Cloud Console and view your traces, metrics, and logs.</p>
</li>
<li>
<p><strong>Inspect local collector logs</strong>:
    The script redirects the local OTEL collector output to <code>~/.gemini/tmp/&lt;projectHash&gt;/otel/collector-gcp.log</code>. The script provides links to view and command to tail your collector logs locally.</p>
</li>
<li>
<p><strong>Stop the service</strong>:
    Press <code>Ctrl+C</code> in the terminal where the script is running to stop the OTEL Collector.</p>
</li>
</ol>
<h2 id="logs-and-metric-reference">Logs and metric reference</h2>
<p>The following section describes the structure of logs and metrics generated for Gemini CLI.</p>
<ul>
<li>A <code>sessionId</code> is included as a common attribute on all logs and metrics.</li>
</ul>
<h3 id="logs">Logs</h3>
<p>Logs are timestamped records of specific events. The following events are logged for Gemini CLI:</p>
<ul>
<li><code>gemini_cli.config</code>: This event occurs once at startup with the CLI's configuration.</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code> (string)</li>
<li><code>embedding_model</code> (string)</li>
<li><code>sandbox_enabled</code> (boolean)</li>
<li><code>core_tools_enabled</code> (string)</li>
<li><code>approval_mode</code> (string)</li>
<li><code>api_key_enabled</code> (boolean)</li>
<li><code>vertex_ai_enabled</code> (boolean)</li>
<li><code>code_assist_enabled</code> (boolean)</li>
<li><code>log_prompts_enabled</code> (boolean)</li>
<li><code>file_filtering_respect_git_ignore</code> (boolean)</li>
<li><code>debug_mode</code> (boolean)</li>
<li><code>mcp_servers</code> (string)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.user_prompt</code>: This event occurs when a user submits a prompt.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>prompt_length</code></li>
<li><code>prompt</code> (this attribute is excluded if <code>log_prompts_enabled</code> is configured to be <code>false</code>)</li>
<li><code>auth_type</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.tool_call</code>: This event occurs for each function call.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>function_name</code></li>
<li><code>function_args</code></li>
<li><code>duration_ms</code></li>
<li><code>success</code> (boolean)</li>
<li><code>decision</code> (string: "accept", "reject", "auto_accept", or "modify", if applicable)</li>
<li><code>error</code> (if applicable)</li>
<li><code>error_type</code> (if applicable)</li>
<li><code>metadata</code> (if applicable, dictionary of string -&gt; any)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.api_request</code>: This event occurs when making a request to Gemini API.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>request_text</code> (if applicable)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.api_error</code>: This event occurs if the API request fails.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>error</code></li>
<li><code>error_type</code></li>
<li><code>status_code</code></li>
<li><code>duration_ms</code></li>
<li><code>auth_type</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.api_response</code>: This event occurs upon receiving a response from Gemini API.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>status_code</code></li>
<li><code>duration_ms</code></li>
<li><code>error</code> (optional)</li>
<li><code>input_token_count</code></li>
<li><code>output_token_count</code></li>
<li><code>cached_content_token_count</code></li>
<li><code>thoughts_token_count</code></li>
<li><code>tool_token_count</code></li>
<li><code>response_text</code> (if applicable)</li>
<li><code>auth_type</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.flash_fallback</code>: This event occurs when Gemini CLI switches to flash as fallback.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>auth_type</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.slash_command</code>: This event occurs when a user executes a slash command.</p>
</li>
<li><strong>Attributes</strong>:<ul>
<li><code>command</code> (string)</li>
<li><code>subcommand</code> (string, if applicable)</li>
</ul>
</li>
</ul>
<h3 id="metrics">Metrics</h3>
<p>Metrics are numerical measurements of behavior over time. The following metrics are collected for Gemini CLI:</p>
<ul>
<li>
<p><code>gemini_cli.session.count</code> (Counter, Int): Incremented once per CLI startup.</p>
</li>
<li>
<p><code>gemini_cli.tool.call.count</code> (Counter, Int): Counts tool calls.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>function_name</code></li>
<li><code>success</code> (boolean)</li>
<li><code>decision</code> (string: "accept", "reject", or "modify", if applicable)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.tool.call.latency</code> (Histogram, ms): Measures tool call latency.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>function_name</code></li>
<li><code>decision</code> (string: "accept", "reject", or "modify", if applicable)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.api.request.count</code> (Counter, Int): Counts all API requests.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>status_code</code></li>
<li><code>error_type</code> (if applicable)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.api.request.latency</code> (Histogram, ms): Measures API request latency.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.token.usage</code> (Counter, Int): Counts the number of tokens used.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>type</code> (string: "input", "output", "thought", "cache", or "tool")</li>
</ul>
</li>
<li>
<p><code>gemini_cli.file.operation.count</code> (Counter, Int): Counts file operations.</p>
</li>
<li><strong>Attributes</strong>:<ul>
<li><code>operation</code> (string: "create", "read", "update"): The type of file operation.</li>
<li><code>lines</code> (Int, if applicable): Number of lines in the file.</li>
<li><code>mimetype</code> (string, if applicable): Mimetype of the file.</li>
<li><code>extension</code> (string, if applicable): File extension of the file.</li>
<li><code>ai_added_lines</code> (Int, if applicable): Number of lines added/changed by AI.</li>
<li><code>ai_removed_lines</code> (Int, if applicable): Number of lines removed/changed by AI.</li>
<li><code>user_added_lines</code> (Int, if applicable): Number of lines added/changed by user in AI proposed changes.</li>
<li><code>user_removed_lines</code> (Int, if applicable): Number of lines removed/changed by user in AI proposed changes.</li>
</ul>
</li>
</ul>
        </div>
        <div class="footer">
            Generated on 2025-08-30 08:20:39
        </div>
    </div>
</body>
</html>