<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEMINI_CLI_OFFICIAL_DOCS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6; 
            color: #333; 
            background: #fff;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { 
            background: #2c3e50; 
            color: white; 
            padding: 1rem 0; 
            position: sticky; 
            top: 0; 
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .home-btn { 
            position: fixed; 
            top: 20px; 
            right: 20px; 
            background: #e74c3c; 
            color: white; 
            padding: 12px 16px; 
            border-radius: 50px; 
            text-decoration: none; 
            font-weight: bold; 
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        .home-btn:hover { background: #c0392b; transform: translateY(-2px); }
        .breadcrumb { 
            background: #ecf0f1; 
            padding: 10px 0; 
            margin-bottom: 20px; 
            font-size: 14px;
        }
        .breadcrumb a { color: #3498db; text-decoration: none; }
        .breadcrumb a:hover { text-decoration: underline; }
        .content { 
            background: white; 
            padding: 2rem; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .file-list { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 1rem; 
            margin: 2rem 0; 
        }
        .file-item { 
            padding: 1rem; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #f8f9fa;
            transition: all 0.3s;
        }
        .file-item:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
        }
        .file-item a { 
            color: #2c3e50; 
            text-decoration: none; 
            font-weight: 500; 
            display: block;
        }
        .file-item a:hover { color: #3498db; }
        .file-type { 
            font-size: 12px; 
            color: #7f8c8d; 
            margin-top: 5px; 
        }
        .tree { font-family: monospace; white-space: pre-line; background: #f8f9fa; padding: 1rem; border-radius: 8px; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 1rem; border-radius: 8px; overflow-x: auto; }
        code { background: #ecf0f1; padding: 2px 4px; border-radius: 4px; font-size: 0.9em; }
        pre code { background: none; padding: 0; }
        h1, h2, h3, h4, h5, h6 { color: #2c3e50; margin: 1.5rem 0 1rem 0; }
        h1 { border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        a { color: #3498db; }
        a:hover { color: #2980b9; }
        .footer { 
            text-align: center; 
            padding: 2rem; 
            color: #7f8c8d; 
            border-top: 1px solid #ecf0f1; 
            margin-top: 3rem; 
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .file-list { grid-template-columns: 1fr; }
            .content { padding: 1rem; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>GEMINI_CLI_OFFICIAL_DOCS</h1>
        </div>
    </div>
    <a href="/" class="home-btn">üè† Home</a>
    <div class="container">
        <div class="breadcrumb">
            <a href="/">Home</a> / <a href="/DOCS/">DOCS</a>
        </div>
        <div class="content">
            <p>‚îú‚îÄ‚îÄ Uninstall.md
  Content:</p>
<h1 id="uninstalling-the-cli">Uninstalling the CLI</h1>
<p>Your uninstall method depends on how you ran the CLI. Follow the instructions for either npx or a global npm installation.</p>
<h2 id="method-1-using-npx">Method 1: Using npx</h2>
<p>npx runs packages from a temporary cache without a permanent installation. To "uninstall" the CLI, you must clear this cache, which will remove gemini-cli and any other packages previously executed with npx.</p>
<p>The npx cache is a directory named <code>_npx</code> inside your main npm cache folder. You can find your npm cache path by running <code>npm config get cache</code>.</p>
<p><strong>For macOS / Linux</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># The path is typically ~/.npm/_npx</span>
rm<span class="w"> </span>-rf<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>npm<span class="w"> </span>config<span class="w"> </span>get<span class="w"> </span>cache<span class="k">)</span><span class="s2">/_npx&quot;</span>
</code></pre></div>

<p><strong>For Windows</strong></p>
<p><em>Command Prompt</em></p>
<div class="codehilite"><pre><span></span><code>:: The path is typically %LocalAppData%\npm-cache\_npx
rmdir /s /q &quot;%LocalAppData%\npm-cache\_npx&quot;
</code></pre></div>

<p><em>PowerShell</em></p>
<div class="codehilite"><pre><span></span><code><span class="c"># The path is typically $env:LocalAppData\npm-cache\_npx</span>
<span class="nb">Remove-Item</span> <span class="n">-Path</span> <span class="p">(</span><span class="nb">Join-Path</span> <span class="nv">$env:LocalAppData</span> <span class="s2">&quot;npm-cache\_npx&quot;</span><span class="p">)</span> <span class="n">-Recurse</span> <span class="n">-Force</span>
</code></pre></div>

<h2 id="method-2-using-npm-global-install">Method 2: Using npm (Global Install)</h2>
<p>If you installed the CLI globally (e.g., <code>npm install -g @google/gemini-cli</code>), use the <code>npm uninstall</code> command with the <code>-g</code> flag to remove it.</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>uninstall<span class="w"> </span>-g<span class="w"> </span>@google/gemini-cli
</code></pre></div>

<p>This command completely removes the package from your system.</p>
<p>‚îú‚îÄ‚îÄ architecture.md
  Content:</p>
<h1 id="gemini-cli-architecture-overview">Gemini CLI Architecture Overview</h1>
<p>This document provides a high-level overview of the Gemini CLI's architecture.</p>
<h2 id="core-components">Core components</h2>
<p>The Gemini CLI is primarily composed of two main packages, along with a suite of tools that can be used by the system in the course of handling command-line input:</p>
<ol>
<li>
<p><strong>CLI package (<code>packages/cli</code>):</strong></p>
<ul>
<li><strong>Purpose:</strong> This contains the user-facing portion of the Gemini CLI, such as handling the initial user input, presenting the final output, and managing the overall user experience.</li>
<li><strong>Key functions contained in the package:</strong></li>
<li><a href="./cli/commands.md">Input processing</a></li>
<li>History management</li>
<li>Display rendering</li>
<li><a href="./cli/themes.md">Theme and UI customization</a></li>
<li><a href="./cli/configuration.md">CLI configuration settings</a></li>
</ul>
</li>
<li>
<p><strong>Core package (<code>packages/core</code>):</strong></p>
<ul>
<li><strong>Purpose:</strong> This acts as the backend for the Gemini CLI. It receives requests sent from <code>packages/cli</code>, orchestrates interactions with the Gemini API, and manages the execution of available tools.</li>
<li><strong>Key functions contained in the package:</strong></li>
<li>API client for communicating with the Google Gemini API</li>
<li>Prompt construction and management</li>
<li>Tool registration and execution logic</li>
<li>State management for conversations or sessions</li>
<li>Server-side configuration</li>
</ul>
</li>
<li>
<p><strong>Tools (<code>packages/core/src/tools/</code>):</strong></p>
<ul>
<li><strong>Purpose:</strong> These are individual modules that extend the capabilities of the Gemini model, allowing it to interact with the local environment (e.g., file system, shell commands, web fetching).</li>
<li><strong>Interaction:</strong> <code>packages/core</code> invokes these tools based on requests from the Gemini model.</li>
</ul>
</li>
</ol>
<h2 id="interaction-flow">Interaction Flow</h2>
<p>A typical interaction with the Gemini CLI follows this flow:</p>
<ol>
<li><strong>User input:</strong> The user types a prompt or command into the terminal, which is managed by <code>packages/cli</code>.</li>
<li><strong>Request to core:</strong> <code>packages/cli</code> sends the user's input to <code>packages/core</code>.</li>
<li><strong>Request processed:</strong> The core package:<ul>
<li>Constructs an appropriate prompt for the Gemini API, possibly including conversation history and available tool definitions.</li>
<li>Sends the prompt to the Gemini API.</li>
</ul>
</li>
<li><strong>Gemini API response:</strong> The Gemini API processes the prompt and returns a response. This response might be a direct answer or a request to use one of the available tools.</li>
<li><strong>Tool execution (if applicable):</strong><ul>
<li>When the Gemini API requests a tool, the core package prepares to execute it.</li>
<li>If the requested tool can modify the file system or execute shell commands, the user is first given details of the tool and its arguments, and the user must approve the execution.</li>
<li>Read-only operations, such as reading files, might not require explicit user confirmation to proceed.</li>
<li>Once confirmed, or if confirmation is not required, the core package executes the relevant action within the relevant tool, and the result is sent back to the Gemini API by the core package.</li>
<li>The Gemini API processes the tool result and generates a final response.</li>
</ul>
</li>
<li><strong>Response to CLI:</strong> The core package sends the final response back to the CLI package.</li>
<li><strong>Display to user:</strong> The CLI package formats and displays the response to the user in the terminal.</li>
</ol>
<h2 id="key-design-principles">Key Design Principles</h2>
<ul>
<li><strong>Modularity:</strong> Separating the CLI (frontend) from the Core (backend) allows for independent development and potential future extensions (e.g., different frontends for the same backend).</li>
<li><strong>Extensibility:</strong> The tool system is designed to be extensible, allowing new capabilities to be added.</li>
<li><strong>User experience:</strong> The CLI focuses on providing a rich and interactive terminal experience.</li>
</ul>
<p>‚îî‚îÄ‚îÄ assets/
  ‚îú‚îÄ‚îÄ connected_devtools.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ gemini-screenshot.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-ansi-light.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-ansi.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-atom-one.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-ayu-light.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-ayu.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-custom.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-default-light.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-default.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-dracula.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-github-light.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-github.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-google-light.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ theme-xcode-light.png
    [Error processing file]</p>
<p>‚îú‚îÄ‚îÄ checkpointing.md
  Content:</p>
<h1 id="checkpointing">Checkpointing</h1>
<p>The Gemini CLI includes a Checkpointing feature that automatically saves a snapshot of your project's state before any file modifications are made by AI-powered tools. This allows you to safely experiment with and apply code changes, knowing you can instantly revert back to the state before the tool was run.</p>
<h2 id="how-it-works">How It Works</h2>
<p>When you approve a tool that modifies the file system (like <code>write_file</code> or <code>replace</code>), the CLI automatically creates a "checkpoint." This checkpoint includes:</p>
<ol>
<li><strong>A Git Snapshot:</strong> A commit is made in a special, shadow Git repository located in your home directory (<code>~/.gemini/history/&lt;project_hash&gt;</code>). This snapshot captures the complete state of your project files at that moment. It does <strong>not</strong> interfere with your own project's Git repository.</li>
<li><strong>Conversation History:</strong> The entire conversation you've had with the agent up to that point is saved.</li>
<li><strong>The Tool Call:</strong> The specific tool call that was about to be executed is also stored.</li>
</ol>
<p>If you want to undo the change or simply go back, you can use the <code>/restore</code> command. Restoring a checkpoint will:</p>
<ul>
<li>Revert all files in your project to the state captured in the snapshot.</li>
<li>Restore the conversation history in the CLI.</li>
<li>Re-propose the original tool call, allowing you to run it again, modify it, or simply ignore it.</li>
</ul>
<p>All checkpoint data, including the Git snapshot and conversation history, is stored locally on your machine. The Git snapshot is stored in the shadow repository while the conversation history and tool calls are saved in a JSON file in your project's temporary directory, typically located at <code>~/.gemini/tmp/&lt;project_hash&gt;/checkpoints</code>.</p>
<h2 id="enabling-the-feature">Enabling the Feature</h2>
<p>The Checkpointing feature is disabled by default. To enable it, you can either use a command-line flag or edit your <code>settings.json</code> file.</p>
<h3 id="using-the-command-line-flag">Using the Command-Line Flag</h3>
<p>You can enable checkpointing for the current session by using the <code>--checkpointing</code> flag when starting the Gemini CLI:</p>
<div class="codehilite"><pre><span></span><code>gemini<span class="w"> </span>--checkpointing
</code></pre></div>

<h3 id="using-the-settingsjson-file">Using the <code>settings.json</code> File</h3>
<p>To enable checkpointing by default for all sessions, you need to edit your <code>settings.json</code> file.</p>
<p>Add the following key to your <code>settings.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;checkpointing&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="using-the-restore-command">Using the <code>/restore</code> Command</h2>
<p>Once enabled, checkpoints are created automatically. To manage them, you use the <code>/restore</code> command.</p>
<h3 id="list-available-checkpoints">List Available Checkpoints</h3>
<p>To see a list of all saved checkpoints for the current project, simply run:</p>
<div class="codehilite"><pre><span></span><code>/restore
</code></pre></div>

<p>The CLI will display a list of available checkpoint files. These file names are typically composed of a timestamp, the name of the file being modified, and the name of the tool that was about to be run (e.g., <code>2025-06-22T10-00-00_000Z-my-file.txt-write_file</code>).</p>
<h3 id="restore-a-specific-checkpoint">Restore a Specific Checkpoint</h3>
<p>To restore your project to a specific checkpoint, use the checkpoint file from the list:</p>
<div class="codehilite"><pre><span></span><code>/restore &lt;checkpoint_file&gt;
</code></pre></div>

<p>For example:</p>
<div class="codehilite"><pre><span></span><code>/restore 2025-06-22T10-00-00_000Z-my-file.txt-write_file
</code></pre></div>

<p>After running the command, your files and conversation will be immediately restored to the state they were in when the checkpoint was created, and the original tool prompt will reappear.</p>
<p>‚îî‚îÄ‚îÄ cli/
  ‚îú‚îÄ‚îÄ authentication.md
    Content:</p>
<h1 id="authentication-setup">Authentication Setup</h1>
<p>The Gemini CLI requires you to authenticate with Google's AI services. On initial startup you'll need to configure <strong>one</strong> of the following authentication methods:</p>
<ol>
<li>
<p><strong>Login with Google (Gemini Code Assist):</strong></p>
<ul>
<li>Use this option to log in with your Google account.</li>
<li>During initial startup, Gemini CLI will direct you to a webpage for authentication. Once authenticated, your credentials will be cached locally so the web login can be skipped on subsequent runs.</li>
<li>Note that the web login must be done in a browser that can communicate with the machine Gemini CLI is being run from. (Specifically, the browser will be redirected to a localhost url that Gemini CLI will be listening on).</li>
<li><a id="workspace-gca">Users may have to specify a GOOGLE_CLOUD_PROJECT if:</a></li>
<li>You have a Google Workspace account. Google Workspace is a paid service for businesses and organizations that provides a suite of productivity tools, including a custom email domain (e.g. your-name@your-company.com), enhanced security features, and administrative controls. These accounts are often managed by an employer or school.</li>
<li>You have received a Gemini Code Assist license through the <a href="https://developers.google.com/program/plans-and-pricing">Google Developer Program</a> (including qualified Google Developer Experts)</li>
<li>You have been assigned a license to a current Gemini Code Assist standard or enterprise subscription.</li>
<li>You are using the product outside the <a href="https://developers.google.com/gemini-code-assist/resources/available-locations">supported regions</a> for free individual usage.</li>
<li>You are a Google account holder under the age of 18</li>
<li>If you fall into one of these categories, you must first configure a Google Cloud Project ID to use, <a href="https://cloud.google.com/gemini/docs/discover/set-up-gemini#enable-api">enable the Gemini for Cloud API</a> and <a href="https://cloud.google.com/gemini/docs/discover/set-up-gemini#grant-iam">configure access permissions</a>.</li>
</ul>
<p>You can temporarily set the environment variable in your current shell session using the following command:</p>
<p><code>bash
  export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"</code>
  - For repeated use, you can add the environment variable to your <a href="#persisting-environment-variables-with-env-files">.env file</a> or your shell's configuration file (like <code>~/.bashrc</code>, <code>~/.zshrc</code>, or <code>~/.profile</code>). For example, the following command adds the environment variable to a <code>~/.bashrc</code> file:</p>
<p><code>bash
  echo 'export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"' &gt;&gt; ~/.bashrc
  source ~/.bashrc</code></p>
</li>
<li>
<p><strong><a id="gemini-api-key"></a>Gemini API key:</strong></p>
<ul>
<li>Obtain your API key from Google AI Studio: <a href="https://aistudio.google.com/app/apikey">https://aistudio.google.com/app/apikey</a></li>
<li>Set the <code>GEMINI_API_KEY</code> environment variable. In the following methods, replace <code>YOUR_GEMINI_API_KEY</code> with the API key you obtained from Google AI Studio:</li>
<li>You can temporarily set the environment variable in your current shell session using the following command:
    <code>bash
    export GEMINI_API_KEY="YOUR_GEMINI_API_KEY"</code></li>
<li>
<p>For repeated use, you can add the environment variable to your <a href="#persisting-environment-variables-with-env-files">.env file</a>.</p>
</li>
<li>
<p>Alternatively you can export the API key from your shell's configuration file (like <code>~/.bashrc</code>, <code>~/.zshrc</code>, or <code>~/.profile</code>). For example, the following command adds the environment variable to a <code>~/.bashrc</code> file:</p>
<p><code>bash
echo 'export GEMINI_API_KEY="YOUR_GEMINI_API_KEY"' &gt;&gt; ~/.bashrc
source ~/.bashrc</code></p>
<p>:warning: Be advised that when you export your API key inside your shell configuration file, any other process executed from the shell can read it.</p>
</li>
</ul>
</li>
<li>
<p><strong>Vertex AI:</strong></p>
<ul>
<li>Obtain your Google Cloud API key: <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/start/api-keys?usertype=newuser">Get an API Key</a></li>
<li>Set the <code>GOOGLE_API_KEY</code> environment variable. In the following methods, replace <code>YOUR_GOOGLE_API_KEY</code> with your Vertex AI API key:<ul>
<li>You can temporarily set these environment variables in your current shell session using the following commands:
  <code>bash
  export GOOGLE_API_KEY="YOUR_GOOGLE_API_KEY"</code></li>
<li>For repeated use, you can add the environment variables to your <a href="#persisting-environment-variables-with-env-files">.env file</a> or your shell's configuration file (like <code>~/.bashrc</code>, <code>~/.zshrc</code>, or <code>~/.profile</code>). For example, the following commands add the environment variables to a <code>~/.bashrc</code> file:
  <code>bash
  echo 'export GOOGLE_API_KEY="YOUR_GOOGLE_API_KEY"' &gt;&gt; ~/.bashrc
  source ~/.bashrc</code></li>
</ul>
</li>
<li>To use Application Default Credentials (ADC), use the following command:</li>
<li>Ensure you have a Google Cloud project and have enabled the Vertex AI API.
    <code>bash
    gcloud auth application-default login</code>
    For more information, see <a href="https://cloud.google.com/docs/authentication/provide-credentials-adc">Set up Application Default Credentials for Google Cloud</a>.</li>
<li>
<p>Set the <code>GOOGLE_CLOUD_PROJECT</code> and <code>GOOGLE_CLOUD_LOCATION</code> environment variables. In the following methods, replace <code>YOUR_PROJECT_ID</code> and <code>YOUR_PROJECT_LOCATION</code> with the relevant values for your project:</p>
<ul>
<li>You can temporarily set these environment variables in your current shell session using the following commands:
  <code>bash
  export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"
  export GOOGLE_CLOUD_LOCATION="YOUR_PROJECT_LOCATION" # e.g., us-central1</code></li>
<li>
<p>For repeated use, you can add the environment variables to your <a href="#persisting-environment-variables-with-env-files">.env file</a></p>
</li>
<li>
<p>Alternatively you can export the environment variables from your shell's configuration file (like <code>~/.bashrc</code>, <code>~/.zshrc</code>, or <code>~/.profile</code>). For example, the following commands add the environment variables to a <code>~/.bashrc</code> file:</p>
</li>
</ul>
<p><code>bash
  echo 'export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"' &gt;&gt; ~/.bashrc
  echo 'export GOOGLE_CLOUD_LOCATION="YOUR_PROJECT_LOCATION"' &gt;&gt; ~/.bashrc
  source ~/.bashrc</code></p>
<p>:warning: Be advised that when you export your API key inside your shell configuration file, any other process executed from the shell can read it.</p>
</li>
</ul>
</li>
<li>
<p><strong>Cloud Shell:</strong></p>
<ul>
<li>This option is only available when running in a Google Cloud Shell environment.</li>
<li>It automatically uses the credentials of the logged-in user in the Cloud Shell environment.</li>
<li>
<p>This is the default authentication method when running in Cloud Shell and no other method is configured.</p>
<p>:warning: Be advised that when you export your API key inside your shell configuration file, any other process executed from the shell can read it.</p>
</li>
</ul>
</li>
</ol>
<h3 id="persisting-environment-variables-with-env-files">Persisting Environment Variables with <code>.env</code> Files</h3>
<p>You can create a <strong><code>.gemini/.env</code></strong> file in your project directory or in your home directory. Creating a plain <strong><code>.env</code></strong> file also works, but <code>.gemini/.env</code> is recommended to keep Gemini variables isolated from other tools.</p>
<p><strong>Important:</strong> Some environment variables (like <code>DEBUG</code> and <code>DEBUG_MODE</code>) are automatically excluded from project <code>.env</code> files to prevent interference with gemini-cli behavior. Use <code>.gemini/.env</code> files for gemini-cli specific variables.</p>
<p>Gemini CLI automatically loads environment variables from the <strong>first</strong> <code>.env</code> file it finds, using the following search order:</p>
<ol>
<li>Starting in the <strong>current directory</strong> and moving upward toward <code>/</code>, for each directory it checks:</li>
<li><code>.gemini/.env</code></li>
<li><code>.env</code></li>
<li>If no file is found, it falls back to your <strong>home directory</strong>:</li>
<li><code>~/.gemini/.env</code></li>
<li><code>~/.env</code></li>
</ol>
<blockquote>
<p><strong>Important:</strong> The search stops at the <strong>first</strong> file encountered‚Äîvariables are <strong>not merged</strong> across multiple files.</p>
</blockquote>
<h4 id="examples">Examples</h4>
<p><strong>Project-specific overrides</strong> (take precedence when you are inside the project):</p>
<div class="codehilite"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>.gemini
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;GOOGLE_CLOUD_PROJECT=&quot;your-project-id&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>.gemini/.env
</code></pre></div>

<p><strong>User-wide settings</strong> (available in every directory):</p>
<div class="codehilite"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.gemini
cat<span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.gemini/.env<span class="w"> </span><span class="s">&lt;&lt;&#39;EOF&#39;</span>
<span class="s">GOOGLE_CLOUD_PROJECT=&quot;your-project-id&quot;</span>
<span class="s">GEMINI_API_KEY=&quot;your-gemini-api-key&quot;</span>
<span class="s">EOF</span>
</code></pre></div>

<h2 id="non-interactive-mode-headless-environments">Non-Interactive Mode / Headless Environments</h2>
<p>When running the Gemini CLI in a non-interactive environment, you cannot use the interactive login flow.
Instead, you must configure authentication using environment variables.</p>
<p>The CLI will automatically detect if it is running in a non-interactive terminal and will use one of the
following authentication methods if available:</p>
<ol>
<li>
<p><strong>Gemini API Key:</strong></p>
<ul>
<li>Set the <code>GEMINI_API_KEY</code> environment variable.</li>
<li>The CLI will use this key to authenticate with the Gemini API.</li>
</ul>
</li>
<li>
<p><strong>Vertex AI:</strong></p>
<ul>
<li>Set the <code>GOOGLE_GENAI_USE_VERTEXAI=true</code> environment variable.</li>
<li><strong>Using an API Key:</strong> Set the <code>GOOGLE_API_KEY</code> environment variable.</li>
<li><strong>Using Application Default Credentials (ADC):</strong></li>
<li>Run <code>gcloud auth application-default login</code> in your environment to configure ADC.</li>
<li>Ensure the <code>GOOGLE_CLOUD_PROJECT</code> and <code>GOOGLE_CLOUD_LOCATION</code> environment variables are set.</li>
</ul>
</li>
</ol>
<p>If none of these environment variables are set in a non-interactive session, the CLI will exit with an error.</p>
<p>‚îú‚îÄ‚îÄ commands.md
    Content:</p>
<h1 id="cli-commands">CLI Commands</h1>
<p>Gemini CLI supports several built-in commands to help you manage your session, customize the interface, and control its behavior. These commands are prefixed with a forward slash (<code>/</code>), an at symbol (<code>@</code>), or an exclamation mark (<code>!</code>).</p>
<h2 id="slash-commands">Slash commands (<code>/</code>)</h2>
<p>Slash commands provide meta-level control over the CLI itself.</p>
<h3 id="built-in-commands">Built-in Commands</h3>
<ul>
<li><strong><code>/bug</code></strong></li>
<li>
<p><strong>Description:</strong> File an issue about Gemini CLI. By default, the issue is filed within the GitHub repository for Gemini CLI. The string you enter after <code>/bug</code> will become the headline for the bug being filed. The default <code>/bug</code> behavior can be modified using the <code>bugCommand</code> setting in your <code>.gemini/settings.json</code> files.</p>
</li>
<li>
<p><strong><code>/chat</code></strong></p>
</li>
<li><strong>Description:</strong> Save and resume conversation history for branching conversation state interactively, or resuming a previous state from a later session.</li>
<li>
<p><strong>Sub-commands:</strong></p>
<ul>
<li><strong><code>save</code></strong></li>
<li><strong>Description:</strong> Saves the current conversation history. You must add a <code>&lt;tag&gt;</code> for identifying the conversation state.</li>
<li><strong>Usage:</strong> <code>/chat save &lt;tag&gt;</code></li>
<li><strong>Details on Checkpoint Location:</strong> The default locations for saved chat checkpoints are:<ul>
<li>Linux/macOS: <code>~/.config/google-generative-ai/checkpoints/</code></li>
<li>Windows: <code>C:\Users\&lt;YourUsername&gt;\AppData\Roaming\google-generative-ai\checkpoints\</code></li>
<li>When you run <code>/chat list</code>, the CLI only scans these specific directories to find available checkpoints.</li>
<li><strong>Note:</strong> These checkpoints are for manually saving and resuming conversation states. For automatic checkpoints created before file modifications, see the <a href="../checkpointing.md">Checkpointing documentation</a>.</li>
</ul>
</li>
<li><strong><code>resume</code></strong></li>
<li><strong>Description:</strong> Resumes a conversation from a previous save.</li>
<li><strong>Usage:</strong> <code>/chat resume &lt;tag&gt;</code></li>
<li><strong><code>list</code></strong></li>
<li><strong>Description:</strong> Lists available tags for chat state resumption.</li>
<li><strong><code>delete</code></strong></li>
<li><strong>Description:</strong> Deletes a saved conversation checkpoint.</li>
<li><strong>Usage:</strong> <code>/chat delete &lt;tag&gt;</code></li>
</ul>
</li>
<li>
<p><strong><code>/clear</code></strong></p>
</li>
<li><strong>Description:</strong> Clear the terminal screen, including the visible session history and scrollback within the CLI. The underlying session data (for history recall) might be preserved depending on the exact implementation, but the visual display is cleared.</li>
<li>
<p><strong>Keyboard shortcut:</strong> Press <strong>Ctrl+L</strong> at any time to perform a clear action.</p>
</li>
<li>
<p><strong><code>/compress</code></strong></p>
</li>
<li>
<p><strong>Description:</strong> Replace the entire chat context with a summary. This saves on tokens used for future tasks while retaining a high level summary of what has happened.</p>
</li>
<li>
<p><strong><code>/copy</code></strong></p>
</li>
<li>
<p><strong>Description:</strong> Copies the last output produced by Gemini CLI to your clipboard, for easy sharing or reuse.</p>
</li>
<li>
<p><strong><code>/directory</code></strong> (or <strong><code>/dir</code></strong>)</p>
</li>
<li><strong>Description:</strong> Manage workspace directories for multi-directory support.</li>
<li>
<p><strong>Sub-commands:</strong></p>
<ul>
<li><strong><code>add</code></strong>:</li>
<li><strong>Description:</strong> Add a directory to the workspace. The path can be absolute or relative to the current working directory. Moreover, the reference from home directory is supported as well.</li>
<li><strong>Usage:</strong> <code>/directory add &lt;path1&gt;,&lt;path2&gt;</code></li>
<li><strong>Note:</strong> Disabled in restrictive sandbox profiles. If you're using that, use <code>--include-directories</code> when starting the session instead.</li>
<li><strong><code>show</code></strong>:</li>
<li><strong>Description:</strong> Display all directories added by <code>/directory add</code> and <code>--include-directories</code>.</li>
<li><strong>Usage:</strong> <code>/directory show</code></li>
</ul>
</li>
<li>
<p><strong><code>/editor</code></strong></p>
</li>
<li>
<p><strong>Description:</strong> Open a dialog for selecting supported editors.</p>
</li>
<li>
<p><strong><code>/extensions</code></strong></p>
</li>
<li>
<p><strong>Description:</strong> Lists all active extensions in the current Gemini CLI session. See <a href="../extension.md">Gemini CLI Extensions</a>.</p>
</li>
<li>
<p><strong><code>/help</code></strong> (or <strong><code>/?</code></strong>)</p>
</li>
<li>
<p><strong>Description:</strong> Display help information about Gemini CLI, including available commands and their usage.</p>
</li>
<li>
<p><strong><code>/mcp</code></strong></p>
</li>
<li><strong>Description:</strong> List configured Model Context Protocol (MCP) servers, their connection status, server details, and available tools.</li>
<li><strong>Sub-commands:</strong><ul>
<li><strong><code>desc</code></strong> or <strong><code>descriptions</code></strong>:</li>
<li><strong>Description:</strong> Show detailed descriptions for MCP servers and tools.</li>
<li><strong><code>nodesc</code></strong> or <strong><code>nodescriptions</code></strong>:</li>
<li><strong>Description:</strong> Hide tool descriptions, showing only the tool names.</li>
<li><strong><code>schema</code></strong>:</li>
<li><strong>Description:</strong> Show the full JSON schema for the tool's configured parameters.</li>
</ul>
</li>
<li>
<p><strong>Keyboard Shortcut:</strong> Press <strong>Ctrl+T</strong> at any time to toggle between showing and hiding tool descriptions.</p>
</li>
<li>
<p><strong><code>/memory</code></strong></p>
</li>
<li><strong>Description:</strong> Manage the AI's instructional context (hierarchical memory loaded from <code>GEMINI.md</code> files).</li>
<li>
<p><strong>Sub-commands:</strong></p>
<ul>
<li><strong><code>add</code></strong>:</li>
<li><strong>Description:</strong> Adds the following text to the AI's memory. Usage: <code>/memory add &lt;text to remember&gt;</code></li>
<li><strong><code>show</code></strong>:</li>
<li><strong>Description:</strong> Display the full, concatenated content of the current hierarchical memory that has been loaded from all <code>GEMINI.md</code> files. This lets you inspect the instructional context being provided to the Gemini model.</li>
<li><strong><code>refresh</code></strong>:</li>
<li><strong>Description:</strong> Reload the hierarchical instructional memory from all <code>GEMINI.md</code> files found in the configured locations (global, project/ancestors, and sub-directories). This command updates the model with the latest <code>GEMINI.md</code> content.</li>
<li><strong>Note:</strong> For more details on how <code>GEMINI.md</code> files contribute to hierarchical memory, see the <a href="./configuration.md#4-geminimd-files-hierarchical-instructional-context">CLI Configuration documentation</a>.</li>
</ul>
</li>
<li>
<p><strong><code>/restore</code></strong></p>
</li>
<li><strong>Description:</strong> Restores the project files to the state they were in just before a tool was executed. This is particularly useful for undoing file edits made by a tool. If run without a tool call ID, it will list available checkpoints to restore from.</li>
<li><strong>Usage:</strong> <code>/restore [tool_call_id]</code></li>
<li>
<p><strong>Note:</strong> Only available if the CLI is invoked with the <code>--checkpointing</code> option or configured via <a href="./configuration.md">settings</a>. See <a href="../checkpointing.md">Checkpointing documentation</a> for more details.</p>
</li>
<li>
<p><strong><code>/stats</code></strong></p>
</li>
<li>
<p><strong>Description:</strong> Display detailed statistics for the current Gemini CLI session, including token usage, cached token savings (when available), and session duration. Note: Cached token information is only displayed when cached tokens are being used, which occurs with API key authentication but not with OAuth authentication at this time.</p>
</li>
<li>
<p><a href="./themes.md"><strong><code>/theme</code></strong></a></p>
</li>
<li>
<p><strong>Description:</strong> Open a dialog that lets you change the visual theme of Gemini CLI.</p>
</li>
<li>
<p><strong><code>/auth</code></strong></p>
</li>
<li>
<p><strong>Description:</strong> Open a dialog that lets you change the authentication method.</p>
</li>
<li>
<p><strong><code>/about</code></strong></p>
</li>
<li>
<p><strong>Description:</strong> Show version info. Please share this information when filing issues.</p>
</li>
<li>
<p><a href="../tools/index.md"><strong><code>/tools</code></strong></a></p>
</li>
<li><strong>Description:</strong> Display a list of tools that are currently available within Gemini CLI.</li>
<li>
<p><strong>Sub-commands:</strong></p>
<ul>
<li><strong><code>desc</code></strong> or <strong><code>descriptions</code></strong>:</li>
<li><strong>Description:</strong> Show detailed descriptions of each tool, including each tool's name with its full description as provided to the model.</li>
<li><strong><code>nodesc</code></strong> or <strong><code>nodescriptions</code></strong>:</li>
<li><strong>Description:</strong> Hide tool descriptions, showing only the tool names.</li>
</ul>
</li>
<li>
<p><strong><code>/privacy</code></strong></p>
</li>
<li>
<p><strong>Description:</strong> Display the Privacy Notice and allow users to select whether they consent to the collection of their data for service improvement purposes.</p>
</li>
<li>
<p><strong><code>/quit</code></strong> (or <strong><code>/exit</code></strong>)</p>
</li>
<li>
<p><strong>Description:</strong> Exit Gemini CLI.</p>
</li>
<li>
<p><strong><code>/vim</code></strong></p>
</li>
<li><strong>Description:</strong> Toggle vim mode on or off. When vim mode is enabled, the input area supports vim-style navigation and editing commands in both NORMAL and INSERT modes.</li>
<li><strong>Features:</strong><ul>
<li><strong>NORMAL mode:</strong> Navigate with <code>h</code>, <code>j</code>, <code>k</code>, <code>l</code>; jump by words with <code>w</code>, <code>b</code>, <code>e</code>; go to line start/end with <code>0</code>, <code>$</code>, <code>^</code>; go to specific lines with <code>G</code> (or <code>gg</code> for first line)</li>
<li><strong>INSERT mode:</strong> Standard text input with escape to return to NORMAL mode</li>
<li><strong>Editing commands:</strong> Delete with <code>x</code>, change with <code>c</code>, insert with <code>i</code>, <code>a</code>, <code>o</code>, <code>O</code>; complex operations like <code>dd</code>, <code>cc</code>, <code>dw</code>, <code>cw</code></li>
<li><strong>Count support:</strong> Prefix commands with numbers (e.g., <code>3h</code>, <code>5w</code>, <code>10G</code>)</li>
<li><strong>Repeat last command:</strong> Use <code>.</code> to repeat the last editing operation</li>
<li><strong>Persistent setting:</strong> Vim mode preference is saved to <code>~/.gemini/settings.json</code> and restored between sessions</li>
</ul>
</li>
<li>
<p><strong>Status indicator:</strong> When enabled, shows <code>[NORMAL]</code> or <code>[INSERT]</code> in the footer</p>
</li>
<li>
<p><strong><code>/init</code></strong></p>
</li>
<li><strong>Description:</strong> To help users easily create a <code>GEMINI.md</code> file, this command analyzes the current directory and generates a tailored context file, making it simpler for them to provide project-specific instructions to the Gemini agent.</li>
</ul>
<h3 id="custom-commands">Custom Commands</h3>
<p>For a quick start, see the <a href="#example-a-pure-function-refactoring-command">example</a> below.</p>
<p>Custom commands allow you to save and reuse your favorite or most frequently used prompts as personal shortcuts within Gemini CLI. You can create commands that are specific to a single project or commands that are available globally across all your projects, streamlining your workflow and ensuring consistency.</p>
<h4 id="file-locations-precedence">File Locations &amp; Precedence</h4>
<p>Gemini CLI discovers commands from two locations, loaded in a specific order:</p>
<ol>
<li><strong>User Commands (Global):</strong> Located in <code>~/.gemini/commands/</code>. These commands are available in any project you are working on.</li>
<li><strong>Project Commands (Local):</strong> Located in <code>&lt;your-project-root&gt;/.gemini/commands/</code>. These commands are specific to the current project and can be checked into version control to be shared with your team.</li>
</ol>
<p>If a command in the project directory has the same name as a command in the user directory, the <strong>project command will always be used.</strong> This allows projects to override global commands with project-specific versions.</p>
<h4 id="naming-and-namespacing">Naming and Namespacing</h4>
<p>The name of a command is determined by its file path relative to its <code>commands</code> directory. Subdirectories are used to create namespaced commands, with the path separator (<code>/</code> or <code>\</code>) being converted to a colon (<code>:</code>).</p>
<ul>
<li>A file at <code>~/.gemini/commands/test.toml</code> becomes the command <code>/test</code>.</li>
<li>A file at <code>&lt;project&gt;/.gemini/commands/git/commit.toml</code> becomes the namespaced command <code>/git:commit</code>.</li>
</ul>
<h4 id="toml-file-format-v1">TOML File Format (v1)</h4>
<p>Your command definition files must be written in the TOML format and use the <code>.toml</code> file extension.</p>
<h5 id="required-fields">Required Fields</h5>
<ul>
<li><code>prompt</code> (String): The prompt that will be sent to the Gemini model when the command is executed. This can be a single-line or multi-line string.</li>
</ul>
<h5 id="optional-fields">Optional Fields</h5>
<ul>
<li><code>description</code> (String): A brief, one-line description of what the command does. This text will be displayed next to your command in the <code>/help</code> menu. <strong>If you omit this field, a generic description will be generated from the filename.</strong></li>
</ul>
<h4 id="handling-arguments">Handling Arguments</h4>
<p>Custom commands support two powerful, low-friction methods for handling arguments. The CLI automatically chooses the correct method based on the content of your command's <code>prompt</code>.</p>
<h5 id="1-shorthand-injection-with-args">1. Shorthand Injection with <code>{{args}}</code></h5>
<p>If your <code>prompt</code> contains the special placeholder <code>{{args}}</code>, the CLI will replace that exact placeholder with all the text the user typed after the command name. This is perfect for simple, deterministic commands where you need to inject user input into a specific place in a larger prompt template.</p>
<p><strong>Example (<code>git/fix.toml</code>):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In: ~/.gemini/commands/git/fix.toml</span>
<span class="c1"># Invoked via: /git:fix &quot;Button is misaligned on mobile&quot;</span>

<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Generates a fix for a given GitHub issue.&quot;</span>
<span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Please analyze the staged git changes and provide a code fix for the issue described here: {{args}}.&quot;</span>
</code></pre></div>

<p>The model will receive the final prompt: <code>Please analyze the staged git changes and provide a code fix for the issue described here: "Button is misaligned on mobile".</code></p>
<h5 id="2-default-argument-handling">2. Default Argument Handling</h5>
<p>If your <code>prompt</code> does <strong>not</strong> contain the special placeholder <code>{{args}}</code>, the CLI uses a default behavior for handling arguments.</p>
<p>If you provide arguments to the command (e.g., <code>/mycommand arg1</code>), the CLI will append the full command you typed to the end of the prompt, separated by two newlines. This allows the model to see both the original instructions and the specific arguments you just provided.</p>
<p>If you do <strong>not</strong> provide any arguments (e.g., <code>/mycommand</code>), the prompt is sent to the model exactly as it is, with nothing appended.</p>
<p><strong>Example (<code>changelog.toml</code>):</strong></p>
<p>This example shows how to create a robust command by defining a role for the model, explaining where to find the user's input, and specifying the expected format and behavior.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In: &lt;project&gt;/.gemini/commands/changelog.toml</span>
<span class="c1"># Invoked via: /changelog 1.2.0 added &quot;Support for default argument parsing.&quot;</span>

<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Adds a new entry to the project&#39;s CHANGELOG.md file.&quot;</span>
<span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># Task: Update Changelog</span>

<span class="s2">You are an expert maintainer of this software project. A user has invoked a command to add a new entry to the changelog.</span>

<span class="s2">**The user&#39;s raw command is appended below your instructions.**</span>

<span class="s2">Your task is to parse the `&lt;version&gt;`, `&lt;change_type&gt;`, and `&lt;message&gt;` from their input and use the `write_file` tool to correctly update the `CHANGELOG.md` file.</span>

<span class="s2">## Expected Format</span>
<span class="s2">The command follows this format: `/changelog &lt;version&gt; &lt;type&gt; &lt;message&gt;`</span>
<span class="s2">- `&lt;type&gt;` must be one of: &quot;added&quot;, &quot;changed&quot;, &quot;fixed&quot;, &quot;removed&quot;.</span>

<span class="s2">## Behavior</span>
<span class="s2">1. Read the `CHANGELOG.md` file.</span>
<span class="s2">2. Find the section for the specified `&lt;version&gt;`.</span>
<span class="s2">3. Add the `&lt;message&gt;` under the correct `&lt;type&gt;` heading.</span>
<span class="s2">4. If the version or type section doesn&#39;t exist, create it.</span>
<span class="s2">5. Adhere strictly to the &quot;Keep a Changelog&quot; format.</span>
<span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>

<p>When you run <code>/changelog 1.2.0 added "New feature"</code>, the final text sent to the model will be the original prompt followed by two newlines and the command you typed.</p>
<h5 id="3-executing-shell-commands-with">3. Executing Shell Commands with <code>!{...}</code></h5>
<p>You can make your commands dynamic by executing shell commands directly within your <code>prompt</code> and injecting their output. This is ideal for gathering context from your local environment, like reading file content or checking the status of Git.</p>
<p>When a custom command attempts to execute a shell command, Gemini CLI will now prompt you for confirmation before proceeding. This is a security measure to ensure that only intended commands can be run.</p>
<p><strong>How It Works:</strong></p>
<ol>
<li><strong>Inject Commands:</strong> Use the <code>!{...}</code> syntax in your <code>prompt</code> to specify where the command should be run and its output injected.</li>
<li><strong>Confirm Execution:</strong> When you run the command, a dialog will appear listing the shell commands the prompt wants to execute.</li>
<li><strong>Grant Permission:</strong> You can choose to:<ul>
<li><strong>Allow once:</strong> The command(s) will run this one time.</li>
<li><strong>Allow always for this session:</strong> The command(s) will be added to a temporary allowlist for the current CLI session and will not require confirmation again.</li>
<li><strong>No:</strong> Cancel the execution of the shell command(s).</li>
</ul>
</li>
</ol>
<p>The CLI still respects the global <code>excludeTools</code> and <code>coreTools</code> settings. A command will be blocked without a confirmation prompt if it is explicitly disallowed in your configuration.</p>
<p><strong>Example (<code>git/commit.toml</code>):</strong></p>
<p>This command gets the staged git diff and uses it to ask the model to write a commit message.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In: &lt;project&gt;/.gemini/commands/git/commit.toml</span>
<span class="c1"># Invoked via: /git:commit</span>

<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Generates a Git commit message based on staged changes.&quot;</span>

<span class="c1"># The prompt uses !{...} to execute the command and inject its output.</span>
<span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Please generate a Conventional Commit message based on the following git diff:</span>

<span class="s2">```diff</span>
<span class="s2">!{git diff --staged}</span>
<span class="s2">```</span>

<span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>

<p>When you run <code>/git:commit</code>, the CLI first executes <code>git diff --staged</code>, then replaces <code>!{git diff --staged}</code> with the output of that command before sending the final, complete prompt to the model.</p>
<hr />
<h4 id="example-a-pure-function-refactoring-command">Example: A "Pure Function" Refactoring Command</h4>
<p>Let's create a global command that asks the model to refactor a piece of code.</p>
<p><strong>1. Create the file and directories:</strong></p>
<p>First, ensure the user commands directory exists, then create a <code>refactor</code> subdirectory for organization and the final TOML file.</p>
<div class="codehilite"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.gemini/commands/refactor
touch<span class="w"> </span>~/.gemini/commands/refactor/pure.toml
</code></pre></div>

<p><strong>2. Add the content to the file:</strong></p>
<p>Open <code>~/.gemini/commands/refactor/pure.toml</code> in your editor and add the following content. We are including the optional <code>description</code> for best practice.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># In: ~/.gemini/commands/refactor/pure.toml</span>
<span class="c1"># This command will be invoked via: /refactor:pure</span>

<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Asks the model to refactor the current context into a pure function.&quot;</span>

<span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Please analyze the code I&#39;ve provided in the current context.</span>
<span class="s2">Refactor it into a pure function.</span>

<span class="s2">Your response should include:</span>
<span class="s2">1. The refactored, pure function code block.</span>
<span class="s2">2. A brief explanation of the key changes you made and why they contribute to purity.</span>
<span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>

<p><strong>3. Run the Command:</strong></p>
<p>That's it! You can now run your command in the CLI. First, you might add a file to the context, and then invoke your command:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="nv">@my</span><span class="o">-</span><span class="n">messy</span><span class="o">-</span><span class="k">function</span><span class="p">.</span><span class="n">js</span>
<span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="nl">refactor</span><span class="p">:</span><span class="n">pure</span>
</code></pre></div>

<p>Gemini CLI will then execute the multi-line prompt defined in your TOML file.</p>
<h2 id="at-commands">At commands (<code>@</code>)</h2>
<p>At commands are used to include the content of files or directories as part of your prompt to Gemini. These commands include git-aware filtering.</p>
<ul>
<li><strong><code>@&lt;path_to_file_or_directory&gt;</code></strong></li>
<li><strong>Description:</strong> Inject the content of the specified file or files into your current prompt. This is useful for asking questions about specific code, text, or collections of files.</li>
<li><strong>Examples:</strong><ul>
<li><code>@path/to/your/file.txt Explain this text.</code></li>
<li><code>@src/my_project/ Summarize the code in this directory.</code></li>
<li><code>What is this file about? @README.md</code></li>
</ul>
</li>
<li><strong>Details:</strong><ul>
<li>If a path to a single file is provided, the content of that file is read.</li>
<li>If a path to a directory is provided, the command attempts to read the content of files within that directory and any subdirectories.</li>
<li>Spaces in paths should be escaped with a backslash (e.g., <code>@My\ Documents/file.txt</code>).</li>
<li>The command uses the <code>read_many_files</code> tool internally. The content is fetched and then inserted into your query before being sent to the Gemini model.</li>
<li><strong>Git-aware filtering:</strong> By default, git-ignored files (like <code>node_modules/</code>, <code>dist/</code>, <code>.env</code>, <code>.git/</code>) are excluded. This behavior can be changed via the <code>fileFiltering</code> settings.</li>
<li><strong>File types:</strong> The command is intended for text-based files. While it might attempt to read any file, binary files or very large files might be skipped or truncated by the underlying <code>read_many_files</code> tool to ensure performance and relevance. The tool indicates if files were skipped.</li>
</ul>
</li>
<li>
<p><strong>Output:</strong> The CLI will show a tool call message indicating that <code>read_many_files</code> was used, along with a message detailing the status and the path(s) that were processed.</p>
</li>
<li>
<p><strong><code>@</code> (Lone at symbol)</strong></p>
</li>
<li><strong>Description:</strong> If you type a lone <code>@</code> symbol without a path, the query is passed as-is to the Gemini model. This might be useful if you are specifically talking <em>about</em> the <code>@</code> symbol in your prompt.</li>
</ul>
<h3 id="error-handling-for-commands">Error handling for <code>@</code> commands</h3>
<ul>
<li>If the path specified after <code>@</code> is not found or is invalid, an error message will be displayed, and the query might not be sent to the Gemini model, or it will be sent without the file content.</li>
<li>If the <code>read_many_files</code> tool encounters an error (e.g., permission issues), this will also be reported.</li>
</ul>
<h2 id="shell-mode-passthrough-commands">Shell mode &amp; passthrough commands (<code>!</code>)</h2>
<p>The <code>!</code> prefix lets you interact with your system's shell directly from within Gemini CLI.</p>
<ul>
<li><strong><code>!&lt;shell_command&gt;</code></strong></li>
<li><strong>Description:</strong> Execute the given <code>&lt;shell_command&gt;</code> using <code>bash</code> on Linux/macOS or <code>cmd.exe</code> on Windows. Any output or errors from the command are displayed in the terminal.</li>
<li>
<p><strong>Examples:</strong></p>
<ul>
<li><code>!ls -la</code> (executes <code>ls -la</code> and returns to Gemini CLI)</li>
<li><code>!git status</code> (executes <code>git status</code> and returns to Gemini CLI)</li>
</ul>
</li>
<li>
<p><strong><code>!</code> (Toggle shell mode)</strong></p>
</li>
<li>
<p><strong>Description:</strong> Typing <code>!</code> on its own toggles shell mode.</p>
<ul>
<li><strong>Entering shell mode:</strong></li>
<li>When active, shell mode uses a different coloring and a "Shell Mode Indicator".</li>
<li>While in shell mode, text you type is interpreted directly as a shell command.</li>
<li><strong>Exiting shell mode:</strong></li>
<li>When exited, the UI reverts to its standard appearance and normal Gemini CLI behavior resumes.</li>
</ul>
</li>
<li>
<p><strong>Caution for all <code>!</code> usage:</strong> Commands you execute in shell mode have the same permissions and impact as if you ran them directly in your terminal.</p>
</li>
<li>
<p><strong>Environment Variable:</strong> When a command is executed via <code>!</code> or in shell mode, the <code>GEMINI_CLI=1</code> environment variable is set in the subprocess's environment. This allows scripts or tools to detect if they are being run from within the Gemini CLI.</p>
</li>
</ul>
<p>‚îú‚îÄ‚îÄ configuration.md
    Content:</p>
<h1 id="gemini-cli-configuration">Gemini CLI Configuration</h1>
<p>Gemini CLI offers several ways to configure its behavior, including environment variables, command-line arguments, and settings files. This document outlines the different configuration methods and available settings.</p>
<h2 id="configuration-layers">Configuration layers</h2>
<p>Configuration is applied in the following order of precedence (lower numbers are overridden by higher numbers):</p>
<ol>
<li><strong>Default values:</strong> Hardcoded defaults within the application.</li>
<li><strong>User settings file:</strong> Global settings for the current user.</li>
<li><strong>Project settings file:</strong> Project-specific settings.</li>
<li><strong>System settings file:</strong> System-wide settings.</li>
<li><strong>Environment variables:</strong> System-wide or session-specific variables, potentially loaded from <code>.env</code> files.</li>
<li><strong>Command-line arguments:</strong> Values passed when launching the CLI.</li>
</ol>
<h2 id="settings-files">Settings files</h2>
<p>Gemini CLI uses <code>settings.json</code> files for persistent configuration. There are three locations for these files:</p>
<ul>
<li><strong>User settings file:</strong></li>
<li><strong>Location:</strong> <code>~/.gemini/settings.json</code> (where <code>~</code> is your home directory).</li>
<li><strong>Scope:</strong> Applies to all Gemini CLI sessions for the current user.</li>
<li><strong>Project settings file:</strong></li>
<li><strong>Location:</strong> <code>.gemini/settings.json</code> within your project's root directory.</li>
<li><strong>Scope:</strong> Applies only when running Gemini CLI from that specific project. Project settings override user settings.</li>
<li><strong>System settings file:</strong></li>
<li><strong>Location:</strong> <code>/etc/gemini-cli/settings.json</code> (Linux), <code>C:\ProgramData\gemini-cli\settings.json</code> (Windows) or <code>/Library/Application Support/GeminiCli/settings.json</code> (macOS). The path can be overridden using the <code>GEMINI_CLI_SYSTEM_SETTINGS_PATH</code> environment variable.</li>
<li><strong>Scope:</strong> Applies to all Gemini CLI sessions on the system, for all users. System settings override user and project settings. May be useful for system administrators at enterprises to have controls over users' Gemini CLI setups.</li>
</ul>
<p><strong>Note on environment variables in settings:</strong> String values within your <code>settings.json</code> files can reference environment variables using either <code>$VAR_NAME</code> or <code>${VAR_NAME}</code> syntax. These variables will be automatically resolved when the settings are loaded. For example, if you have an environment variable <code>MY_API_TOKEN</code>, you could use it in <code>settings.json</code> like this: <code>"apiKey": "$MY_API_TOKEN"</code>.</p>
<h3 id="the-gemini-directory-in-your-project">The <code>.gemini</code> directory in your project</h3>
<p>In addition to a project settings file, a project's <code>.gemini</code> directory can contain other project-specific files related to Gemini CLI's operation, such as:</p>
<ul>
<li><a href="#sandboxing">Custom sandbox profiles</a> (e.g., <code>.gemini/sandbox-macos-custom.sb</code>, <code>.gemini/sandbox.Dockerfile</code>).</li>
</ul>
<h3 id="available-settings-in-settingsjson">Available settings in <code>settings.json</code>:</h3>
<ul>
<li><strong><code>contextFileName</code></strong> (string or array of strings):</li>
<li><strong>Description:</strong> Specifies the filename for context files (e.g., <code>GEMINI.md</code>, <code>AGENTS.md</code>). Can be a single filename or a list of accepted filenames.</li>
<li><strong>Default:</strong> <code>GEMINI.md</code></li>
<li>
<p><strong>Example:</strong> <code>"contextFileName": "AGENTS.md"</code></p>
</li>
<li>
<p><strong><code>bugCommand</code></strong> (object):</p>
</li>
<li><strong>Description:</strong> Overrides the default URL for the <code>/bug</code> command.</li>
<li><strong>Default:</strong> <code>"urlTemplate": "https://github.com/google-gemini/gemini-cli/issues/new?template=bug_report.yml&amp;title={title}&amp;info={info}"</code></li>
<li><strong>Properties:</strong><ul>
<li><strong><code>urlTemplate</code></strong> (string): A URL that can contain <code>{title}</code> and <code>{info}</code> placeholders.</li>
</ul>
</li>
<li>
<p><strong>Example:</strong>
    <code>json
    "bugCommand": {
      "urlTemplate": "https://bug.example.com/new?title={title}&amp;info={info}"
    }</code></p>
</li>
<li>
<p><strong><code>fileFiltering</code></strong> (object):</p>
</li>
<li><strong>Description:</strong> Controls git-aware file filtering behavior for @ commands and file discovery tools.</li>
<li><strong>Default:</strong> <code>"respectGitIgnore": true, "enableRecursiveFileSearch": true</code></li>
<li><strong>Properties:</strong><ul>
<li><strong><code>respectGitIgnore</code></strong> (boolean): Whether to respect .gitignore patterns when discovering files. When set to <code>true</code>, git-ignored files (like <code>node_modules/</code>, <code>dist/</code>, <code>.env</code>) are automatically excluded from @ commands and file listing operations.</li>
<li><strong><code>enableRecursiveFileSearch</code></strong> (boolean): Whether to enable searching recursively for filenames under the current tree when completing @ prefixes in the prompt.</li>
</ul>
</li>
<li>
<p><strong>Example:</strong>
    <code>json
    "fileFiltering": {
      "respectGitIgnore": true,
      "enableRecursiveFileSearch": false
    }</code></p>
</li>
<li>
<p><strong><code>coreTools</code></strong> (array of strings):</p>
</li>
<li><strong>Description:</strong> Allows you to specify a list of core tool names that should be made available to the model. This can be used to restrict the set of built-in tools. See <a href="../core/tools-api.md#built-in-tools">Built-in Tools</a> for a list of core tools. You can also specify command-specific restrictions for tools that support it, like the <code>ShellTool</code>. For example, <code>"coreTools": ["ShellTool(ls -l)"]</code> will only allow the <code>ls -l</code> command to be executed.</li>
<li><strong>Default:</strong> All tools available for use by the Gemini model.</li>
<li>
<p><strong>Example:</strong> <code>"coreTools": ["ReadFileTool", "GlobTool", "ShellTool(ls)"]</code>.</p>
</li>
<li>
<p><strong><code>excludeTools</code></strong> (array of strings):</p>
</li>
<li><strong>Description:</strong> Allows you to specify a list of core tool names that should be excluded from the model. A tool listed in both <code>excludeTools</code> and <code>coreTools</code> is excluded. You can also specify command-specific restrictions for tools that support it, like the <code>ShellTool</code>. For example, <code>"excludeTools": ["ShellTool(rm -rf)"]</code> will block the <code>rm -rf</code> command.</li>
<li><strong>Default</strong>: No tools excluded.</li>
<li><strong>Example:</strong> <code>"excludeTools": ["run_shell_command", "findFiles"]</code>.</li>
<li>
<p><strong>Security Note:</strong> Command-specific restrictions in
    <code>excludeTools</code> for <code>run_shell_command</code> are based on simple string matching and can be easily bypassed. This feature is <strong>not a security mechanism</strong> and should not be relied upon to safely execute untrusted code. It is recommended to use <code>coreTools</code> to explicitly select commands
    that can be executed.</p>
</li>
<li>
<p><strong><code>allowMCPServers</code></strong> (array of strings):</p>
</li>
<li><strong>Description:</strong> Allows you to specify a list of MCP server names that should be made available to the model. This can be used to restrict the set of MCP servers to connect to. Note that this will be ignored if <code>--allowed-mcp-server-names</code> is set.</li>
<li><strong>Default:</strong> All MCP servers are available for use by the Gemini model.</li>
<li><strong>Example:</strong> <code>"allowMCPServers": ["myPythonServer"]</code>.</li>
<li>
<p><strong>Security Note:</strong> This uses simple string matching on MCP server names, which can be modified. If you're a system administrator looking to prevent users from bypassing this, consider configuring the <code>mcpServers</code> at the system settings level such that the user will not be able to configure any MCP servers of their own. This should not be used as an airtight security mechanism.</p>
</li>
<li>
<p><strong><code>excludeMCPServers</code></strong> (array of strings):</p>
</li>
<li><strong>Description:</strong> Allows you to specify a list of MCP server names that should be excluded from the model. A server listed in both <code>excludeMCPServers</code> and <code>allowMCPServers</code> is excluded. Note that this will be ignored if <code>--allowed-mcp-server-names</code> is set.</li>
<li><strong>Default</strong>: No MCP servers excluded.</li>
<li><strong>Example:</strong> <code>"excludeMCPServers": ["myNodeServer"]</code>.</li>
<li>
<p><strong>Security Note:</strong> This uses simple string matching on MCP server names, which can be modified. If you're a system administrator looking to prevent users from bypassing this, consider configuring the <code>mcpServers</code> at the system settings level such that the user will not be able to configure any MCP servers of their own. This should not be used as an airtight security mechanism.</p>
</li>
<li>
<p><strong><code>autoAccept</code></strong> (boolean):</p>
</li>
<li><strong>Description:</strong> Controls whether the CLI automatically accepts and executes tool calls that are considered safe (e.g., read-only operations) without explicit user confirmation. If set to <code>true</code>, the CLI will bypass the confirmation prompt for tools deemed safe.</li>
<li><strong>Default:</strong> <code>false</code></li>
<li>
<p><strong>Example:</strong> <code>"autoAccept": true</code></p>
</li>
<li>
<p><strong><code>theme</code></strong> (string):</p>
</li>
<li><strong>Description:</strong> Sets the visual <a href="./themes.md">theme</a> for Gemini CLI.</li>
<li><strong>Default:</strong> <code>"Default"</code></li>
<li>
<p><strong>Example:</strong> <code>"theme": "GitHub"</code></p>
</li>
<li>
<p><strong><code>vimMode</code></strong> (boolean):</p>
</li>
<li><strong>Description:</strong> Enables or disables vim mode for input editing. When enabled, the input area supports vim-style navigation and editing commands with NORMAL and INSERT modes. The vim mode status is displayed in the footer and persists between sessions.</li>
<li><strong>Default:</strong> <code>false</code></li>
<li>
<p><strong>Example:</strong> <code>"vimMode": true</code></p>
</li>
<li>
<p><strong><code>sandbox</code></strong> (boolean or string):</p>
</li>
<li><strong>Description:</strong> Controls whether and how to use sandboxing for tool execution. If set to <code>true</code>, Gemini CLI uses a pre-built <code>gemini-cli-sandbox</code> Docker image. For more information, see <a href="#sandboxing">Sandboxing</a>.</li>
<li><strong>Default:</strong> <code>false</code></li>
<li>
<p><strong>Example:</strong> <code>"sandbox": "docker"</code></p>
</li>
<li>
<p><strong><code>toolDiscoveryCommand</code></strong> (string):</p>
</li>
<li><strong>Description:</strong> Defines a custom shell command for discovering tools from your project. The shell command must return on <code>stdout</code> a JSON array of <a href="https://ai.google.dev/gemini-api/docs/function-calling#function-declarations">function declarations</a>. Tool wrappers are optional.</li>
<li><strong>Default:</strong> Empty</li>
<li>
<p><strong>Example:</strong> <code>"toolDiscoveryCommand": "bin/get_tools"</code></p>
</li>
<li>
<p><strong><code>toolCallCommand</code></strong> (string):</p>
</li>
<li><strong>Description:</strong> Defines a custom shell command for calling a specific tool that was discovered using <code>toolDiscoveryCommand</code>. The shell command must meet the following criteria:<ul>
<li>It must take function <code>name</code> (exactly as in <a href="https://ai.google.dev/gemini-api/docs/function-calling#function-declarations">function declaration</a>) as first command line argument.</li>
<li>It must read function arguments as JSON on <code>stdin</code>, analogous to <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/inference#functioncall"><code>functionCall.args</code></a>.</li>
<li>It must return function output as JSON on <code>stdout</code>, analogous to <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/inference#functionresponse"><code>functionResponse.response.content</code></a>.</li>
</ul>
</li>
<li><strong>Default:</strong> Empty</li>
<li>
<p><strong>Example:</strong> <code>"toolCallCommand": "bin/call_tool"</code></p>
</li>
<li>
<p><strong><code>mcpServers</code></strong> (object):</p>
</li>
<li><strong>Description:</strong> Configures connections to one or more Model-Context Protocol (MCP) servers for discovering and using custom tools. Gemini CLI attempts to connect to each configured MCP server to discover available tools. If multiple MCP servers expose a tool with the same name, the tool names will be prefixed with the server alias you defined in the configuration (e.g., <code>serverAlias__actualToolName</code>) to avoid conflicts. Note that the system might strip certain schema properties from MCP tool definitions for compatibility.</li>
<li><strong>Default:</strong> Empty</li>
<li><strong>Properties:</strong><ul>
<li><strong><code>&lt;SERVER_NAME&gt;</code></strong> (object): The server parameters for the named server.</li>
<li><code>command</code> (string, required): The command to execute to start the MCP server.</li>
<li><code>args</code> (array of strings, optional): Arguments to pass to the command.</li>
<li><code>env</code> (object, optional): Environment variables to set for the server process.</li>
<li><code>cwd</code> (string, optional): The working directory in which to start the server.</li>
<li><code>timeout</code> (number, optional): Timeout in milliseconds for requests to this MCP server.</li>
<li><code>trust</code> (boolean, optional): Trust this server and bypass all tool call confirmations.</li>
<li><code>includeTools</code> (array of strings, optional): List of tool names to include from this MCP server. When specified, only the tools listed here will be available from this server (whitelist behavior). If not specified, all tools from the server are enabled by default.</li>
<li><code>excludeTools</code> (array of strings, optional): List of tool names to exclude from this MCP server. Tools listed here will not be available to the model, even if they are exposed by the server. <strong>Note:</strong> <code>excludeTools</code> takes precedence over <code>includeTools</code> - if a tool is in both lists, it will be excluded.</li>
</ul>
</li>
<li>
<p><strong>Example:</strong>
    <code>json
    "mcpServers": {
      "myPythonServer": {
        "command": "python",
        "args": ["mcp_server.py", "--port", "8080"],
        "cwd": "./mcp_tools/python",
        "timeout": 5000,
        "includeTools": ["safe_tool", "file_reader"],
      },
      "myNodeServer": {
        "command": "node",
        "args": ["mcp_server.js"],
        "cwd": "./mcp_tools/node",
        "excludeTools": ["dangerous_tool", "file_deleter"]
      },
      "myDockerServer": {
        "command": "docker",
        "args": ["run", "-i", "--rm", "-e", "API_KEY", "ghcr.io/foo/bar"],
        "env": {
          "API_KEY": "$MY_API_TOKEN"
        }
      }
    }</code></p>
</li>
<li>
<p><strong><code>checkpointing</code></strong> (object):</p>
</li>
<li><strong>Description:</strong> Configures the checkpointing feature, which allows you to save and restore conversation and file states. See the <a href="../checkpointing.md">Checkpointing documentation</a> for more details.</li>
<li><strong>Default:</strong> <code>{"enabled": false}</code></li>
<li>
<p><strong>Properties:</strong></p>
<ul>
<li><strong><code>enabled</code></strong> (boolean): When <code>true</code>, the <code>/restore</code> command is available.</li>
</ul>
</li>
<li>
<p><strong><code>preferredEditor</code></strong> (string):</p>
</li>
<li><strong>Description:</strong> Specifies the preferred editor to use for viewing diffs.</li>
<li><strong>Default:</strong> <code>vscode</code></li>
<li>
<p><strong>Example:</strong> <code>"preferredEditor": "vscode"</code></p>
</li>
<li>
<p><strong><code>telemetry</code></strong> (object)</p>
</li>
<li><strong>Description:</strong> Configures logging and metrics collection for Gemini CLI. For more information, see <a href="../telemetry.md">Telemetry</a>.</li>
<li><strong>Default:</strong> <code>{"enabled": false, "target": "local", "otlpEndpoint": "http://localhost:4317", "logPrompts": true}</code></li>
<li><strong>Properties:</strong><ul>
<li><strong><code>enabled</code></strong> (boolean): Whether or not telemetry is enabled.</li>
<li><strong><code>target</code></strong> (string): The destination for collected telemetry. Supported values are <code>local</code> and <code>gcp</code>.</li>
<li><strong><code>otlpEndpoint</code></strong> (string): The endpoint for the OTLP Exporter.</li>
<li><strong><code>logPrompts</code></strong> (boolean): Whether or not to include the content of user prompts in the logs.</li>
</ul>
</li>
<li><strong>Example:</strong>
    <code>json
    "telemetry": {
      "enabled": true,
      "target": "local",
      "otlpEndpoint": "http://localhost:16686",
      "logPrompts": false
    }</code></li>
<li><strong><code>usageStatisticsEnabled</code></strong> (boolean):</li>
<li><strong>Description:</strong> Enables or disables the collection of usage statistics. See <a href="#usage-statistics">Usage Statistics</a> for more information.</li>
<li><strong>Default:</strong> <code>true</code></li>
<li>
<p><strong>Example:</strong>
    <code>json
    "usageStatisticsEnabled": false</code></p>
</li>
<li>
<p><strong><code>hideTips</code></strong> (boolean):</p>
</li>
<li><strong>Description:</strong> Enables or disables helpful tips in the CLI interface.</li>
<li><strong>Default:</strong> <code>false</code></li>
<li>
<p><strong>Example:</strong></p>
<p><code>json
"hideTips": true</code></p>
</li>
<li>
<p><strong><code>hideBanner</code></strong> (boolean):</p>
</li>
<li><strong>Description:</strong> Enables or disables the startup banner (ASCII art logo) in the CLI interface.</li>
<li><strong>Default:</strong> <code>false</code></li>
<li>
<p><strong>Example:</strong></p>
<p><code>json
"hideBanner": true</code></p>
</li>
<li>
<p><strong><code>maxSessionTurns</code></strong> (number):</p>
</li>
<li><strong>Description:</strong> Sets the maximum number of turns for a session. If the session exceeds this limit, the CLI will stop processing and start a new chat.</li>
<li><strong>Default:</strong> <code>-1</code> (unlimited)</li>
<li>
<p><strong>Example:</strong>
    <code>json
    "maxSessionTurns": 10</code></p>
</li>
<li>
<p><strong><code>summarizeToolOutput</code></strong> (object):</p>
</li>
<li><strong>Description:</strong> Enables or disables the summarization of tool output. You can specify the token budget for the summarization using the <code>tokenBudget</code> setting.</li>
<li>Note: Currently only the <code>run_shell_command</code> tool is supported.</li>
<li><strong>Default:</strong> <code>{}</code> (Disabled by default)</li>
<li>
<p><strong>Example:</strong>
    <code>json
    "summarizeToolOutput": {
      "run_shell_command": {
        "tokenBudget": 2000
      }
    }</code></p>
</li>
<li>
<p><strong><code>excludedProjectEnvVars</code></strong> (array of strings):</p>
</li>
<li><strong>Description:</strong> Specifies environment variables that should be excluded from being loaded from project <code>.env</code> files. This prevents project-specific environment variables (like <code>DEBUG=true</code>) from interfering with gemini-cli behavior. Variables from <code>.gemini/.env</code> files are never excluded.</li>
<li><strong>Default:</strong> <code>["DEBUG", "DEBUG_MODE"]</code></li>
<li>
<p><strong>Example:</strong>
    <code>json
    "excludedProjectEnvVars": ["DEBUG", "DEBUG_MODE", "NODE_ENV"]</code></p>
</li>
<li>
<p><strong><code>includeDirectories</code></strong> (array of strings):</p>
</li>
<li><strong>Description:</strong> Specifies an array of additional absolute or relative paths to include in the workspace context. This allows you to work with files across multiple directories as if they were one. Paths can use <code>~</code> to refer to the user's home directory. This setting can be combined with the <code>--include-directories</code> command-line flag.</li>
<li><strong>Default:</strong> <code>[]</code></li>
<li>
<p><strong>Example:</strong>
    <code>json
    "includeDirectories": [
      "/path/to/another/project",
      "../shared-library",
      "~/common-utils"
    ]</code></p>
</li>
<li>
<p><strong><code>loadMemoryFromIncludeDirectories</code></strong> (boolean):</p>
</li>
<li><strong>Description:</strong> Controls the behavior of the <code>/memory refresh</code> command. If set to <code>true</code>, <code>GEMINI.md</code> files should be loaded from all directories that are added. If set to <code>false</code>, <code>GEMINI.md</code> should only be loaded from the current directory.</li>
<li><strong>Default:</strong> <code>false</code></li>
<li>
<p><strong>Example:</strong>
    <code>json
    "loadMemoryFromIncludeDirectories": true</code></p>
</li>
<li>
<p><strong><code>chatCompression</code></strong> (object):</p>
</li>
<li><strong>Description:</strong> Controls the settings for chat history compression, both automatic and
    when manually invoked through the /compress command.</li>
<li><strong>Properties:</strong><ul>
<li><strong><code>contextPercentageThreshold</code></strong> (number): A value between 0 and 1 that specifies the token threshold for compression as a percentage of the model's total token limit. For example, a value of <code>0.6</code> will trigger compression when the chat history exceeds 60% of the token limit.</li>
</ul>
</li>
<li><strong>Example:</strong>
    <code>json
    "chatCompression": {
      "contextPercentageThreshold": 0.6
    }</code></li>
</ul>
<h3 id="example-settingsjson">Example <code>settings.json</code>:</h3>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;theme&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GitHub&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sandbox&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;toolDiscoveryCommand&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bin/get_tools&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;toolCallCommand&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bin/call_tool&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;mainServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bin/mcp_server.py&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;anotherServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;mcp_server.js&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--verbose&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;telemetry&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;otlpEndpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:4317&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;logPrompts&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;usageStatisticsEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hideTips&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hideBanner&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;maxSessionTurns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;summarizeToolOutput&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;run_shell_command&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;tokenBudget&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;excludedProjectEnvVars&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DEBUG_MODE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;NODE_ENV&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;includeDirectories&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;path/to/dir1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;~/path/to/dir2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;../path/to/dir3&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;loadMemoryFromIncludeDirectories&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="shell-history">Shell History</h2>
<p>The CLI keeps a history of shell commands you run. To avoid conflicts between different projects, this history is stored in a project-specific directory within your user's home folder.</p>
<ul>
<li><strong>Location:</strong> <code>~/.gemini/tmp/&lt;project_hash&gt;/shell_history</code></li>
<li><code>&lt;project_hash&gt;</code> is a unique identifier generated from your project's root path.</li>
<li>The history is stored in a file named <code>shell_history</code>.</li>
</ul>
<h2 id="environment-variables-env-files">Environment Variables &amp; <code>.env</code> Files</h2>
<p>Environment variables are a common way to configure applications, especially for sensitive information like API keys or for settings that might change between environments.</p>
<p>The CLI automatically loads environment variables from an <code>.env</code> file. The loading order is:</p>
<ol>
<li><code>.env</code> file in the current working directory.</li>
<li>If not found, it searches upwards in parent directories until it finds an <code>.env</code> file or reaches the project root (identified by a <code>.git</code> folder) or the home directory.</li>
<li>If still not found, it looks for <code>~/.env</code> (in the user's home directory).</li>
</ol>
<p><strong>Environment Variable Exclusion:</strong> Some environment variables (like <code>DEBUG</code> and <code>DEBUG_MODE</code>) are automatically excluded from being loaded from project <code>.env</code> files to prevent interference with gemini-cli behavior. Variables from <code>.gemini/.env</code> files are never excluded. You can customize this behavior using the <code>excludedProjectEnvVars</code> setting in your <code>settings.json</code> file.</p>
<ul>
<li><strong><code>GEMINI_API_KEY</code></strong> (Required):</li>
<li>Your API key for the Gemini API.</li>
<li><strong>Crucial for operation.</strong> The CLI will not function without it.</li>
<li>Set this in your shell profile (e.g., <code>~/.bashrc</code>, <code>~/.zshrc</code>) or an <code>.env</code> file.</li>
<li><strong><code>GEMINI_MODEL</code></strong>:</li>
<li>Specifies the default Gemini model to use.</li>
<li>Overrides the hardcoded default</li>
<li>Example: <code>export GEMINI_MODEL="gemini-2.5-flash"</code></li>
<li><strong><code>GOOGLE_API_KEY</code></strong>:</li>
<li>Your Google Cloud API key.</li>
<li>Required for using Vertex AI in express mode.</li>
<li>Ensure you have the necessary permissions.</li>
<li>Example: <code>export GOOGLE_API_KEY="YOUR_GOOGLE_API_KEY"</code>.</li>
<li><strong><code>GOOGLE_CLOUD_PROJECT</code></strong>:</li>
<li>Your Google Cloud Project ID.</li>
<li>Required for using Code Assist or Vertex AI.</li>
<li>If using Vertex AI, ensure you have the necessary permissions in this project.</li>
<li><strong>Cloud Shell Note:</strong> When running in a Cloud Shell environment, this variable defaults to a special project allocated for Cloud Shell users. If you have <code>GOOGLE_CLOUD_PROJECT</code> set in your global environment in Cloud Shell, it will be overridden by this default. To use a different project in Cloud Shell, you must define <code>GOOGLE_CLOUD_PROJECT</code> in a <code>.env</code> file.</li>
<li>Example: <code>export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"</code>.</li>
<li><strong><code>GOOGLE_APPLICATION_CREDENTIALS</code></strong> (string):</li>
<li><strong>Description:</strong> The path to your Google Application Credentials JSON file.</li>
<li><strong>Example:</strong> <code>export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/credentials.json"</code></li>
<li><strong><code>OTLP_GOOGLE_CLOUD_PROJECT</code></strong>:</li>
<li>Your Google Cloud Project ID for Telemetry in Google Cloud</li>
<li>Example: <code>export OTLP_GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"</code>.</li>
<li><strong><code>GOOGLE_CLOUD_LOCATION</code></strong>:</li>
<li>Your Google Cloud Project Location (e.g., us-central1).</li>
<li>Required for using Vertex AI in non express mode.</li>
<li>Example: <code>export GOOGLE_CLOUD_LOCATION="YOUR_PROJECT_LOCATION"</code>.</li>
<li><strong><code>GEMINI_SANDBOX</code></strong>:</li>
<li>Alternative to the <code>sandbox</code> setting in <code>settings.json</code>.</li>
<li>Accepts <code>true</code>, <code>false</code>, <code>docker</code>, <code>podman</code>, or a custom command string.</li>
<li><strong><code>SEATBELT_PROFILE</code></strong> (macOS specific):</li>
<li>Switches the Seatbelt (<code>sandbox-exec</code>) profile on macOS.</li>
<li><code>permissive-open</code>: (Default) Restricts writes to the project folder (and a few other folders, see <code>packages/cli/src/utils/sandbox-macos-permissive-open.sb</code>) but allows other operations.</li>
<li><code>strict</code>: Uses a strict profile that declines operations by default.</li>
<li><code>&lt;profile_name&gt;</code>: Uses a custom profile. To define a custom profile, create a file named <code>sandbox-macos-&lt;profile_name&gt;.sb</code> in your project's <code>.gemini/</code> directory (e.g., <code>my-project/.gemini/sandbox-macos-custom.sb</code>).</li>
<li><strong><code>DEBUG</code> or <code>DEBUG_MODE</code></strong> (often used by underlying libraries or the CLI itself):</li>
<li>Set to <code>true</code> or <code>1</code> to enable verbose debug logging, which can be helpful for troubleshooting.</li>
<li><strong>Note:</strong> These variables are automatically excluded from project <code>.env</code> files by default to prevent interference with gemini-cli behavior. Use <code>.gemini/.env</code> files if you need to set these for gemini-cli specifically.</li>
<li><strong><code>NO_COLOR</code></strong>:</li>
<li>Set to any value to disable all color output in the CLI.</li>
<li><strong><code>CLI_TITLE</code></strong>:</li>
<li>Set to a string to customize the title of the CLI.</li>
<li><strong><code>CODE_ASSIST_ENDPOINT</code></strong>:</li>
<li>Specifies the endpoint for the code assist server.</li>
<li>This is useful for development and testing.</li>
</ul>
<h2 id="command-line-arguments">Command-Line Arguments</h2>
<p>Arguments passed directly when running the CLI can override other configurations for that specific session.</p>
<ul>
<li><strong><code>--model &lt;model_name&gt;</code></strong> (<strong><code>-m &lt;model_name&gt;</code></strong>):</li>
<li>Specifies the Gemini model to use for this session.</li>
<li>Example: <code>npm start -- --model gemini-1.5-pro-latest</code></li>
<li><strong><code>--prompt &lt;your_prompt&gt;</code></strong> (<strong><code>-p &lt;your_prompt&gt;</code></strong>):</li>
<li>Used to pass a prompt directly to the command. This invokes Gemini CLI in a non-interactive mode.</li>
<li><strong><code>--prompt-interactive &lt;your_prompt&gt;</code></strong> (<strong><code>-i &lt;your_prompt&gt;</code></strong>):</li>
<li>Starts an interactive session with the provided prompt as the initial input.</li>
<li>The prompt is processed within the interactive session, not before it.</li>
<li>Cannot be used when piping input from stdin.</li>
<li>Example: <code>gemini -i "explain this code"</code></li>
<li><strong><code>--sandbox</code></strong> (<strong><code>-s</code></strong>):</li>
<li>Enables sandbox mode for this session.</li>
<li><strong><code>--sandbox-image</code></strong>:</li>
<li>Sets the sandbox image URI.</li>
<li><strong><code>--debug</code></strong> (<strong><code>-d</code></strong>):</li>
<li>Enables debug mode for this session, providing more verbose output.</li>
<li><strong><code>--all-files</code></strong> (<strong><code>-a</code></strong>):</li>
<li>If set, recursively includes all files within the current directory as context for the prompt.</li>
<li><strong><code>--help</code></strong> (or <strong><code>-h</code></strong>):</li>
<li>Displays help information about command-line arguments.</li>
<li><strong><code>--show-memory-usage</code></strong>:</li>
<li>Displays the current memory usage.</li>
<li><strong><code>--yolo</code></strong>:</li>
<li>Enables YOLO mode, which automatically approves all tool calls.</li>
<li><strong><code>--telemetry</code></strong>:</li>
<li>Enables <a href="../telemetry.md">telemetry</a>.</li>
<li><strong><code>--telemetry-target</code></strong>:</li>
<li>Sets the telemetry target. See <a href="../telemetry.md">telemetry</a> for more information.</li>
<li><strong><code>--telemetry-otlp-endpoint</code></strong>:</li>
<li>Sets the OTLP endpoint for telemetry. See <a href="../telemetry.md">telemetry</a> for more information.</li>
<li><strong><code>--telemetry-log-prompts</code></strong>:</li>
<li>Enables logging of prompts for telemetry. See <a href="../telemetry.md">telemetry</a> for more information.</li>
<li><strong><code>--checkpointing</code></strong>:</li>
<li>Enables <a href="../checkpointing.md">checkpointing</a>.</li>
<li><strong><code>--extensions &lt;extension_name ...&gt;</code></strong> (<strong><code>-e &lt;extension_name ...&gt;</code></strong>):</li>
<li>Specifies a list of extensions to use for the session. If not provided, all available extensions are used.</li>
<li>Use the special term <code>gemini -e none</code> to disable all extensions.</li>
<li>Example: <code>gemini -e my-extension -e my-other-extension</code></li>
<li><strong><code>--list-extensions</code></strong> (<strong><code>-l</code></strong>):</li>
<li>Lists all available extensions and exits.</li>
<li><strong><code>--proxy</code></strong>:</li>
<li>Sets the proxy for the CLI.</li>
<li>Example: <code>--proxy http://localhost:7890</code>.</li>
<li><strong><code>--include-directories &lt;dir1,dir2,...&gt;</code></strong>:</li>
<li>Includes additional directories in the workspace for multi-directory support.</li>
<li>Can be specified multiple times or as comma-separated values.</li>
<li>5 directories can be added at maximum.</li>
<li>Example: <code>--include-directories /path/to/project1,/path/to/project2</code> or <code>--include-directories /path/to/project1 --include-directories /path/to/project2</code></li>
<li><strong><code>--version</code></strong>:</li>
<li>Displays the version of the CLI.</li>
</ul>
<h2 id="context-files-hierarchical-instructional-context">Context Files (Hierarchical Instructional Context)</h2>
<p>While not strictly configuration for the CLI's <em>behavior</em>, context files (defaulting to <code>GEMINI.md</code> but configurable via the <code>contextFileName</code> setting) are crucial for configuring the <em>instructional context</em> (also referred to as "memory") provided to the Gemini model. This powerful feature allows you to give project-specific instructions, coding style guides, or any relevant background information to the AI, making its responses more tailored and accurate to your needs. The CLI includes UI elements, such as an indicator in the footer showing the number of loaded context files, to keep you informed about the active context.</p>
<ul>
<li><strong>Purpose:</strong> These Markdown files contain instructions, guidelines, or context that you want the Gemini model to be aware of during your interactions. The system is designed to manage this instructional context hierarchically.</li>
</ul>
<h3 id="example-context-file-content-eg-geminimd">Example Context File Content (e.g., <code>GEMINI.md</code>)</h3>
<p>Here's a conceptual example of what a context file at the root of a TypeScript project might contain:</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Project: My Awesome TypeScript Library</span>

<span class="gu">## General Instructions:</span>

<span class="k">-</span><span class="w"> </span>When generating new TypeScript code, please follow the existing coding style.
<span class="k">-</span><span class="w"> </span>Ensure all new functions and classes have JSDoc comments.
<span class="k">-</span><span class="w"> </span>Prefer functional programming paradigms where appropriate.
<span class="k">-</span><span class="w"> </span>All code should be compatible with TypeScript 5.0 and Node.js 20+.

<span class="gu">## Coding Style:</span>

<span class="k">-</span><span class="w"> </span>Use 2 spaces for indentation.
<span class="k">-</span><span class="w"> </span>Interface names should be prefixed with <span class="sb">`I`</span> (e.g., <span class="sb">`IUserService`</span>).
<span class="k">-</span><span class="w"> </span>Private class members should be prefixed with an underscore (<span class="sb">`_`</span>).
<span class="k">-</span><span class="w"> </span>Always use strict equality (<span class="sb">`===`</span> and <span class="sb">`!==`</span>).

<span class="gu">## Specific Component: `src/api/client.ts`</span>

<span class="k">-</span><span class="w"> </span>This file handles all outbound API requests.
<span class="k">-</span><span class="w"> </span>When adding new API call functions, ensure they include robust error handling and logging.
<span class="k">-</span><span class="w"> </span>Use the existing <span class="sb">`fetchWithRetry`</span> utility for all GET requests.

<span class="gu">## Regarding Dependencies:</span>

<span class="k">-</span><span class="w"> </span>Avoid introducing new external dependencies unless absolutely necessary.
<span class="k">-</span><span class="w"> </span>If a new dependency is required, please state the reason.
</code></pre></div>

<p>This example demonstrates how you can provide general project context, specific coding conventions, and even notes about particular files or components. The more relevant and precise your context files are, the better the AI can assist you. Project-specific context files are highly encouraged to establish conventions and context.</p>
<ul>
<li><strong>Hierarchical Loading and Precedence:</strong> The CLI implements a sophisticated hierarchical memory system by loading context files (e.g., <code>GEMINI.md</code>) from several locations. Content from files lower in this list (more specific) typically overrides or supplements content from files higher up (more general). The exact concatenation order and final context can be inspected using the <code>/memory show</code> command. The typical loading order is:</li>
<li><strong>Global Context File:</strong><ul>
<li>Location: <code>~/.gemini/&lt;contextFileName&gt;</code> (e.g., <code>~/.gemini/GEMINI.md</code> in your user home directory).</li>
<li>Scope: Provides default instructions for all your projects.</li>
</ul>
</li>
<li><strong>Project Root &amp; Ancestors Context Files:</strong><ul>
<li>Location: The CLI searches for the configured context file in the current working directory and then in each parent directory up to either the project root (identified by a <code>.git</code> folder) or your home directory.</li>
<li>Scope: Provides context relevant to the entire project or a significant portion of it.</li>
</ul>
</li>
<li><strong>Sub-directory Context Files (Contextual/Local):</strong><ul>
<li>Location: The CLI also scans for the configured context file in subdirectories <em>below</em> the current working directory (respecting common ignore patterns like <code>node_modules</code>, <code>.git</code>, etc.). The breadth of this search is limited to 200 directories by default, but can be configured with a <code>memoryDiscoveryMaxDirs</code> field in your <code>settings.json</code> file.</li>
<li>Scope: Allows for highly specific instructions relevant to a particular component, module, or subsection of your project.</li>
</ul>
</li>
<li><strong>Concatenation &amp; UI Indication:</strong> The contents of all found context files are concatenated (with separators indicating their origin and path) and provided as part of the system prompt to the Gemini model. The CLI footer displays the count of loaded context files, giving you a quick visual cue about the active instructional context.</li>
<li><strong>Importing Content:</strong> You can modularize your context files by importing other Markdown files using the <code>@path/to/file.md</code> syntax. For more details, see the <a href="../core/memport.md">Memory Import Processor documentation</a>.</li>
<li><strong>Commands for Memory Management:</strong></li>
<li>Use <code>/memory refresh</code> to force a re-scan and reload of all context files from all configured locations. This updates the AI's instructional context.</li>
<li>Use <code>/memory show</code> to display the combined instructional context currently loaded, allowing you to verify the hierarchy and content being used by the AI.</li>
<li>See the <a href="./commands.md#memory">Commands documentation</a> for full details on the <code>/memory</code> command and its sub-commands (<code>show</code> and <code>refresh</code>).</li>
</ul>
<p>By understanding and utilizing these configuration layers and the hierarchical nature of context files, you can effectively manage the AI's memory and tailor the Gemini CLI's responses to your specific needs and projects.</p>
<h2 id="sandboxing">Sandboxing</h2>
<p>The Gemini CLI can execute potentially unsafe operations (like shell commands and file modifications) within a sandboxed environment to protect your system.</p>
<p>Sandboxing is disabled by default, but you can enable it in a few ways:</p>
<ul>
<li>Using <code>--sandbox</code> or <code>-s</code> flag.</li>
<li>Setting <code>GEMINI_SANDBOX</code> environment variable.</li>
<li>Sandbox is enabled in <code>--yolo</code> mode by default.</li>
</ul>
<p>By default, it uses a pre-built <code>gemini-cli-sandbox</code> Docker image.</p>
<p>For project-specific sandboxing needs, you can create a custom Dockerfile at <code>.gemini/sandbox.Dockerfile</code> in your project's root directory. This Dockerfile can be based on the base sandbox image:</p>
<div class="codehilite"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">gemini-cli-sandbox</span>

<span class="c"># Add your custom dependencies or configurations here</span>
<span class="c"># For example:</span>
<span class="c"># RUN apt-get update &amp;&amp; apt-get install -y some-package</span>
<span class="c"># COPY ./my-config /app/my-config</span>
</code></pre></div>

<p>When <code>.gemini/sandbox.Dockerfile</code> exists, you can use <code>BUILD_SANDBOX</code> environment variable when running Gemini CLI to automatically build the custom sandbox image:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">BUILD_SANDBOX</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>gemini<span class="w"> </span>-s
</code></pre></div>

<h2 id="usage-statistics">Usage Statistics</h2>
<p>To help us improve the Gemini CLI, we collect anonymized usage statistics. This data helps us understand how the CLI is used, identify common issues, and prioritize new features.</p>
<p><strong>What we collect:</strong></p>
<ul>
<li><strong>Tool Calls:</strong> We log the names of the tools that are called, whether they succeed or fail, and how long they take to execute. We do not collect the arguments passed to the tools or any data returned by them.</li>
<li><strong>API Requests:</strong> We log the Gemini model used for each request, the duration of the request, and whether it was successful. We do not collect the content of the prompts or responses.</li>
<li><strong>Session Information:</strong> We collect information about the configuration of the CLI, such as the enabled tools and the approval mode.</li>
</ul>
<p><strong>What we DON'T collect:</strong></p>
<ul>
<li><strong>Personally Identifiable Information (PII):</strong> We do not collect any personal information, such as your name, email address, or API keys.</li>
<li><strong>Prompt and Response Content:</strong> We do not log the content of your prompts or the responses from the Gemini model.</li>
<li><strong>File Content:</strong> We do not log the content of any files that are read or written by the CLI.</li>
</ul>
<p><strong>How to opt out:</strong></p>
<p>You can opt out of usage statistics collection at any time by setting the <code>usageStatisticsEnabled</code> property to <code>false</code> in your <code>settings.json</code> file:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;usageStatisticsEnabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>

<p>‚îú‚îÄ‚îÄ index.md
    Content:</p>
<h1 id="gemini-cli">Gemini CLI</h1>
<p>Within Gemini CLI, <code>packages/cli</code> is the frontend for users to send and receive prompts with the Gemini AI model and its associated tools. For a general overview of Gemini CLI, see the <a href="../index.md">main documentation page</a>.</p>
<h2 id="navigating-this-section">Navigating this section</h2>
<ul>
<li><strong><a href="./authentication.md">Authentication</a>:</strong> A guide to setting up authentication with Google's AI services.</li>
<li><strong><a href="./commands.md">Commands</a>:</strong> A reference for Gemini CLI commands (e.g., <code>/help</code>, <code>/tools</code>, <code>/theme</code>).</li>
<li><strong><a href="./configuration.md">Configuration</a>:</strong> A guide to tailoring Gemini CLI behavior using configuration files.</li>
<li><strong><a href="./token-caching.md">Token Caching</a>:</strong> Optimize API costs through token caching.</li>
<li><strong><a href="./themes.md">Themes</a></strong>: A guide to customizing the CLI's appearance with different themes.</li>
<li><strong><a href="tutorials.md">Tutorials</a></strong>: A tutorial showing how to use Gemini CLI to automate a development task.</li>
</ul>
<h2 id="non-interactive-mode">Non-interactive mode</h2>
<p>Gemini CLI can be run in a non-interactive mode, which is useful for scripting and automation. In this mode, you pipe input to the CLI, it executes the command, and then it exits.</p>
<p>The following example pipes a command to Gemini CLI from your terminal:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;What is fine tuning?&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gemini
</code></pre></div>

<p>Gemini CLI executes the command and prints the output to your terminal. Note that you can achieve the same behavior by using the <code>--prompt</code> or <code>-p</code> flag. For example:</p>
<div class="codehilite"><pre><span></span><code>gemini<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;What is fine tuning?&quot;</span>
</code></pre></div>

<p>‚îú‚îÄ‚îÄ themes.md
    Content:</p>
<h1 id="themes">Themes</h1>
<p>Gemini CLI supports a variety of themes to customize its color scheme and appearance. You can change the theme to suit your preferences via the <code>/theme</code> command or <code>"theme":</code> configuration setting.</p>
<h2 id="available-themes">Available Themes</h2>
<p>Gemini CLI comes with a selection of pre-defined themes, which you can list using the <code>/theme</code> command within Gemini CLI:</p>
<ul>
<li><strong>Dark Themes:</strong></li>
<li><code>ANSI</code></li>
<li><code>Atom One</code></li>
<li><code>Ayu</code></li>
<li><code>Default</code></li>
<li><code>Dracula</code></li>
<li><code>GitHub</code></li>
<li><strong>Light Themes:</strong></li>
<li><code>ANSI Light</code></li>
<li><code>Ayu Light</code></li>
<li><code>Default Light</code></li>
<li><code>GitHub Light</code></li>
<li><code>Google Code</code></li>
<li><code>Xcode</code></li>
</ul>
<h3 id="changing-themes">Changing Themes</h3>
<ol>
<li>Enter <code>/theme</code> into Gemini CLI.</li>
<li>A dialog or selection prompt appears, listing the available themes.</li>
<li>Using the arrow keys, select a theme. Some interfaces might offer a live preview or highlight as you select.</li>
<li>Confirm your selection to apply the theme.</li>
</ol>
<h3 id="theme-persistence">Theme Persistence</h3>
<p>Selected themes are saved in Gemini CLI's <a href="./configuration.md">configuration</a> so your preference is remembered across sessions.</p>
<hr />
<h2 id="custom-color-themes">Custom Color Themes</h2>
<p>Gemini CLI allows you to create your own custom color themes by specifying them in your <code>settings.json</code> file. This gives you full control over the color palette used in the CLI.</p>
<h3 id="how-to-define-a-custom-theme">How to Define a Custom Theme</h3>
<p>Add a <code>customThemes</code> block to your user, project, or system <code>settings.json</code> file. Each custom theme is defined as an object with a unique name and a set of color keys. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;customThemes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;MyCustomTheme&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MyCustomTheme&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;custom&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Background&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#181818&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Foreground&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#F8F8F2&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;LightBlue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#82AAFF&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;AccentBlue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#61AFEF&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;AccentPurple&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#C678DD&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;AccentCyan&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#56B6C2&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;AccentGreen&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#98C379&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;AccentYellow&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#E5C07B&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;AccentRed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#E06C75&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Comment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#5C6370&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Gray&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#ABB2BF&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;DiffAdded&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#A6E3A1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;DiffRemoved&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#F38BA8&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;DiffModified&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;#89B4FA&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;GradientColors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;#4796E4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;#847ACE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;#C3677F&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Color keys:</strong></p>
<ul>
<li><code>Background</code></li>
<li><code>Foreground</code></li>
<li><code>LightBlue</code></li>
<li><code>AccentBlue</code></li>
<li><code>AccentPurple</code></li>
<li><code>AccentCyan</code></li>
<li><code>AccentGreen</code></li>
<li><code>AccentYellow</code></li>
<li><code>AccentRed</code></li>
<li><code>Comment</code></li>
<li><code>Gray</code></li>
<li><code>DiffAdded</code> (optional, for added lines in diffs)</li>
<li><code>DiffRemoved</code> (optional, for removed lines in diffs)</li>
<li><code>DiffModified</code> (optional, for modified lines in diffs)</li>
</ul>
<p><strong>Required Properties:</strong></p>
<ul>
<li><code>name</code> (must match the key in the <code>customThemes</code> object and be a string)</li>
<li><code>type</code> (must be the string <code>"custom"</code>)</li>
<li><code>Background</code></li>
<li><code>Foreground</code></li>
<li><code>LightBlue</code></li>
<li><code>AccentBlue</code></li>
<li><code>AccentPurple</code></li>
<li><code>AccentCyan</code></li>
<li><code>AccentGreen</code></li>
<li><code>AccentYellow</code></li>
<li><code>AccentRed</code></li>
<li><code>Comment</code></li>
<li><code>Gray</code></li>
</ul>
<p>You can use either hex codes (e.g., <code>#FF0000</code>) <strong>or</strong> standard CSS color names (e.g., <code>coral</code>, <code>teal</code>, <code>blue</code>) for any color value. See <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#color_keywords">CSS color names</a> for a full list of supported names.</p>
<p>You can define multiple custom themes by adding more entries to the <code>customThemes</code> object.</p>
<h3 id="example-custom-theme">Example Custom Theme</h3>
<p><img src="../assets/theme-custom.png" alt="Custom theme example" width="600" /></p>
<h3 id="using-your-custom-theme">Using Your Custom Theme</h3>
<ul>
<li>Select your custom theme using the <code>/theme</code> command in Gemini CLI. Your custom theme will appear in the theme selection dialog.</li>
<li>Or, set it as the default by adding <code>"theme": "MyCustomTheme"</code> to your <code>settings.json</code>.</li>
<li>Custom themes can be set at the user, project, or system level, and follow the same <a href="./configuration.md">configuration precedence</a> as other settings.</li>
</ul>
<hr />
<h2 id="dark-themes">Dark Themes</h2>
<h3 id="ansi">ANSI</h3>
<p><img src="../assets/theme-ansi.png" alt="ANSI theme" width="600" /></p>
<h3 id="atom-onedark">Atom OneDark</h3>
<p><img src="../assets/theme-atom-one.png" alt="Atom One theme" width="600"></p>
<h3 id="ayu">Ayu</h3>
<p><img src="../assets/theme-ayu.png" alt="Ayu theme" width="600"></p>
<h3 id="default">Default</h3>
<p><img src="../assets/theme-default.png" alt="Default theme" width="600"></p>
<h3 id="dracula">Dracula</h3>
<p><img src="../assets/theme-dracula.png" alt="Dracula theme" width="600"></p>
<h3 id="github">GitHub</h3>
<p><img src="../assets/theme-github.png" alt="GitHub theme" width="600"></p>
<h2 id="light-themes">Light Themes</h2>
<h3 id="ansi-light">ANSI Light</h3>
<p><img src="../assets/theme-ansi-light.png" alt="ANSI Light theme" width="600"></p>
<h3 id="ayu-light">Ayu Light</h3>
<p><img src="../assets/theme-ayu-light.png" alt="Ayu Light theme" width="600"></p>
<h3 id="default-light">Default Light</h3>
<p><img src="../assets/theme-default-light.png" alt="Default Light theme" width="600"></p>
<h3 id="github-light">GitHub Light</h3>
<p><img src="../assets/theme-github-light.png" alt="GitHub Light theme" width="600"></p>
<h3 id="google-code">Google Code</h3>
<p><img src="../assets/theme-google-light.png" alt="Google Code theme" width="600"></p>
<h3 id="xcode">Xcode</h3>
<p><img src="../assets/theme-xcode-light.png" alt="Xcode Light theme" width="600"></p>
<p>‚îú‚îÄ‚îÄ token-caching.md
    Content:</p>
<h1 id="token-caching-and-cost-optimization">Token Caching and Cost Optimization</h1>
<p>Gemini CLI automatically optimizes API costs through token caching when using API key authentication (Gemini API key or Vertex AI). This feature reuses previous system instructions and context to reduce the number of tokens processed in subsequent requests.</p>
<p><strong>Token caching is available for:</strong></p>
<ul>
<li>API key users (Gemini API key)</li>
<li>Vertex AI users (with project and location setup)</li>
</ul>
<p><strong>Token caching is not available for:</strong></p>
<ul>
<li>OAuth users (Google Personal/Enterprise accounts) - the Code Assist API does not support cached content creation at this time</li>
</ul>
<p>You can view your token usage and cached token savings using the <code>/stats</code> command. When cached tokens are available, they will be displayed in the stats output.</p>
<p>‚îú‚îÄ‚îÄ tutorials.md
    Content:</p>
<h1 id="tutorials">Tutorials</h1>
<p>This page contains tutorials for interacting with Gemini CLI.</p>
<h2 id="setting-up-a-model-context-protocol-mcp-server">Setting up a Model Context Protocol (MCP) server</h2>
<blockquote>
<p>[!CAUTION]
Before using a third-party MCP server, ensure you trust its source and understand the tools it provides. Your use of third-party servers is at your own risk.</p>
</blockquote>
<p>This tutorial demonstrates how to set up a MCP server, using the <a href="https://github.com/github/github-mcp-server">GitHub MCP server</a> as an example. The GitHub MCP server provides tools for interacting with GitHub repositories, such as creating issues and commenting on pull requests.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>Before you begin, ensure you have the following installed and configured:</p>
<ul>
<li><strong>Docker:</strong> Install and run <a href="https://www.docker.com/">Docker</a>.</li>
<li><strong>GitHub Personal Access Token (PAT):</strong> Create a new <a href="https://github.com/settings/tokens/new">classic</a> or <a href="https://github.com/settings/personal-access-tokens/new">fine-grained</a> PAT with the necessary scopes.</li>
</ul>
<h3 id="guide">Guide</h3>
<h4 id="configure-the-mcp-server-in-settingsjson">Configure the MCP server in <code>settings.json</code></h4>
<p>In your project's root directory, create or open the <a href="./configuration.md"><code>.gemini/settings.json</code> file</a>. Within the file, add the <code>mcpServers</code> configuration block, which provides instructions for how to launch the GitHub MCP server.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;github&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;run&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;-i&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;--rm&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;-e&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;GITHUB_PERSONAL_ACCESS_TOKEN&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;ghcr.io/github/github-mcp-server&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;GITHUB_PERSONAL_ACCESS_TOKEN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${GITHUB_PERSONAL_ACCESS_TOKEN}&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="set-your-github-token">Set your GitHub token</h4>
<blockquote>
<p>[!CAUTION]
Using a broadly scoped personal access token that has access to personal and private repositories can lead to information from the private repository being leaked into the public repository. We recommend using a fine-grained access token that doesn't share access to both public and private repositories.</p>
</blockquote>
<p>Use an environment variable to store your GitHub PAT:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">GITHUB_PERSONAL_ACCESS_TOKEN</span><span class="o">=</span><span class="s2">&quot;pat_YourActualGitHubTokenHere&quot;</span>
</code></pre></div>

<p>Gemini CLI uses this value in the <code>mcpServers</code> configuration that you defined in the <code>settings.json</code> file.</p>
<h4 id="launch-gemini-cli-and-verify-the-connection">Launch Gemini CLI and verify the connection</h4>
<p>When you launch Gemini CLI, it automatically reads your configuration and launches the GitHub MCP server in the background. You can then use natural language prompts to ask Gemini CLI to perform GitHub actions. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="s2">&quot;get all open issues assigned to me in the &#39;foo/bar&#39; repo and prioritize them&quot;</span>
</code></pre></div>

<p>‚îî‚îÄ‚îÄ core/
  ‚îú‚îÄ‚îÄ index.md
    Content:</p>
<h1 id="gemini-cli-core">Gemini CLI Core</h1>
<p>Gemini CLI's core package (<code>packages/core</code>) is the backend portion of Gemini CLI, handling communication with the Gemini API, managing tools, and processing requests sent from <code>packages/cli</code>. For a general overview of Gemini CLI, see the <a href="../index.md">main documentation page</a>.</p>
<h2 id="navigating-this-section_1">Navigating this section</h2>
<ul>
<li><strong><a href="./tools-api.md">Core tools API</a>:</strong> Information on how tools are defined, registered, and used by the core.</li>
<li><strong><a href="./memport.md">Memory Import Processor</a>:</strong> Documentation for the modular GEMINI.md import feature using @file.md syntax.</li>
</ul>
<h2 id="role-of-the-core">Role of the core</h2>
<p>While the <code>packages/cli</code> portion of Gemini CLI provides the user interface, <code>packages/core</code> is responsible for:</p>
<ul>
<li><strong>Gemini API interaction:</strong> Securely communicating with the Google Gemini API, sending user prompts, and receiving model responses.</li>
<li><strong>Prompt engineering:</strong> Constructing effective prompts for the Gemini model, potentially incorporating conversation history, tool definitions, and instructional context from <code>GEMINI.md</code> files.</li>
<li><strong>Tool management &amp; orchestration:</strong></li>
<li>Registering available tools (e.g., file system tools, shell command execution).</li>
<li>Interpreting tool use requests from the Gemini model.</li>
<li>Executing the requested tools with the provided arguments.</li>
<li>Returning tool execution results to the Gemini model for further processing.</li>
<li><strong>Session and state management:</strong> Keeping track of the conversation state, including history and any relevant context required for coherent interactions.</li>
<li><strong>Configuration:</strong> Managing core-specific configurations, such as API key access, model selection, and tool settings.</li>
</ul>
<h2 id="security-considerations">Security considerations</h2>
<p>The core plays a vital role in security:</p>
<ul>
<li><strong>API key management:</strong> It handles the <code>GEMINI_API_KEY</code> and ensures it's used securely when communicating with the Gemini API.</li>
<li><strong>Tool execution:</strong> When tools interact with the local system (e.g., <code>run_shell_command</code>), the core (and its underlying tool implementations) must do so with appropriate caution, often involving sandboxing mechanisms to prevent unintended modifications.</li>
</ul>
<h2 id="chat-history-compression">Chat history compression</h2>
<p>To ensure that long conversations don't exceed the token limits of the Gemini model, the core includes a chat history compression feature.</p>
<p>When a conversation approaches the token limit for the configured model, the core automatically compresses the conversation history before sending it to the model. This compression is designed to be lossless in terms of the information conveyed, but it reduces the overall number of tokens used.</p>
<p>You can find the token limits for each model in the <a href="https://ai.google.dev/gemini-api/docs/models">Google AI documentation</a>.</p>
<h2 id="model-fallback">Model fallback</h2>
<p>Gemini CLI includes a model fallback mechanism to ensure that you can continue to use the CLI even if the default "pro" model is rate-limited.</p>
<p>If you are using the default "pro" model and the CLI detects that you are being rate-limited, it automatically switches to the "flash" model for the current session. This allows you to continue working without interruption.</p>
<h2 id="file-discovery-service">File discovery service</h2>
<p>The file discovery service is responsible for finding files in the project that are relevant to the current context. It is used by the <code>@</code> command and other tools that need to access files.</p>
<h2 id="memory-discovery-service">Memory discovery service</h2>
<p>The memory discovery service is responsible for finding and loading the <code>GEMINI.md</code> files that provide context to the model. It searches for these files in a hierarchical manner, starting from the current working directory and moving up to the project root and the user's home directory. It also searches in subdirectories.</p>
<p>This allows you to have global, project-level, and component-level context files, which are all combined to provide the model with the most relevant information.</p>
<p>You can use the <a href="../cli/commands.md"><code>/memory</code> command</a> to <code>show</code>, <code>add</code>, and <code>refresh</code> the content of loaded <code>GEMINI.md</code> files.</p>
<p>‚îú‚îÄ‚îÄ memport.md
    Content:</p>
<h1 id="memory-import-processor">Memory Import Processor</h1>
<p>The Memory Import Processor is a feature that allows you to modularize your GEMINI.md files by importing content from other files using the <code>@file.md</code> syntax.</p>
<h2 id="overview">Overview</h2>
<p>This feature enables you to break down large GEMINI.md files into smaller, more manageable components that can be reused across different contexts. The import processor supports both relative and absolute paths, with built-in safety features to prevent circular imports and ensure file access security.</p>
<h2 id="syntax">Syntax</h2>
<p>Use the <code>@</code> symbol followed by the path to the file you want to import:</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Main GEMINI.md file</span>

This is the main content.

@./components/instructions.md

More content here.

@./shared/configuration.md
</code></pre></div>

<h2 id="supported-path-formats">Supported Path Formats</h2>
<h3 id="relative-paths">Relative Paths</h3>
<ul>
<li><code>@./file.md</code> - Import from the same directory</li>
<li><code>@../file.md</code> - Import from parent directory</li>
<li><code>@./components/file.md</code> - Import from subdirectory</li>
</ul>
<h3 id="absolute-paths">Absolute Paths</h3>
<ul>
<li><code>@/absolute/path/to/file.md</code> - Import using absolute path</li>
</ul>
<h2 id="examples_1">Examples</h2>
<h3 id="basic-import">Basic Import</h3>
<div class="codehilite"><pre><span></span><code><span class="gh"># My GEMINI.md</span>

Welcome to my project!

@./getting-started.md

<span class="gu">## Features</span>

@./features/overview.md
</code></pre></div>

<h3 id="nested-imports">Nested Imports</h3>
<p>The imported files can themselves contain imports, creating a nested structure:</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># main.md</span>

@./header.md
@./content.md
@./footer.md
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="gh"># header.md</span>

<span class="gh"># Project Header</span>

@./shared/title.md
</code></pre></div>

<h2 id="safety-features">Safety Features</h2>
<h3 id="circular-import-detection">Circular Import Detection</h3>
<p>The processor automatically detects and prevents circular imports:</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># file-a.md</span>

@./file-b.md

<span class="gh"># file-b.md</span>

@./file-a.md &lt;!-- This will be detected and prevented --&gt;
</code></pre></div>

<h3 id="file-access-security">File Access Security</h3>
<p>The <code>validateImportPath</code> function ensures that imports are only allowed from specified directories, preventing access to sensitive files outside the allowed scope.</p>
<h3 id="maximum-import-depth">Maximum Import Depth</h3>
<p>To prevent infinite recursion, there's a configurable maximum import depth (default: 5 levels).</p>
<h2 id="error-handling">Error Handling</h2>
<h3 id="missing-files">Missing Files</h3>
<p>If a referenced file doesn't exist, the import will fail gracefully with an error comment in the output.</p>
<h3 id="file-access-errors">File Access Errors</h3>
<p>Permission issues or other file system errors are handled gracefully with appropriate error messages.</p>
<h2 id="code-region-detection">Code Region Detection</h2>
<p>The import processor uses the <code>marked</code> library to detect code blocks and inline code spans, ensuring that <code>@</code> imports inside these regions are properly ignored. This provides robust handling of nested code blocks and complex Markdown structures.</p>
<h2 id="import-tree-structure">Import Tree Structure</h2>
<p>The processor returns an import tree that shows the hierarchy of imported files, similar to Claude's <code>/memory</code> feature. This helps users debug problems with their GEMINI.md files by showing which files were read and their import relationships.</p>
<p>Example tree structure:</p>
<div class="codehilite"><pre><span></span><code>Memory Files
 L project: GEMINI.md
            L a.md
              L b.md
                L c.md
              L d.md
                L e.md
                  L f.md
            L included.md
</code></pre></div>

<p>The tree preserves the order that files were imported and shows the complete import chain for debugging purposes.</p>
<h2 id="comparison-to-claude-codes-memory-claudemd-approach">Comparison to Claude Code's <code>/memory</code> (<code>claude.md</code>) Approach</h2>
<p>Claude Code's <code>/memory</code> feature (as seen in <code>claude.md</code>) produces a flat, linear document by concatenating all included files, always marking file boundaries with clear comments and path names. It does not explicitly present the import hierarchy, but the LLM receives all file contents and paths, which is sufficient for reconstructing the hierarchy if needed.</p>
<p>Note: The import tree is mainly for clarity during development and has limited relevance to LLM consumption.</p>
<h2 id="api-reference">API Reference</h2>
<h3 id="processimportscontent-basepath-debugmode-importstate"><code>processImports(content, basePath, debugMode?, importState?)</code></h3>
<p>Processes import statements in GEMINI.md content.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>content</code> (string): The content to process for imports</li>
<li><code>basePath</code> (string): The directory path where the current file is located</li>
<li><code>debugMode</code> (boolean, optional): Whether to enable debug logging (default: false)</li>
<li><code>importState</code> (ImportState, optional): State tracking for circular import prevention</li>
</ul>
<p><strong>Returns:</strong> Promise<ProcessImportsResult> - Object containing processed content and import tree</p>
<h3 id="processimportsresult"><code>ProcessImportsResult</code></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">ProcessImportsResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="c1">// The processed content with imports resolved</span>
<span class="w">  </span><span class="nx">importTree</span><span class="o">:</span><span class="w"> </span><span class="kt">MemoryFile</span><span class="p">;</span><span class="w"> </span><span class="c1">// Tree structure showing the import hierarchy</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="memoryfile"><code>MemoryFile</code></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">interface</span><span class="w"> </span><span class="nx">MemoryFile</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w"> </span><span class="c1">// The file path</span>
<span class="w">  </span><span class="nx">imports?</span><span class="o">:</span><span class="w"> </span><span class="kt">MemoryFile</span><span class="p">[];</span><span class="w"> </span><span class="c1">// Direct imports, in the order they were imported</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="validateimportpathimportpath-basepath-alloweddirectories"><code>validateImportPath(importPath, basePath, allowedDirectories)</code></h3>
<p>Validates import paths to ensure they are safe and within allowed directories.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>importPath</code> (string): The import path to validate</li>
<li><code>basePath</code> (string): The base directory for resolving relative paths</li>
<li><code>allowedDirectories</code> (string[]): Array of allowed directory paths</li>
</ul>
<p><strong>Returns:</strong> boolean - Whether the import path is valid</p>
<h3 id="findprojectrootstartdir"><code>findProjectRoot(startDir)</code></h3>
<p>Finds the project root by searching for a <code>.git</code> directory upwards from the given start directory. Implemented as an <strong>async</strong> function using non-blocking file system APIs to avoid blocking the Node.js event loop.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>startDir</code> (string): The directory to start searching from</li>
</ul>
<p><strong>Returns:</strong> Promise<string> - The project root directory (or the start directory if no <code>.git</code> is found)</p>
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Use descriptive file names</strong> for imported components</li>
<li><strong>Keep imports shallow</strong> - avoid deeply nested import chains</li>
<li><strong>Document your structure</strong> - maintain a clear hierarchy of imported files</li>
<li><strong>Test your imports</strong> - ensure all referenced files exist and are accessible</li>
<li><strong>Use relative paths</strong> when possible for better portability</li>
</ol>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-issues">Common Issues</h3>
<ol>
<li><strong>Import not working</strong>: Check that the file exists and the path is correct</li>
<li><strong>Circular import warnings</strong>: Review your import structure for circular references</li>
<li><strong>Permission errors</strong>: Ensure the files are readable and within allowed directories</li>
<li><strong>Path resolution issues</strong>: Use absolute paths if relative paths aren't resolving correctly</li>
</ol>
<h3 id="debug-mode">Debug Mode</h3>
<p>Enable debug mode to see detailed logging of the import process:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">processImports</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">basePath</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
</code></pre></div>

<p>‚îú‚îÄ‚îÄ tools-api.md
    Content:</p>
<h1 id="gemini-cli-core-tools-api">Gemini CLI Core: Tools API</h1>
<p>The Gemini CLI core (<code>packages/core</code>) features a robust system for defining, registering, and executing tools. These tools extend the capabilities of the Gemini model, allowing it to interact with the local environment, fetch web content, and perform various actions beyond simple text generation.</p>
<h2 id="core-concepts">Core Concepts</h2>
<ul>
<li><strong>Tool (<code>tools.ts</code>):</strong> An interface and base class (<code>BaseTool</code>) that defines the contract for all tools. Each tool must have:</li>
<li><code>name</code>: A unique internal name (used in API calls to Gemini).</li>
<li><code>displayName</code>: A user-friendly name.</li>
<li><code>description</code>: A clear explanation of what the tool does, which is provided to the Gemini model.</li>
<li><code>parameterSchema</code>: A JSON schema defining the parameters that the tool accepts. This is crucial for the Gemini model to understand how to call the tool correctly.</li>
<li><code>validateToolParams()</code>: A method to validate incoming parameters.</li>
<li><code>getDescription()</code>: A method to provide a human-readable description of what the tool will do with specific parameters before execution.</li>
<li><code>shouldConfirmExecute()</code>: A method to determine if user confirmation is required before execution (e.g., for potentially destructive operations).</li>
<li>
<p><code>execute()</code>: The core method that performs the tool's action and returns a <code>ToolResult</code>.</p>
</li>
<li>
<p><strong><code>ToolResult</code> (<code>tools.ts</code>):</strong> An interface defining the structure of a tool's execution outcome:</p>
</li>
<li><code>llmContent</code>: The factual content to be included in the history sent back to the LLM for context. This can be a simple string or a <code>PartListUnion</code> (an array of <code>Part</code> objects and strings) for rich content.</li>
<li>
<p><code>returnDisplay</code>: A user-friendly string (often Markdown) or a special object (like <code>FileDiff</code>) for display in the CLI.</p>
</li>
<li>
<p><strong>Returning Rich Content:</strong> Tools are not limited to returning simple text. The <code>llmContent</code> can be a <code>PartListUnion</code>, which is an array that can contain a mix of <code>Part</code> objects (for images, audio, etc.) and <code>string</code>s. This allows a single tool execution to return multiple pieces of rich content.</p>
</li>
<li>
<p><strong>Tool Registry (<code>tool-registry.ts</code>):</strong> A class (<code>ToolRegistry</code>) responsible for:</p>
</li>
<li><strong>Registering Tools:</strong> Holding a collection of all available built-in tools (e.g., <code>ReadFileTool</code>, <code>ShellTool</code>).</li>
<li><strong>Discovering Tools:</strong> It can also discover tools dynamically:<ul>
<li><strong>Command-based Discovery:</strong> If <code>toolDiscoveryCommand</code> is configured in settings, this command is executed. It's expected to output JSON describing custom tools, which are then registered as <code>DiscoveredTool</code> instances.</li>
<li><strong>MCP-based Discovery:</strong> If <code>mcpServerCommand</code> is configured, the registry can connect to a Model Context Protocol (MCP) server to list and register tools (<code>DiscoveredMCPTool</code>).</li>
</ul>
</li>
<li><strong>Providing Schemas:</strong> Exposing the <code>FunctionDeclaration</code> schemas of all registered tools to the Gemini model, so it knows what tools are available and how to use them.</li>
<li><strong>Retrieving Tools:</strong> Allowing the core to get a specific tool by name for execution.</li>
</ul>
<h2 id="built-in-tools">Built-in Tools</h2>
<p>The core comes with a suite of pre-defined tools, typically found in <code>packages/core/src/tools/</code>. These include:</p>
<ul>
<li><strong>File System Tools:</strong></li>
<li><code>LSTool</code> (<code>ls.ts</code>): Lists directory contents.</li>
<li><code>ReadFileTool</code> (<code>read-file.ts</code>): Reads the content of a single file. It takes an <code>absolute_path</code> parameter, which must be an absolute path.</li>
<li><code>WriteFileTool</code> (<code>write-file.ts</code>): Writes content to a file.</li>
<li><code>GrepTool</code> (<code>grep.ts</code>): Searches for patterns in files.</li>
<li><code>GlobTool</code> (<code>glob.ts</code>): Finds files matching glob patterns.</li>
<li><code>EditTool</code> (<code>edit.ts</code>): Performs in-place modifications to files (often requiring confirmation).</li>
<li><code>ReadManyFilesTool</code> (<code>read-many-files.ts</code>): Reads and concatenates content from multiple files or glob patterns (used by the <code>@</code> command in CLI).</li>
<li><strong>Execution Tools:</strong></li>
<li><code>ShellTool</code> (<code>shell.ts</code>): Executes arbitrary shell commands (requires careful sandboxing and user confirmation).</li>
<li><strong>Web Tools:</strong></li>
<li><code>WebFetchTool</code> (<code>web-fetch.ts</code>): Fetches content from a URL.</li>
<li><code>WebSearchTool</code> (<code>web-search.ts</code>): Performs a web search.</li>
<li><strong>Memory Tools:</strong></li>
<li><code>MemoryTool</code> (<code>memoryTool.ts</code>): Interacts with the AI's memory.</li>
</ul>
<p>Each of these tools extends <code>BaseTool</code> and implements the required methods for its specific functionality.</p>
<h2 id="tool-execution-flow">Tool Execution Flow</h2>
<ol>
<li><strong>Model Request:</strong> The Gemini model, based on the user's prompt and the provided tool schemas, decides to use a tool and returns a <code>FunctionCall</code> part in its response, specifying the tool name and arguments.</li>
<li><strong>Core Receives Request:</strong> The core parses this <code>FunctionCall</code>.</li>
<li><strong>Tool Retrieval:</strong> It looks up the requested tool in the <code>ToolRegistry</code>.</li>
<li><strong>Parameter Validation:</strong> The tool's <code>validateToolParams()</code> method is called.</li>
<li><strong>Confirmation (if needed):</strong><ul>
<li>The tool's <code>shouldConfirmExecute()</code> method is called.</li>
<li>If it returns details for confirmation, the core communicates this back to the CLI, which prompts the user.</li>
<li>The user's decision (e.g., proceed, cancel) is sent back to the core.</li>
</ul>
</li>
<li><strong>Execution:</strong> If validated and confirmed (or if no confirmation is needed), the core calls the tool's <code>execute()</code> method with the provided arguments and an <code>AbortSignal</code> (for potential cancellation).</li>
<li><strong>Result Processing:</strong> The <code>ToolResult</code> from <code>execute()</code> is received by the core.</li>
<li><strong>Response to Model:</strong> The <code>llmContent</code> from the <code>ToolResult</code> is packaged as a <code>FunctionResponse</code> and sent back to the Gemini model so it can continue generating a user-facing response.</li>
<li><strong>Display to User:</strong> The <code>returnDisplay</code> from the <code>ToolResult</code> is sent to the CLI to show the user what the tool did.</li>
</ol>
<h2 id="extending-with-custom-tools">Extending with Custom Tools</h2>
<p>While direct programmatic registration of new tools by users isn't explicitly detailed as a primary workflow in the provided files for typical end-users, the architecture supports extension through:</p>
<ul>
<li><strong>Command-based Discovery:</strong> Advanced users or project administrators can define a <code>toolDiscoveryCommand</code> in <code>settings.json</code>. This command, when run by the Gemini CLI core, should output a JSON array of <code>FunctionDeclaration</code> objects. The core will then make these available as <code>DiscoveredTool</code> instances. The corresponding <code>toolCallCommand</code> would then be responsible for actually executing these custom tools.</li>
<li><strong>MCP Server(s):</strong> For more complex scenarios, one or more MCP servers can be set up and configured via the <code>mcpServers</code> setting in <code>settings.json</code>. The Gemini CLI core can then discover and use tools exposed by these servers. As mentioned, if you have multiple MCP servers, the tool names will be prefixed with the server name from your configuration (e.g., <code>serverAlias__actualToolName</code>).</li>
</ul>
<p>This tool system provides a flexible and powerful way to augment the Gemini model's capabilities, making the Gemini CLI a versatile assistant for a wide range of tasks.</p>
<p>‚îú‚îÄ‚îÄ deployment.md
  Content:</p>
<h1 id="gemini-cli-execution-and-deployment">Gemini CLI Execution and Deployment</h1>
<p>This document describes how to run Gemini CLI and explains the deployment architecture that Gemini CLI uses.</p>
<h2 id="running-gemini-cli">Running Gemini CLI</h2>
<p>There are several ways to run Gemini CLI. The option you choose depends on how you intend to use Gemini CLI.</p>
<hr />
<h3 id="1-standard-installation-recommended-for-typical-users">1. Standard installation (Recommended for typical users)</h3>
<p>This is the recommended way for end-users to install Gemini CLI. It involves downloading the Gemini CLI package from the NPM registry.</p>
<ul>
<li><strong>Global install:</strong></li>
</ul>
<p><code>bash
  npm install -g @google/gemini-cli</code></p>
<p>Then, run the CLI from anywhere:</p>
<p><code>bash
  gemini</code></p>
<ul>
<li><strong>NPX execution:</strong></li>
</ul>
<p><code>bash
  # Execute the latest version from NPM without a global install
  npx @google/gemini-cli</code></p>
<hr />
<h3 id="2-running-in-a-sandbox-dockerpodman">2. Running in a sandbox (Docker/Podman)</h3>
<p>For security and isolation, Gemini CLI can be run inside a container. This is the default way that the CLI executes tools that might have side effects.</p>
<ul>
<li><strong>Directly from the Registry:</strong>
  You can run the published sandbox image directly. This is useful for environments where you only have Docker and want to run the CLI.
  <code>bash
  # Run the published sandbox image
  docker run --rm -it us-docker.pkg.dev/gemini-code-dev/gemini-cli/sandbox:0.1.1</code></li>
<li><strong>Using the <code>--sandbox</code> flag:</strong>
  If you have Gemini CLI installed locally (using the standard installation described above), you can instruct it to run inside the sandbox container.
  <code>bash
  gemini --sandbox -y -p "your prompt here"</code></li>
</ul>
<hr />
<h3 id="3-running-from-source-recommended-for-gemini-cli-contributors">3. Running from source (Recommended for Gemini CLI contributors)</h3>
<p>Contributors to the project will want to run the CLI directly from the source code.</p>
<ul>
<li><strong>Development Mode:</strong>
  This method provides hot-reloading and is useful for active development.
  <code>bash
  # From the root of the repository
  npm run start</code></li>
<li><strong>Production-like mode (Linked package):</strong>
  This method simulates a global installation by linking your local package. It's useful for testing a local build in a production workflow.</li>
</ul>
<p>```bash
  # Link the local cli package to your global node_modules
  npm link packages/cli</p>
<p># Now you can run your local version using the <code>gemini</code> command
  gemini
  ```</p>
<hr />
<h3 id="4-running-the-latest-gemini-cli-commit-from-github">4. Running the latest Gemini CLI commit from GitHub</h3>
<p>You can run the most recently committed version of Gemini CLI directly from the GitHub repository. This is useful for testing features still in development.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Execute the CLI directly from the main branch on GitHub</span>
npx<span class="w"> </span>https://github.com/google-gemini/gemini-cli
</code></pre></div>

<h2 id="deployment-architecture">Deployment architecture</h2>
<p>The execution methods described above are made possible by the following architectural components and processes:</p>
<p><strong>NPM packages</strong></p>
<p>Gemini CLI project is a monorepo that publishes two core packages to the NPM registry:</p>
<ul>
<li><code>@google/gemini-cli-core</code>: The backend, handling logic and tool execution.</li>
<li><code>@google/gemini-cli</code>: The user-facing frontend.</li>
</ul>
<p>These packages are used when performing the standard installation and when running Gemini CLI from the source.</p>
<p><strong>Build and packaging processes</strong></p>
<p>There are two distinct build processes used, depending on the distribution channel:</p>
<ul>
<li>
<p><strong>NPM publication:</strong> For publishing to the NPM registry, the TypeScript source code in <code>@google/gemini-cli-core</code> and <code>@google/gemini-cli</code> is transpiled into standard JavaScript using the TypeScript Compiler (<code>tsc</code>). The resulting <code>dist/</code> directory is what gets published in the NPM package. This is a standard approach for TypeScript libraries.</p>
</li>
<li>
<p><strong>GitHub <code>npx</code> execution:</strong> When running the latest version of Gemini CLI directly from GitHub, a different process is triggered by the <code>prepare</code> script in <code>package.json</code>. This script uses <code>esbuild</code> to bundle the entire application and its dependencies into a single, self-contained JavaScript file. This bundle is created on-the-fly on the user's machine and is not checked into the repository.</p>
</li>
</ul>
<p><strong>Docker sandbox image</strong></p>
<p>The Docker-based execution method is supported by the <code>gemini-cli-sandbox</code> container image. This image is published to a container registry and contains a pre-installed, global version of Gemini CLI.</p>
<h2 id="release-process">Release process</h2>
<p>The release process is automated through GitHub Actions. The release workflow performs the following actions:</p>
<ol>
<li>Build the NPM packages using <code>tsc</code>.</li>
<li>Publish the NPM packages to the artifact registry.</li>
<li>Create GitHub releases with bundled assets.</li>
</ol>
<p>‚îî‚îÄ‚îÄ examples/
  ‚îú‚îÄ‚îÄ proxy-script.md
    Content:</p>
<h1 id="example-proxy-script">Example Proxy Script</h1>
<p>The following is an example of a proxy script that can be used with the <code>GEMINI_SANDBOX_PROXY_COMMAND</code> environment variable. This script only allows <code>HTTPS</code> connections to <code>example.com:443</code> and declines all other requests.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/env node</span>

<span class="cm">/**</span>
<span class="cm"> * @license</span>
<span class="cm"> * Copyright 2025 Google LLC</span>
<span class="cm"> * SPDX-License-Identifier: Apache-2.0</span>
<span class="cm"> */</span>

<span class="c1">// Example proxy server that listens on :::8877 and only allows HTTPS connections to example.com.</span>
<span class="c1">// Set `GEMINI_SANDBOX_PROXY_COMMAND=scripts/example-proxy.js` to run proxy alongside sandbox</span>
<span class="c1">// Test via `curl https://example.com` inside sandbox (in shell mode or via shell tool)</span>

<span class="k">import</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;http&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">net</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;net&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">URL</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;url&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">console</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;console&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">PROXY_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">8877</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ALLOWED_DOMAINS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;example.com&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;googleapis.com&#39;</span><span class="p">];</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">ALLOWED_PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;443&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Deny all requests other than CONNECT for HTTPS</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<span class="w">    </span><span class="sb">`[PROXY] Denying non-CONNECT request for: </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">  </span><span class="p">);</span>
<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">405</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Method Not Allowed&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">clientSocket</span><span class="p">,</span><span class="w"> </span><span class="nx">head</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// req.url will be in the format &quot;hostname:port&quot; for a CONNECT request.</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">hostname</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="sb">`http://</span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[PROXY] Intercepted CONNECT request for: </span><span class="si">${</span><span class="nx">hostname</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">ALLOWED_DOMAINS</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span>
<span class="w">      </span><span class="p">(</span><span class="nx">domain</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">hostname</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">domain</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">hostname</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="sb">`.</span><span class="si">${</span><span class="nx">domain</span><span class="si">}</span><span class="sb">`</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span><span class="nx">port</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">ALLOWED_PORT</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[PROXY] Allowing connection to </span><span class="si">${</span><span class="nx">hostname</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Establish a TCP connection to the original destination.</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">serverSocket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">hostname</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">clientSocket</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;HTTP/1.1 200 Connection Established\r\n\r\n&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="c1">// Create a tunnel by piping data between the client and the destination server.</span>
<span class="w">      </span><span class="nx">serverSocket</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">head</span><span class="p">);</span>
<span class="w">      </span><span class="nx">serverSocket</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">clientSocket</span><span class="p">);</span>
<span class="w">      </span><span class="nx">clientSocket</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">serverSocket</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">serverSocket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[PROXY] Error connecting to destination: </span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">      </span><span class="nx">clientSocket</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`HTTP/1.1 502 Bad Gateway\r\n\r\n`</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[PROXY] Denying connection to </span><span class="si">${</span><span class="nx">hostname</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">    </span><span class="nx">clientSocket</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;HTTP/1.1 403 Forbidden\r\n\r\n&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nx">clientSocket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// This can happen if the client hangs up.</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[PROXY] Client socket error: </span><span class="si">${</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PROXY_PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">address</span><span class="p">();</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`[PROXY] Proxy listening on </span><span class="si">${</span><span class="nx">address</span><span class="p">.</span><span class="nx">address</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">address</span><span class="p">.</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
<span class="w">    </span><span class="sb">`[PROXY] Allowing HTTPS connections to domains: </span><span class="si">${</span><span class="nx">ALLOWED_DOMAINS</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>‚îú‚îÄ‚îÄ extension.md
  Content:</p>
<h1 id="gemini-cli-extensions">Gemini CLI Extensions</h1>
<p>Gemini CLI supports extensions that can be used to configure and extend its functionality.</p>
<h2 id="how-it-works_1">How it works</h2>
<p>On startup, Gemini CLI looks for extensions in two locations:</p>
<ol>
<li><code>&lt;workspace&gt;/.gemini/extensions</code></li>
<li><code>&lt;home&gt;/.gemini/extensions</code></li>
</ol>
<p>Gemini CLI loads all extensions from both locations. If an extension with the same name exists in both locations, the extension in the workspace directory takes precedence.</p>
<p>Within each location, individual extensions exist as a directory that contains a <code>gemini-extension.json</code> file. For example:</p>
<p><code>&lt;workspace&gt;/.gemini/extensions/my-extension/gemini-extension.json</code></p>
<h3 id="gemini-extensionjson"><code>gemini-extension.json</code></h3>
<p>The <code>gemini-extension.json</code> file contains the configuration for the extension. The file has the following structure:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-extension&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;my-server&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node my-server.js&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;contextFileName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GEMINI.md&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;excludeTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run_shell_command&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><code>name</code>: The name of the extension. This is used to uniquely identify the extension and for conflict resolution when extension commands have the same name as user or project commands.</li>
<li><code>version</code>: The version of the extension.</li>
<li><code>mcpServers</code>: A map of MCP servers to configure. The key is the name of the server, and the value is the server configuration. These servers will be loaded on startup just like MCP servers configured in a <a href="./cli/configuration.md"><code>settings.json</code> file</a>. If both an extension and a <code>settings.json</code> file configure an MCP server with the same name, the server defined in the <code>settings.json</code> file takes precedence.</li>
<li><code>contextFileName</code>: The name of the file that contains the context for the extension. This will be used to load the context from the workspace. If this property is not used but a <code>GEMINI.md</code> file is present in your extension directory, then that file will be loaded.</li>
<li><code>excludeTools</code>: An array of tool names to exclude from the model. You can also specify command-specific restrictions for tools that support it, like the <code>run_shell_command</code> tool. For example, <code>"excludeTools": ["run_shell_command(rm -rf)"]</code> will block the <code>rm -rf</code> command.</li>
</ul>
<p>When Gemini CLI starts, it loads all the extensions and merges their configurations. If there are any conflicts, the workspace configuration takes precedence.</p>
<h2 id="extension-commands">Extension Commands</h2>
<p>Extensions can provide <a href="./cli/commands.md#custom-commands">custom commands</a> by placing TOML files in a <code>commands/</code> subdirectory within the extension directory. These commands follow the same format as user and project custom commands and use standard naming conventions.</p>
<h3 id="example">Example</h3>
<p>An extension named <code>gcp</code> with the following structure:</p>
<div class="codehilite"><pre><span></span><code><span class="na">.gemini</span><span class="err">/</span><span class="no">extensions</span><span class="err">/</span><span class="no">gcp</span><span class="err">/</span>
<span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nf">gemini-extension.json</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nf">commands</span><span class="err">/</span>
<span class="w">    </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nf">deploy.toml</span>
<span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nf">gcs</span><span class="err">/</span>
<span class="w">        </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="nf">sync.toml</span>
</code></pre></div>

<p>Would provide these commands:</p>
<ul>
<li><code>/deploy</code> - Shows as <code>[gcp] Custom command from deploy.toml</code> in help</li>
<li><code>/gcs:sync</code> - Shows as <code>[gcp] Custom command from sync.toml</code> in help</li>
</ul>
<h3 id="conflict-resolution">Conflict Resolution</h3>
<p>Extension commands have the lowest precedence. When a conflict occurs with user or project commands:</p>
<ol>
<li><strong>No conflict</strong>: Extension command uses its natural name (e.g., <code>/deploy</code>)</li>
<li><strong>With conflict</strong>: Extension command is renamed with the extension prefix (e.g., <code>/gcp.deploy</code>)</li>
</ol>
<p>For example, if both a user and the <code>gcp</code> extension define a <code>deploy</code> command:</p>
<ul>
<li><code>/deploy</code> - Executes the user's deploy command</li>
<li><code>/gcp.deploy</code> - Executes the extension's deploy command (marked with <code>[gcp]</code> tag)</li>
</ul>
<p>‚îú‚îÄ‚îÄ gemini-ignore.md
  Content:</p>
<h1 id="ignoring-files">Ignoring Files</h1>
<p>This document provides an overview of the Gemini Ignore (<code>.geminiignore</code>) feature of the Gemini CLI.</p>
<p>The Gemini CLI includes the ability to automatically ignore files, similar to <code>.gitignore</code> (used by Git) and <code>.aiexclude</code> (used by Gemini Code Assist). Adding paths to your <code>.geminiignore</code> file will exclude them from tools that support this feature, although they will still be visible to other services (such as Git).</p>
<h2 id="how-it-works_2">How it works</h2>
<p>When you add a path to your <code>.geminiignore</code> file, tools that respect this file will exclude matching files and directories from their operations. For example, when you use the <a href="./tools/multi-file.md"><code>read_many_files</code></a> command, any paths in your <code>.geminiignore</code> file will be automatically excluded.</p>
<p>For the most part, <code>.geminiignore</code> follows the conventions of <code>.gitignore</code> files:</p>
<ul>
<li>Blank lines and lines starting with <code>#</code> are ignored.</li>
<li>Standard glob patterns are supported (such as <code>*</code>, <code>?</code>, and <code>[]</code>).</li>
<li>Putting a <code>/</code> at the end will only match directories.</li>
<li>Putting a <code>/</code> at the beginning anchors the path relative to the <code>.geminiignore</code> file.</li>
<li><code>!</code> negates a pattern.</li>
</ul>
<p>You can update your <code>.geminiignore</code> file at any time. To apply the changes, you must restart your Gemini CLI session.</p>
<h2 id="how-to-use-geminiignore">How to use <code>.geminiignore</code></h2>
<p>To enable <code>.geminiignore</code>:</p>
<ol>
<li>Create a file named <code>.geminiignore</code> in the root of your project directory.</li>
</ol>
<p>To add a file or directory to <code>.geminiignore</code>:</p>
<ol>
<li>Open your <code>.geminiignore</code> file.</li>
<li>Add the path or file you want to ignore, for example: <code>/archive/</code> or <code>apikeys.txt</code>.</li>
</ol>
<h3 id="geminiignore-examples"><code>.geminiignore</code> examples</h3>
<p>You can use <code>.geminiignore</code> to ignore directories and files:</p>
<div class="codehilite"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">Exclude</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="o">/</span><span class="nx">packages</span><span class="o">/</span><span class="w"> </span><span class="nx">directory</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">subdirectories</span>
<span class="o">/</span><span class="nx">packages</span><span class="o">/</span>

<span class="err">#</span><span class="w"> </span><span class="nx">Exclude</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">apikeys</span><span class="p">.</span><span class="nx">txt</span><span class="w"> </span><span class="nx">file</span>
<span class="nx">apikeys</span><span class="p">.</span><span class="nx">txt</span>
</code></pre></div>

<p>You can use wildcards in your <code>.geminiignore</code> file with <code>*</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="gh">#</span> Exclude all .md files
*.md
</code></pre></div>

<p>Finally, you can exclude files and directories from exclusion with <code>!</code>:</p>
<div class="codehilite"><pre><span></span><code>#<span class="w"> </span><span class="n">Exclude</span><span class="w"> </span><span class="nb">all</span><span class="w"> </span><span class="p">.</span><span class="n">md</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">except</span><span class="w"> </span><span class="n">README</span><span class="p">.</span><span class="n">md</span>
<span class="o">*</span><span class="p">.</span><span class="n">md</span>
<span class="sx">!README.md</span>
</code></pre></div>

<p>To remove paths from your <code>.geminiignore</code> file, delete the relevant lines.</p>
<p>‚îú‚îÄ‚îÄ index.md
  Content:</p>
<h1 id="welcome-to-gemini-cli-documentation">Welcome to Gemini CLI documentation</h1>
<p>This documentation provides a comprehensive guide to installing, using, and developing Gemini CLI. This tool lets you interact with Gemini models through a command-line interface.</p>
<h2 id="overview_1">Overview</h2>
<p>Gemini CLI brings the capabilities of Gemini models to your terminal in an interactive Read-Eval-Print Loop (REPL) environment. Gemini CLI consists of a client-side application (<code>packages/cli</code>) that communicates with a local server (<code>packages/core</code>), which in turn manages requests to the Gemini API and its AI models. Gemini CLI also contains a variety of tools for tasks such as performing file system operations, running shells, and web fetching, which are managed by <code>packages/core</code>.</p>
<h2 id="navigating-the-documentation">Navigating the documentation</h2>
<p>This documentation is organized into the following sections:</p>
<ul>
<li><strong><a href="./deployment.md">Execution and Deployment</a>:</strong> Information for running Gemini CLI.</li>
<li><strong><a href="./architecture.md">Architecture Overview</a>:</strong> Understand the high-level design of Gemini CLI, including its components and how they interact.</li>
<li><strong>CLI Usage:</strong> Documentation for <code>packages/cli</code>.</li>
<li><strong><a href="./cli/index.md">CLI Introduction</a>:</strong> Overview of the command-line interface.</li>
<li><strong><a href="./cli/commands.md">Commands</a>:</strong> Description of available CLI commands.</li>
<li><strong><a href="./cli/configuration.md">Configuration</a>:</strong> Information on configuring the CLI.</li>
<li><strong><a href="./checkpointing.md">Checkpointing</a>:</strong> Documentation for the checkpointing feature.</li>
<li><strong><a href="./extension.md">Extensions</a>:</strong> How to extend the CLI with new functionality.</li>
<li><strong><a href="./telemetry.md">Telemetry</a>:</strong> Overview of telemetry in the CLI.</li>
<li><strong>Core Details:</strong> Documentation for <code>packages/core</code>.</li>
<li><strong><a href="./core/index.md">Core Introduction</a>:</strong> Overview of the core component.</li>
<li><strong><a href="./core/tools-api.md">Tools API</a>:</strong> Information on how the core manages and exposes tools.</li>
<li><strong>Tools:</strong></li>
<li><strong><a href="./tools/index.md">Tools Overview</a>:</strong> Overview of the available tools.</li>
<li><strong><a href="./tools/file-system.md">File System Tools</a>:</strong> Documentation for the <code>read_file</code> and <code>write_file</code> tools.</li>
<li><strong><a href="./tools/multi-file.md">Multi-File Read Tool</a>:</strong> Documentation for the <code>read_many_files</code> tool.</li>
<li><strong><a href="./tools/shell.md">Shell Tool</a>:</strong> Documentation for the <code>run_shell_command</code> tool.</li>
<li><strong><a href="./tools/web-fetch.md">Web Fetch Tool</a>:</strong> Documentation for the <code>web_fetch</code> tool.</li>
<li><strong><a href="./tools/web-search.md">Web Search Tool</a>:</strong> Documentation for the <code>google_web_search</code> tool.</li>
<li><strong><a href="./tools/memory.md">Memory Tool</a>:</strong> Documentation for the <code>save_memory</code> tool.</li>
<li><strong><a href="../CONTRIBUTING.md">Contributing &amp; Development Guide</a>:</strong> Information for contributors and developers, including setup, building, testing, and coding conventions.</li>
<li><strong><a href="./npm.md">NPM Workspaces and Publishing</a>:</strong> Details on how the project's packages are managed and published.</li>
<li><strong><a href="./troubleshooting.md">Troubleshooting Guide</a>:</strong> Find solutions to common problems and FAQs.</li>
<li><strong><a href="./tos-privacy.md">Terms of Service and Privacy Notice</a>:</strong> Information on the terms of service and privacy notices applicable to your use of Gemini CLI.</li>
</ul>
<p>We hope this documentation helps you make the most of the Gemini CLI!</p>
<p>‚îú‚îÄ‚îÄ integration-tests.md
  Content:</p>
<h1 id="integration-tests">Integration Tests</h1>
<p>This document provides information about the integration testing framework used in this project.</p>
<h2 id="overview_2">Overview</h2>
<p>The integration tests are designed to validate the end-to-end functionality of the Gemini CLI. They execute the built binary in a controlled environment and verify that it behaves as expected when interacting with the file system.</p>
<p>These tests are located in the <code>integration-tests</code> directory and are run using a custom test runner.</p>
<h2 id="running-the-tests">Running the tests</h2>
<p>The integration tests are not run as part of the default <code>npm run test</code> command. They must be run explicitly using the <code>npm run test:integration:all</code> script.</p>
<p>The integration tests can also be run using the following shortcut:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>test:e2e
</code></pre></div>

<h2 id="running-a-specific-set-of-tests">Running a specific set of tests</h2>
<p>To run a subset of test files, you can use <code>npm run &lt;integration test command&gt; &lt;file_name1&gt; ....</code> where <integration test command> is either <code>test:e2e</code> or <code>test:integration*</code> and <code>&lt;file_name&gt;</code> is any of the <code>.test.js</code> files in the <code>integration-tests/</code> directory. For example, the following command runs <code>list_directory.test.js</code> and <code>write_file.test.js</code>:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>test:e2e<span class="w"> </span>list_directory<span class="w"> </span>write_file
</code></pre></div>

<h3 id="running-a-single-test-by-name">Running a single test by name</h3>
<p>To run a single test by its name, use the <code>--test-name-pattern</code> flag:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>test:e2e<span class="w"> </span>--<span class="w"> </span>--test-name-pattern<span class="w"> </span><span class="s2">&quot;reads a file&quot;</span>
</code></pre></div>

<h3 id="running-all-tests">Running all tests</h3>
<p>To run the entire suite of integration tests, use the following command:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>test:integration:all
</code></pre></div>

<h3 id="sandbox-matrix">Sandbox matrix</h3>
<p>The <code>all</code> command will run tests for <code>no sandboxing</code>, <code>docker</code> and <code>podman</code>.
Each individual type can be run using the following commands:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>test:integration:sandbox:none
</code></pre></div>

<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>test:integration:sandbox:docker
</code></pre></div>

<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>test:integration:sandbox:podman
</code></pre></div>

<h2 id="diagnostics">Diagnostics</h2>
<p>The integration test runner provides several options for diagnostics to help track down test failures.</p>
<h3 id="keeping-test-output">Keeping test output</h3>
<p>You can preserve the temporary files created during a test run for inspection. This is useful for debugging issues with file system operations.</p>
<p>To keep the test output, you can either use the <code>--keep-output</code> flag or set the <code>KEEP_OUTPUT</code> environment variable to <code>true</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Using the flag</span>
npm<span class="w"> </span>run<span class="w"> </span>test:integration:sandbox:none<span class="w"> </span>--<span class="w"> </span>--keep-output

<span class="c1"># Using the environment variable</span>
<span class="nv">KEEP_OUTPUT</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>test:integration:sandbox:none
</code></pre></div>

<p>When output is kept, the test runner will print the path to the unique directory for the test run.</p>
<h3 id="verbose-output">Verbose output</h3>
<p>For more detailed debugging, the <code>--verbose</code> flag streams the real-time output from the <code>gemini</code> command to the console.</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>test:integration:sandbox:none<span class="w"> </span>--<span class="w"> </span>--verbose
</code></pre></div>

<p>When using <code>--verbose</code> and <code>--keep-output</code> in the same command, the output is streamed to the console and also saved to a log file within the test's temporary directory.</p>
<p>The verbose output is formatted to clearly identify the source of the logs:</p>
<div class="codehilite"><pre><span></span><code><span class="gd">--- TEST: &lt;file-name-without-js&gt;:&lt;test-name&gt; ---</span>
... output from the gemini command ...
<span class="gd">--- END TEST: &lt;file-name-without-js&gt;:&lt;test-name&gt; ---</span>
</code></pre></div>

<h2 id="linting-and-formatting">Linting and formatting</h2>
<p>To ensure code quality and consistency, the integration test files are linted as part of the main build process. You can also manually run the linter and auto-fixer.</p>
<h3 id="running-the-linter">Running the linter</h3>
<p>To check for linting errors, run the following command:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>lint
</code></pre></div>

<p>You can include the <code>:fix</code> flag in the command to automatically fix any fixable linting errors:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>lint:fix
</code></pre></div>

<h2 id="directory-structure">Directory structure</h2>
<p>The integration tests create a unique directory for each test run inside the <code>.integration-tests</code> directory. Within this directory, a subdirectory is created for each test file, and within that, a subdirectory is created for each individual test case.</p>
<p>This structure makes it easy to locate the artifacts for a specific test run, file, or case.</p>
<div class="codehilite"><pre><span></span><code><span class="na">.integration-tests</span><span class="err">/</span>
<span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="err">&lt;</span><span class="nf">run-id</span><span class="err">&gt;/</span>
<span class="w">    </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="err">&lt;</span><span class="nf">test-file-name</span><span class="err">&gt;</span><span class="no">.test.js</span><span class="err">/</span>
<span class="w">        </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="err">&lt;</span><span class="nf">test-case-name</span><span class="err">&gt;/</span>
<span class="w">            </span><span class="err">‚îú‚îÄ‚îÄ</span><span class="w"> </span><span class="nf">output.log</span>
<span class="w">            </span><span class="err">‚îî‚îÄ‚îÄ</span><span class="w"> </span><span class="na">...other</span><span class="w"> </span><span class="no">test</span><span class="w"> </span><span class="no">artifacts...</span>
</code></pre></div>

<h2 id="continuous-integration">Continuous integration</h2>
<p>To ensure the integration tests are always run, a GitHub Actions workflow is defined in <code>.github/workflows/e2e.yml</code>. This workflow automatically runs the integrations tests for pull requests against the <code>main</code> branch, or when a pull request is added to a merge queue.</p>
<p>The workflow runs the tests in different sandboxing environments to ensure Gemini CLI is tested across each:</p>
<ul>
<li><code>sandbox:none</code>: Runs the tests without any sandboxing.</li>
<li><code>sandbox:docker</code>: Runs the tests in a Docker container.</li>
<li><code>sandbox:podman</code>: Runs the tests in a Podman container.</li>
</ul>
<p>‚îú‚îÄ‚îÄ issue-and-pr-automation.md
  Content:</p>
<h1 id="automation-and-triage-processes">Automation and Triage Processes</h1>
<p>This document provides a detailed overview of the automated processes we use to manage and triage issues and pull requests. Our goal is to provide prompt feedback and ensure that contributions are reviewed and integrated efficiently. Understanding this automation will help you as a contributor know what to expect and how to best interact with our repository bots.</p>
<h2 id="guiding-principle-issues-and-pull-requests">Guiding Principle: Issues and Pull Requests</h2>
<p>First and foremost, almost every Pull Request (PR) should be linked to a corresponding Issue. The issue describes the "what" and the "why" (the bug or feature), while the PR is the "how" (the implementation). This separation helps us track work, prioritize features, and maintain clear historical context. Our automation is built around this principle.</p>
<hr />
<h2 id="detailed-automation-workflows">Detailed Automation Workflows</h2>
<p>Here is a breakdown of the specific automation workflows that run in our repository.</p>
<h3 id="1-when-you-open-an-issue-automated-issue-triage">1. When you open an Issue: <code>Automated Issue Triage</code></h3>
<p>This is the first bot you will interact with when you create an issue. Its job is to perform an initial analysis and apply the correct labels.</p>
<ul>
<li><strong>Workflow File</strong>: <code>.github/workflows/gemini-automated-issue-triage.yml</code></li>
<li><strong>When it runs</strong>: Immediately after an issue is created or reopened.</li>
<li><strong>What it does</strong>:</li>
<li>It uses a Gemini model to analyze the issue's title and body against a detailed set of guidelines.</li>
<li><strong>Applies one <code>area/*</code> label</strong>: Categorizes the issue into a functional area of the project (e.g., <code>area/ux</code>, <code>area/models</code>, <code>area/platform</code>).</li>
<li><strong>Applies one <code>kind/*</code> label</strong>: Identifies the type of issue (e.g., <code>kind/bug</code>, <code>kind/enhancement</code>, <code>kind/question</code>).</li>
<li><strong>Applies one <code>priority/*</code> label</strong>: Assigns a priority from P0 (critical) to P3 (low) based on the described impact.</li>
<li><strong>May apply <code>status/need-information</code></strong>: If the issue lacks critical details (like logs or reproduction steps), it will be flagged for more information.</li>
<li><strong>May apply <code>status/need-retesting</code></strong>: If the issue references a CLI version that is more than six versions old, it will be flagged for retesting on a current version.</li>
<li><strong>What you should do</strong>:</li>
<li>Fill out the issue template as completely as possible. The more detail you provide, the more accurate the triage will be.</li>
<li>If the <code>status/need-information</code> label is added, please provide the requested details in a comment.</li>
</ul>
<h3 id="2-when-you-open-a-pull-request-continuous-integration-ci">2. When you open a Pull Request: <code>Continuous Integration (CI)</code></h3>
<p>This workflow ensures that all changes meet our quality standards before they can be merged.</p>
<ul>
<li><strong>Workflow File</strong>: <code>.github/workflows/ci.yml</code></li>
<li><strong>When it runs</strong>: On every push to a pull request.</li>
<li><strong>What it does</strong>:</li>
<li><strong>Lint</strong>: Checks that your code adheres to our project's formatting and style rules.</li>
<li><strong>Test</strong>: Runs our full suite of automated tests across macOS, Windows, and Linux, and on multiple Node.js versions. This is the most time-consuming part of the CI process.</li>
<li><strong>Post Coverage Comment</strong>: After all tests have successfully passed, a bot will post a comment on your PR. This comment provides a summary of how well your changes are covered by tests.</li>
<li><strong>What you should do</strong>:</li>
<li>Ensure all CI checks pass. A green checkmark ‚úÖ will appear next to your commit when everything is successful.</li>
<li>If a check fails (a red "X" ‚ùå), click the "Details" link next to the failed check to view the logs, identify the problem, and push a fix.</li>
</ul>
<h3 id="3-ongoing-triage-for-pull-requests-pr-auditing-and-label-sync">3. Ongoing Triage for Pull Requests: <code>PR Auditing and Label Sync</code></h3>
<p>This workflow runs periodically to ensure all open PRs are correctly linked to issues and have consistent labels.</p>
<ul>
<li><strong>Workflow File</strong>: <code>.github/workflows/gemini-scheduled-pr-triage.yml</code></li>
<li><strong>When it runs</strong>: Every 15 minutes on all open pull requests.</li>
<li><strong>What it does</strong>:</li>
<li><strong>Checks for a linked issue</strong>: The bot scans your PR description for a keyword that links it to an issue (e.g., <code>Fixes #123</code>, <code>Closes #456</code>).</li>
<li><strong>Adds <code>status/need-issue</code></strong>: If no linked issue is found, the bot will add the <code>status/need-issue</code> label to your PR. This is a clear signal that an issue needs to be created and linked.</li>
<li><strong>Synchronizes labels</strong>: If an issue <em>is</em> linked, the bot ensures the PR's labels perfectly match the issue's labels. It will add any missing labels and remove any that don't belong, and it will remove the <code>status/need-issue</code> label if it was present.</li>
<li><strong>What you should do</strong>:</li>
<li><strong>Always link your PR to an issue.</strong> This is the most important step. Add a line like <code>Resolves #&lt;issue-number&gt;</code> to your PR description.</li>
<li>This will ensure your PR is correctly categorized and moves through the review process smoothly.</li>
</ul>
<h3 id="4-ongoing-triage-for-issues-scheduled-issue-triage">4. Ongoing Triage for Issues: <code>Scheduled Issue Triage</code></h3>
<p>This is a fallback workflow to ensure that no issue gets missed by the triage process.</p>
<ul>
<li><strong>Workflow File</strong>: <code>.github/workflows/gemini-scheduled-issue-triage.yml</code></li>
<li><strong>When it runs</strong>: Every hour on all open issues.</li>
<li><strong>What it does</strong>:</li>
<li>It actively seeks out issues that either have no labels at all or still have the <code>status/need-triage</code> label.</li>
<li>It then triggers the same powerful Gemini-based analysis as the initial triage bot to apply the correct labels.</li>
<li><strong>What you should do</strong>:</li>
<li>You typically don't need to do anything. This workflow is a safety net to ensure every issue is eventually categorized, even if the initial triage fails.</li>
</ul>
<h3 id="5-release-automation">5. Release Automation</h3>
<p>This workflow handles the process of packaging and publishing new versions of the Gemini CLI.</p>
<ul>
<li><strong>Workflow File</strong>: <code>.github/workflows/release.yml</code></li>
<li><strong>When it runs</strong>: On a daily schedule for "nightly" releases, and manually for official patch/minor releases.</li>
<li><strong>What it does</strong>:</li>
<li>Automatically builds the project, bumps the version numbers, and publishes the packages to npm.</li>
<li>Creates a corresponding release on GitHub with generated release notes.</li>
<li><strong>What you should do</strong>:</li>
<li>As a contributor, you don't need to do anything for this process. You can be confident that once your PR is merged into the <code>main</code> branch, your changes will be included in the very next nightly release.</li>
</ul>
<p>We hope this detailed overview is helpful. If you have any questions about our automation or processes, please don't hesitate to ask!</p>
<p>‚îú‚îÄ‚îÄ keyboard-shortcuts.md
  Content:</p>
<h1 id="gemini-cli-keyboard-shortcuts">Gemini CLI Keyboard Shortcuts</h1>
<p>This document lists the available keyboard shortcuts in the Gemini CLI.</p>
<h2 id="general">General</h2>
<table>
<thead>
<tr>
<th>Shortcut</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Esc</code></td>
<td>Close dialogs and suggestions.</td>
</tr>
<tr>
<td><code>Ctrl+C</code></td>
<td>Exit the application. Press twice to confirm.</td>
</tr>
<tr>
<td><code>Ctrl+D</code></td>
<td>Exit the application if the input is empty. Press twice to confirm.</td>
</tr>
<tr>
<td><code>Ctrl+L</code></td>
<td>Clear the screen.</td>
</tr>
<tr>
<td><code>Ctrl+O</code></td>
<td>Toggle the display of the debug console.</td>
</tr>
<tr>
<td><code>Ctrl+S</code></td>
<td>Allows long responses to print fully, disabling truncation. Use your terminal's scrollback to view the entire output.</td>
</tr>
<tr>
<td><code>Ctrl+T</code></td>
<td>Toggle the display of tool descriptions.</td>
</tr>
<tr>
<td><code>Ctrl+Y</code></td>
<td>Toggle auto-approval (YOLO mode) for all tool calls.</td>
</tr>
</tbody>
</table>
<h2 id="input-prompt">Input Prompt</h2>
<table>
<thead>
<tr>
<th>Shortcut</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>!</code></td>
<td>Toggle shell mode when the input is empty.</td>
</tr>
<tr>
<td><code>\</code> (at end of line) + <code>Enter</code></td>
<td>Insert a newline.</td>
</tr>
<tr>
<td><code>Down Arrow</code></td>
<td>Navigate down through the input history.</td>
</tr>
<tr>
<td><code>Enter</code></td>
<td>Submit the current prompt.</td>
</tr>
<tr>
<td><code>Meta+Delete</code> / <code>Ctrl+Delete</code></td>
<td>Delete the word to the right of the cursor.</td>
</tr>
<tr>
<td><code>Tab</code></td>
<td>Autocomplete the current suggestion if one exists.</td>
</tr>
<tr>
<td><code>Up Arrow</code></td>
<td>Navigate up through the input history.</td>
</tr>
<tr>
<td><code>Ctrl+A</code> / <code>Home</code></td>
<td>Move the cursor to the beginning of the line.</td>
</tr>
<tr>
<td><code>Ctrl+B</code> / <code>Left Arrow</code></td>
<td>Move the cursor one character to the left.</td>
</tr>
<tr>
<td><code>Ctrl+C</code></td>
<td>Clear the input prompt</td>
</tr>
<tr>
<td><code>Ctrl+D</code> / <code>Delete</code></td>
<td>Delete the character to the right of the cursor.</td>
</tr>
<tr>
<td><code>Ctrl+E</code> / <code>End</code></td>
<td>Move the cursor to the end of the line.</td>
</tr>
<tr>
<td><code>Ctrl+F</code> / <code>Right Arrow</code></td>
<td>Move the cursor one character to the right.</td>
</tr>
<tr>
<td><code>Ctrl+H</code> / <code>Backspace</code></td>
<td>Delete the character to the left of the cursor.</td>
</tr>
<tr>
<td><code>Ctrl+K</code></td>
<td>Delete from the cursor to the end of the line.</td>
</tr>
<tr>
<td><code>Ctrl+Left Arrow</code> / <code>Meta+Left Arrow</code> / <code>Meta+B</code></td>
<td>Move the cursor one word to the left.</td>
</tr>
<tr>
<td><code>Ctrl+N</code></td>
<td>Navigate down through the input history.</td>
</tr>
<tr>
<td><code>Ctrl+P</code></td>
<td>Navigate up through the input history.</td>
</tr>
<tr>
<td><code>Ctrl+Right Arrow</code> / <code>Meta+Right Arrow</code> / <code>Meta+F</code></td>
<td>Move the cursor one word to the right.</td>
</tr>
<tr>
<td><code>Ctrl+U</code></td>
<td>Delete from the cursor to the beginning of the line.</td>
</tr>
<tr>
<td><code>Ctrl+V</code></td>
<td>Paste clipboard content. If the clipboard contains an image, it will be saved and a reference to it will be inserted in the prompt.</td>
</tr>
<tr>
<td><code>Ctrl+W</code> / <code>Meta+Backspace</code> / <code>Ctrl+Backspace</code></td>
<td>Delete the word to the left of the cursor.</td>
</tr>
<tr>
<td><code>Ctrl+X</code> / <code>Meta+Enter</code></td>
<td>Open the current input in an external editor.</td>
</tr>
</tbody>
</table>
<h2 id="suggestions">Suggestions</h2>
<table>
<thead>
<tr>
<th>Shortcut</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Down Arrow</code></td>
<td>Navigate down through the suggestions.</td>
</tr>
<tr>
<td><code>Tab</code> / <code>Enter</code></td>
<td>Accept the selected suggestion.</td>
</tr>
<tr>
<td><code>Up Arrow</code></td>
<td>Navigate up through the suggestions.</td>
</tr>
</tbody>
</table>
<h2 id="radio-button-select">Radio Button Select</h2>
<table>
<thead>
<tr>
<th>Shortcut</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Down Arrow</code> / <code>j</code></td>
<td>Move selection down.</td>
</tr>
<tr>
<td><code>Enter</code></td>
<td>Confirm selection.</td>
</tr>
<tr>
<td><code>Up Arrow</code> / <code>k</code></td>
<td>Move selection up.</td>
</tr>
<tr>
<td><code>1-9</code></td>
<td>Select an item by its number.</td>
</tr>
<tr>
<td>(multi-digit)</td>
<td>For items with numbers greater than 9, press the digits in quick succession to select the corresponding item.</td>
</tr>
</tbody>
</table>
<p>‚îú‚îÄ‚îÄ npm.md
  Content:</p>
<h1 id="package-overview">Package Overview</h1>
<p>This monorepo contains two main packages: <code>@google/gemini-cli</code> and <code>@google/gemini-cli-core</code>.</p>
<h2 id="googlegemini-cli"><code>@google/gemini-cli</code></h2>
<p>This is the main package for the Gemini CLI. It is responsible for the user interface, command parsing, and all other user-facing functionality.</p>
<p>When this package is published, it is bundled into a single executable file. This bundle includes all of the package's dependencies, including <code>@google/gemini-cli-core</code>. This means that whether a user installs the package with <code>npm install -g @google/gemini-cli</code> or runs it directly with <code>npx @google/gemini-cli</code>, they are using this single, self-contained executable.</p>
<h2 id="googlegemini-cli-core"><code>@google/gemini-cli-core</code></h2>
<p>This package contains the core logic for interacting with the Gemini API. It is responsible for making API requests, handling authentication, and managing the local cache.</p>
<p>This package is not bundled. When it is published, it is published as a standard Node.js package with its own dependencies. This allows it to be used as a standalone package in other projects, if needed. All transpiled js code in the <code>dist</code> folder is included in the package.</p>
<h1 id="release-process_1">Release Process</h1>
<p>This project follows a structured release process to ensure that all packages are versioned and published correctly. The process is designed to be as automated as possible.</p>
<h2 id="how-to-release">How To Release</h2>
<p>Releases are managed through the <a href="https://github.com/google-gemini/gemini-cli/actions/workflows/release.yml">release.yml</a> GitHub Actions workflow. To perform a manual release for a patch or hotfix:</p>
<ol>
<li>Navigate to the <strong>Actions</strong> tab of the repository.</li>
<li>Select the <strong>Release</strong> workflow from the list.</li>
<li>Click the <strong>Run workflow</strong> dropdown button.</li>
<li>Fill in the required inputs:<ul>
<li><strong>Version</strong>: The exact version to release (e.g., <code>v0.2.1</code>).</li>
<li><strong>Ref</strong>: The branch or commit SHA to release from (defaults to <code>main</code>).</li>
<li><strong>Dry Run</strong>: Leave as <code>true</code> to test the workflow without publishing, or set to <code>false</code> to perform a live release.</li>
</ul>
</li>
<li>Click <strong>Run workflow</strong>.</li>
</ol>
<h2 id="nightly-releases">Nightly Releases</h2>
<p>In addition to manual releases, this project has an automated nightly release process to provide the latest "bleeding edge" version for testing and development.</p>
<h3 id="process">Process</h3>
<p>Every night at midnight UTC, the <a href="https://github.com/google-gemini/gemini-cli/actions/workflows/release.yml">Release workflow</a> runs automatically on a schedule. It performs the following steps:</p>
<ol>
<li>Checks out the latest code from the <code>main</code> branch.</li>
<li>Installs all dependencies.</li>
<li>Runs the full suite of <code>preflight</code> checks and integration tests.</li>
<li>If all tests succeed, it calculates the next nightly version number (e.g., <code>v0.2.1-nightly.20230101</code>).</li>
<li>It then builds and publishes the packages to npm with the <code>nightly</code> dist-tag.</li>
<li>Finally, it creates a GitHub Release for the nightly version.</li>
</ol>
<h3 id="failure-handling">Failure Handling</h3>
<p>If any step in the nightly workflow fails, it will automatically create a new issue in the repository with the labels <code>bug</code> and <code>nightly-failure</code>. The issue will contain a link to the failed workflow run for easy debugging.</p>
<h3 id="how-to-use-the-nightly-build">How to Use the Nightly Build</h3>
<p>To install the latest nightly build, use the <code>@nightly</code> tag:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@google/gemini-cli@nightly
</code></pre></div>

<p>We also run a Google cloud build called <a href="../.gcp/release-docker.yaml">release-docker.yml</a>. Which publishes the sandbox docker to match your release. This will also be moved to GH and combined with the main release file once service account permissions are sorted out.</p>
<h3 id="after-the-release">After the Release</h3>
<p>After the workflow has successfully completed, you can monitor its progress in the <a href="https://github.com/google-gemini/gemini-cli/actions/workflows/release.yml">GitHub Actions tab</a>. Once complete, you should:</p>
<ol>
<li>Go to the <a href="https://github.com/google-gemini/gemini-cli/pulls">pull requests page</a> of the repository.</li>
<li>Create a new pull request from the <code>release/vX.Y.Z</code> branch to <code>main</code>.</li>
<li>Review the pull request (it should only contain version updates in <code>package.json</code> files) and merge it. This keeps the version in <code>main</code> up-to-date.</li>
</ol>
<h2 id="release-validation">Release Validation</h2>
<p>After pushing a new release smoke testing should be performed to ensure that the packages are working as expected. This can be done by installing the packages locally and running a set of tests to ensure that they are functioning correctly.</p>
<ul>
<li><code>npx -y @google/gemini-cli@latest --version</code> to validate the push worked as expected if you were not doing a rc or dev tag</li>
<li><code>npx -y @google/gemini-cli@&lt;release tag&gt; --version</code> to validate the tag pushed appropriately</li>
<li><em>This is destructive locally</em> <code>npm uninstall @google/gemini-cli &amp;&amp; npm uninstall -g @google/gemini-cli &amp;&amp; npm cache clean --force &amp;&amp;  npm install @google/gemini-cli@&lt;version&gt;</code></li>
<li>Smoke testing a basic run through of exercising a few llm commands and tools is recommended to ensure that the packages are working as expected. We'll codify this more in the future.</li>
</ul>
<h2 id="when-to-merge-the-version-change-or-not">When to merge the version change, or not?</h2>
<p>The above pattern for creating patch or hotfix releases from current or older commits leaves the repository in the following state:</p>
<ol>
<li>The Tag (<code>vX.Y.Z-patch.1</code>): This tag correctly points to the original commit on main
    that contains the stable code you intended to release. This is crucial. Anyone checking
    out this tag gets the exact code that was published.</li>
<li>The Branch (<code>release-vX.Y.Z-patch.1</code>): This branch contains one new commit on top of the
    tagged commit. That new commit only contains the version number change in package.json
    (and other related files like package-lock.json).</li>
</ol>
<p>This separation is good. It keeps your main branch history clean of release-specific
version bumps until you decide to merge them.</p>
<p>This is the critical decision, and it depends entirely on the nature of the release.</p>
<h3 id="merge-back-for-stable-patches-and-hotfixes">Merge Back for Stable Patches and Hotfixes</h3>
<p>You almost always want to merge the <code>release-&lt;tag&gt;</code> branch back into <code>main</code> for any
stable patch or hotfix release.</p>
<ul>
<li>Why? The primary reason is to update the version in main's package.json. If you release
  v1.2.1 from an older commit but never merge the version bump back, your main branch's
  package.json will still say "version": "1.2.0". The next developer who starts work for
  the next feature release (v1.3.0) will be branching from a codebase that has an
  incorrect, older version number. This leads to confusion and requires manual version
  bumping later.</li>
<li>The Process: After the release-v1.2.1 branch is created and the package is successfully
  published, you should open a pull request to merge release-v1.2.1 into main. This PR
  will contain just one commit: "chore: bump version to v1.2.1". It's a clean, simple
  integration that keeps your main branch in sync with the latest released version.</li>
</ul>
<h3 id="do-not-merge-back-for-pre-releases-rc-beta-dev">Do NOT Merge Back for Pre-Releases (RC, Beta, Dev)</h3>
<p>You typically do not merge release branches for pre-releases back into <code>main</code>.</p>
<ul>
<li>Why? Pre-release versions (e.g., v1.3.0-rc.1, v1.3.0-rc.2) are, by definition, not
  stable and are temporary. You don't want to pollute your main branch's history with a
  series of version bumps for release candidates. The package.json in main should reflect
  the latest stable release version, not an RC.</li>
<li>The Process: The release-v1.3.0-rc.1 branch is created, the npm publish --tag rc happens,
  and then... the branch has served its purpose. You can simply delete it. The code for
  the RC is already on main (or a feature branch), so no functional code is lost. The
  release branch was just a temporary vehicle for the version number.</li>
</ul>
<h2 id="local-testing-and-validation-changes-to-the-packaging-and-publishing-process">Local Testing and Validation: Changes to the Packaging and Publishing Process</h2>
<p>If you need to test the release process without actually publishing to NPM or creating a public GitHub release, you can trigger the workflow manually from the GitHub UI.</p>
<ol>
<li>Go to the <a href="https://github.com/google-gemini/gemini-cli/actions/workflows/release.yml">Actions tab</a> of the repository.</li>
<li>Click on the "Run workflow" dropdown.</li>
<li>Leave the <code>dry_run</code> option checked (<code>true</code>).</li>
<li>Click the "Run workflow" button.</li>
</ol>
<p>This will run the entire release process but will skip the <code>npm publish</code> and <code>gh release create</code> steps. You can inspect the workflow logs to ensure everything is working as expected.</p>
<p>It is crucial to test any changes to the packaging and publishing process locally before committing them. This ensures that the packages will be published correctly and that they will work as expected when installed by a user.</p>
<p>To validate your changes, you can perform a dry run of the publishing process. This will simulate the publishing process without actually publishing the packages to the npm registry.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">npm_package_version</span><span class="o">=</span><span class="m">9</span>.9.9<span class="w"> </span><span class="nv">SANDBOX_IMAGE_REGISTRY</span><span class="o">=</span><span class="s2">&quot;registry&quot;</span><span class="w"> </span><span class="nv">SANDBOX_IMAGE_NAME</span><span class="o">=</span><span class="s2">&quot;thename&quot;</span><span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>publish:npm<span class="w"> </span>--dry-run
</code></pre></div>

<p>This command will do the following:</p>
<ol>
<li>Build all the packages.</li>
<li>Run all the prepublish scripts.</li>
<li>Create the package tarballs that would be published to npm.</li>
<li>Print a summary of the packages that would be published.</li>
</ol>
<p>You can then inspect the generated tarballs to ensure that they contain the correct files and that the <code>package.json</code> files have been updated correctly. The tarballs will be created in the root of each package's directory (e.g., <code>packages/cli/google-gemini-cli-0.1.6.tgz</code>).</p>
<p>By performing a dry run, you can be confident that your changes to the packaging process are correct and that the packages will be published successfully.</p>
<h2 id="release-deep-dive">Release Deep Dive</h2>
<p>The main goal of the release process is to take the source code from the packages/ directory, build it, and assemble a
clean, self-contained package in a temporary <code>bundle</code> directory at the root of the project. This <code>bundle</code> directory is what
actually gets published to NPM.</p>
<p>Here are the key stages:</p>
<p>Stage 1: Pre-Release Sanity Checks and Versioning</p>
<ul>
<li>What happens: Before any files are moved, the process ensures the project is in a good state. This involves running tests,
  linting, and type-checking (npm run preflight). The version number in the root package.json and packages/cli/package.json
  is updated to the new release version.</li>
<li>Why: This guarantees that only high-quality, working code is released. Versioning is the first step to signify a new
  release.</li>
</ul>
<p>Stage 2: Building the Source Code</p>
<ul>
<li>What happens: The TypeScript source code in packages/core/src and packages/cli/src is compiled into JavaScript.</li>
<li>File movement:</li>
<li>packages/core/src/*<em>/</em>.ts -&gt; compiled to -&gt; packages/core/dist/</li>
<li>packages/cli/src/*<em>/</em>.ts -&gt; compiled to -&gt; packages/cli/dist/</li>
<li>Why: The TypeScript code written during development needs to be converted into plain JavaScript that can be run by
  Node.js. The core package is built first as the cli package depends on it.</li>
</ul>
<p>Stage 3: Assembling the Final Publishable Package</p>
<p>This is the most critical stage where files are moved and transformed into their final state for publishing. A temporary
<code>bundle</code> folder is created at the project root to house the final package contents.</p>
<ol>
<li>
<p>The <code>package.json</code> is Transformed:</p>
<ul>
<li>What happens: The package.json from packages/cli/ is read, modified, and written into the root <code>bundle</code>/ directory.</li>
<li>File movement: packages/cli/package.json -&gt; (in-memory transformation) -&gt; <code>bundle</code>/package.json</li>
<li>Why: The final package.json must be different from the one used in development. Key changes include:</li>
<li>Removing devDependencies.</li>
<li>Removing workspace-specific "dependencies": { "@gemini-cli/core": "workspace:*" } and ensuring the core code is
    bundled directly into the final JavaScript file.</li>
<li>Ensuring the bin, main, and files fields point to the correct locations within the final package structure.</li>
</ul>
</li>
<li>
<p>The JavaScript Bundle is Created:</p>
<ul>
<li>What happens: The built JavaScript from both packages/core/dist and packages/cli/dist are bundled into a single,
  executable JavaScript file.</li>
<li>File movement: packages/cli/dist/index.js + packages/core/dist/index.js -&gt; (bundled by esbuild) -&gt; <code>bundle</code>/gemini.js (or a
  similar name).</li>
<li>Why: This creates a single, optimized file that contains all the necessary application code. It simplifies the package
  by removing the need for the core package to be a separate dependency on NPM, as its code is now included directly.</li>
</ul>
</li>
<li>
<p>Static and Supporting Files are Copied:</p>
<ul>
<li>What happens: Essential files that are not part of the source code but are required for the package to work correctly
  or be well-described are copied into the <code>bundle</code> directory.</li>
<li>File movement:</li>
<li>README.md -&gt; <code>bundle</code>/README.md</li>
<li>LICENSE -&gt; <code>bundle</code>/LICENSE</li>
<li>packages/cli/src/utils/*.sb (sandbox profiles) -&gt; <code>bundle</code>/</li>
<li>Why:</li>
<li>The README.md and LICENSE are standard files that should be included in any NPM package.</li>
<li>The sandbox profiles (.sb files) are critical runtime assets required for the CLI's sandboxing feature to
    function. They must be located next to the final executable.</li>
</ul>
</li>
</ol>
<p>Stage 4: Publishing to NPM</p>
<ul>
<li>What happens: The npm publish command is run from inside the root <code>bundle</code> directory.</li>
<li>Why: By running npm publish from within the <code>bundle</code> directory, only the files we carefully assembled in Stage 3 are uploaded
  to the NPM registry. This prevents any source code, test files, or development configurations from being accidentally
  published, resulting in a clean and minimal package for users.</li>
</ul>
<p>Summary of File Flow</p>
<div class="codehilite"><pre><span></span><code><span class="nx">graph</span><span class="w"> </span><span class="nx">TD</span>
<span class="w">    </span><span class="nx">subgraph</span><span class="w"> </span><span class="s">&quot;Source Files&quot;</span>
<span class="w">        </span><span class="nx">A</span><span class="p">[</span><span class="s">&quot;packages/core/src/*.ts&lt;br/&gt;packages/cli/src/*.ts&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="nx">B</span><span class="p">[</span><span class="s">&quot;packages/cli/package.json&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="nx">C</span><span class="p">[</span><span class="s">&quot;README.md&lt;br/&gt;LICENSE&lt;br/&gt;packages/cli/src/utils/*.sb&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="nx">end</span>

<span class="w">    </span><span class="nx">subgraph</span><span class="w"> </span><span class="s">&quot;Process&quot;</span>
<span class="w">        </span><span class="nx">D</span><span class="p">(</span><span class="nx">Build</span><span class="p">)</span>
<span class="w">        </span><span class="nx">E</span><span class="p">(</span><span class="nx">Transform</span><span class="p">)</span>
<span class="w">        </span><span class="nx">F</span><span class="p">(</span><span class="nx">Assemble</span><span class="p">)</span>
<span class="w">        </span><span class="nx">G</span><span class="p">(</span><span class="nx">Publish</span><span class="p">)</span>
<span class="w">    </span><span class="nx">end</span>

<span class="w">    </span><span class="nx">subgraph</span><span class="w"> </span><span class="s">&quot;Artifacts&quot;</span>
<span class="w">        </span><span class="nx">H</span><span class="p">[</span><span class="s">&quot;Bundled JS&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="nx">I</span><span class="p">[</span><span class="s">&quot;Final package.json&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="nx">J</span><span class="p">[</span><span class="s">&quot;bundle/&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="nx">end</span>

<span class="w">    </span><span class="nx">subgraph</span><span class="w"> </span><span class="s">&quot;Destination&quot;</span>
<span class="w">        </span><span class="nx">K</span><span class="p">[</span><span class="s">&quot;NPM Registry&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="nx">end</span>

<span class="w">    </span><span class="nx">A</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">D</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">H</span>
<span class="w">    </span><span class="nx">B</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">E</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">I</span>
<span class="w">    </span><span class="nx">C</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">F</span>
<span class="w">    </span><span class="nx">H</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">F</span>
<span class="w">    </span><span class="nx">I</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">F</span>
<span class="w">    </span><span class="nx">F</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">J</span>
<span class="w">    </span><span class="nx">J</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">G</span><span class="w"> </span><span class="o">--</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">K</span>
</code></pre></div>

<p>This process ensures that the final published artifact is a purpose-built, clean, and efficient representation of the
project, rather than a direct copy of the development workspace.</p>
<h2 id="npm-workspaces">NPM Workspaces</h2>
<p>This project uses <a href="https://docs.npmjs.com/cli/v10/using-npm/workspaces">NPM Workspaces</a> to manage the packages within this monorepo. This simplifies development by allowing us to manage dependencies and run scripts across multiple packages from the root of the project.</p>
<h3 id="how-it-works_3">How it Works</h3>
<p>The root <code>package.json</code> file defines the workspaces for this project:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;workspaces&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;packages/*&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>This tells NPM that any folder inside the <code>packages</code> directory is a separate package that should be managed as part of the workspace.</p>
<h3 id="benefits-of-workspaces">Benefits of Workspaces</h3>
<ul>
<li><strong>Simplified Dependency Management</strong>: Running <code>npm install</code> from the root of the project will install all dependencies for all packages in the workspace and link them together. This means you don't need to run <code>npm install</code> in each package's directory.</li>
<li><strong>Automatic Linking</strong>: Packages within the workspace can depend on each other. When you run <code>npm install</code>, NPM will automatically create symlinks between the packages. This means that when you make changes to one package, the changes are immediately available to other packages that depend on it.</li>
<li><strong>Simplified Script Execution</strong>: You can run scripts in any package from the root of the project using the <code>--workspace</code> flag. For example, to run the <code>build</code> script in the <code>cli</code> package, you can run <code>npm run build --workspace @google/gemini-cli</code>.</li>
</ul>
<p>‚îú‚îÄ‚îÄ quota-and-pricing.md
  Content:</p>
<h1 id="gemini-cli-quotas-and-pricing">Gemini CLI: Quotas and Pricing</h1>
<p>Your Gemini CLI quotas and pricing depend on the type of account you use to authenticate with Google. Additionally, both quotas and pricing may be calculated differently based on the model version, requests, and tokens used. A summary of model usage is available through the <code>/stats</code> command and presented on exit at the end of a session. See <a href="./tos-privacy.md">privacy and terms</a> for details on Privacy policy and Terms of Service. Note: published prices are list price; additional negotiated commercial discounting may apply.</p>
<p>This article outlines the specific quotas and pricing applicable to the Gemini CLI when using different authentication methods.</p>
<h2 id="1-log-in-with-google-gemini-code-assist-free-tier">1. Log in with Google (Gemini Code Assist Free Tier)</h2>
<p>For users who authenticate by using their Google account to access Gemini Code Assist for individuals:</p>
<ul>
<li><strong>Quota:</strong></li>
<li>60 requests per minute</li>
<li>1000 requests per day</li>
<li>Token usage is not applicable</li>
<li><strong>Cost:</strong> Free</li>
<li><strong>Details:</strong> <a href="https://developers.google.com/gemini-code-assist/resources/quotas#quotas-for-agent-mode-gemini-cli">Gemini Code Assist Quotas</a></li>
<li><strong>Notes:</strong> A specific quota for different models is not specified; model fallback may occur to preserve shared experience quality.</li>
</ul>
<h2 id="2-gemini-api-key-unpaid">2. Gemini API Key (Unpaid)</h2>
<p>If you are using a Gemini API key for the free tier:</p>
<ul>
<li><strong>Quota:</strong></li>
<li>Flash model only</li>
<li>10 requests per minute</li>
<li>250 requests per day</li>
<li><strong>Cost:</strong> Free</li>
<li><strong>Details:</strong> <a href="https://ai.google.dev/gemini-api/docs/rate-limits">Gemini API Rate Limits</a></li>
</ul>
<h2 id="3-gemini-api-key-paid">3. Gemini API Key (Paid)</h2>
<p>If you are using a Gemini API key with a paid plan:</p>
<ul>
<li><strong>Quota:</strong> Varies by pricing tier.</li>
<li><strong>Cost:</strong> Varies by pricing tier and model/token usage.</li>
<li><strong>Details:</strong> <a href="https://ai.google.dev/gemini-api/docs/rate-limits">Gemini API Rate Limits</a>, <a href="https://ai.google.dev/gemini-api/docs/pricing">Gemini API Pricing</a></li>
</ul>
<h2 id="4-login-with-google-for-workspace-or-licensed-code-assist-users">4. Login with Google (for Workspace or Licensed Code Assist users)</h2>
<p>For users of Standard or Enterprise editions of Gemini Code Assist, quotas and pricing are based on a fixed price subscription with assigned license seats:</p>
<ul>
<li><strong>Standard Tier:</strong></li>
<li><strong>Quota:</strong> 120 requests per minute, 1500 per day</li>
<li><strong>Enterprise Tier:</strong></li>
<li><strong>Quota:</strong> 120 requests per minute, 2000 per day</li>
<li><strong>Cost:</strong> Fixed price included with your Gemini for Google Workspace or Gemini Code Assist subscription.</li>
<li><strong>Details:</strong> <a href="https://developers.google.com/gemini-code-assist/resources/quotas#quotas-for-agent-mode-gemini-cli">Gemini Code Assist Quotas</a>, <a href="https://cloud.google.com/products/gemini/pricing">Gemini Code Assist Pricing</a></li>
<li><strong>Notes:</strong></li>
<li>Specific quota for different models is not specified; model fallback may occur to preserve shared experience quality.</li>
<li>Members of the Google Developer Program may have Gemini Code Assist licenses through their membership.</li>
</ul>
<h2 id="5-vertex-ai-express-mode">5. Vertex AI (Express Mode)</h2>
<p>If you are using Vertex AI in Express Mode:</p>
<ul>
<li><strong>Quota:</strong> Quotas are variable and specific to your account. See the source for more details.</li>
<li><strong>Cost:</strong> After your Express Mode usage is consumed and you enable billing for your project, cost is based on standard <a href="https://cloud.google.com/vertex-ai/pricing">Vertex AI Pricing</a>.</li>
<li><strong>Details:</strong> <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/start/express-mode/overview#quotas">Vertex AI Express Mode Quotas</a></li>
</ul>
<h2 id="6-vertex-ai-regular-mode">6. Vertex AI (Regular Mode)</h2>
<p>If you are using the standard Vertex AI service:</p>
<ul>
<li><strong>Quota:</strong> Governed by a dynamic shared quota system or pre-purchased provisioned throughput.</li>
<li><strong>Cost:</strong> Based on model and token usage. See <a href="https://cloud.google.com/vertex-ai/pricing">Vertex AI Pricing</a>.</li>
<li><strong>Details:</strong> <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/resources/dynamic-shared-quota">Vertex AI Dynamic Shared Quota</a></li>
</ul>
<h2 id="7-google-one-and-ultra-plans-gemini-for-workspace-plans">7. Google One and Ultra plans, Gemini for Workspace plans</h2>
<p>These plans currently apply only to the use of Gemini web-based products provided by Google-based experiences (for example, the Gemini web app or the Flow video editor). These plans do not apply to the API usage which powers the Gemini CLI. Supporting these plans is under active consideration for future support.</p>
<p>‚îú‚îÄ‚îÄ sandbox.md
  Content:</p>
<h1 id="sandboxing-in-the-gemini-cli">Sandboxing in the Gemini CLI</h1>
<p>This document provides a guide to sandboxing in the Gemini CLI, including prerequisites, quickstart, and configuration.</p>
<h2 id="prerequisites_1">Prerequisites</h2>
<p>Before using sandboxing, you need to install and set up the Gemini CLI:</p>
<div class="codehilite"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@google/gemini-cli
</code></pre></div>

<p>To verify the installation</p>
<div class="codehilite"><pre><span></span><code>gemini<span class="w"> </span>--version
</code></pre></div>

<h2 id="overview-of-sandboxing">Overview of sandboxing</h2>
<p>Sandboxing isolates potentially dangerous operations (such as shell commands or file modifications) from your host system, providing a security barrier between AI operations and your environment.</p>
<p>The benefits of sandboxing include:</p>
<ul>
<li><strong>Security</strong>: Prevent accidental system damage or data loss.</li>
<li><strong>Isolation</strong>: Limit file system access to project directory.</li>
<li><strong>Consistency</strong>: Ensure reproducible environments across different systems.</li>
<li><strong>Safety</strong>: Reduce risk when working with untrusted code or experimental commands.</li>
</ul>
<h2 id="sandboxing-methods">Sandboxing methods</h2>
<p>Your ideal method of sandboxing may differ depending on your platform and your preferred container solution.</p>
<h3 id="1-macos-seatbelt-macos-only">1. macOS Seatbelt (macOS only)</h3>
<p>Lightweight, built-in sandboxing using <code>sandbox-exec</code>.</p>
<p><strong>Default profile</strong>: <code>permissive-open</code> - restricts writes outside project directory but allows most other operations.</p>
<h3 id="2-container-based-dockerpodman">2. Container-based (Docker/Podman)</h3>
<p>Cross-platform sandboxing with complete process isolation.</p>
<p><strong>Note</strong>: Requires building the sandbox image locally or using a published image from your organization's registry.</p>
<h2 id="quickstart">Quickstart</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable sandboxing with command flag</span>
gemini<span class="w"> </span>-s<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;analyze the code structure&quot;</span>

<span class="c1"># Use environment variable</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">GEMINI_SANDBOX</span><span class="o">=</span><span class="nb">true</span>
gemini<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;run the test suite&quot;</span>

<span class="c1"># Configure in settings.json</span>
<span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;sandbox&quot;</span>:<span class="w"> </span><span class="s2">&quot;docker&quot;</span>
<span class="o">}</span>
</code></pre></div>

<h2 id="configuration">Configuration</h2>
<h3 id="enable-sandboxing-in-order-of-precedence">Enable sandboxing (in order of precedence)</h3>
<ol>
<li><strong>Command flag</strong>: <code>-s</code> or <code>--sandbox</code></li>
<li><strong>Environment variable</strong>: <code>GEMINI_SANDBOX=true|docker|podman|sandbox-exec</code></li>
<li><strong>Settings file</strong>: <code>"sandbox": true</code> in <code>settings.json</code></li>
</ol>
<h3 id="macos-seatbelt-profiles">macOS Seatbelt profiles</h3>
<p>Built-in profiles (set via <code>SEATBELT_PROFILE</code> env var):</p>
<ul>
<li><code>permissive-open</code> (default): Write restrictions, network allowed</li>
<li><code>permissive-closed</code>: Write restrictions, no network</li>
<li><code>permissive-proxied</code>: Write restrictions, network via proxy</li>
<li><code>restrictive-open</code>: Strict restrictions, network allowed</li>
<li><code>restrictive-closed</code>: Maximum restrictions</li>
</ul>
<h3 id="custom-sandbox-flags">Custom Sandbox Flags</h3>
<p>For container-based sandboxing, you can inject custom flags into the <code>docker</code> or <code>podman</code> command using the <code>SANDBOX_FLAGS</code> environment variable. This is useful for advanced configurations, such as disabling security features for specific use cases.</p>
<p><strong>Example (Podman)</strong>:</p>
<p>To disable SELinux labeling for volume mounts, you can set the following:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SANDBOX_FLAGS</span><span class="o">=</span><span class="s2">&quot;--security-opt label=disable&quot;</span>
</code></pre></div>

<p>Multiple flags can be provided as a space-separated string:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SANDBOX_FLAGS</span><span class="o">=</span><span class="s2">&quot;--flag1 --flag2=value&quot;</span>
</code></pre></div>

<h2 id="linux-uidgid-handling">Linux UID/GID handling</h2>
<p>The sandbox automatically handles user permissions on Linux. Override these permissions with:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SANDBOX_SET_UID_GID</span><span class="o">=</span><span class="nb">true</span><span class="w">   </span><span class="c1"># Force host UID/GID</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SANDBOX_SET_UID_GID</span><span class="o">=</span><span class="nb">false</span><span class="w">  </span><span class="c1"># Disable UID/GID mapping</span>
</code></pre></div>

<h2 id="troubleshooting_1">Troubleshooting</h2>
<h3 id="common-issues_1">Common issues</h3>
<p><strong>"Operation not permitted"</strong></p>
<ul>
<li>Operation requires access outside sandbox.</li>
<li>Try more permissive profile or add mount points.</li>
</ul>
<p><strong>Missing commands</strong></p>
<ul>
<li>Add to custom Dockerfile.</li>
<li>Install via <code>sandbox.bashrc</code>.</li>
</ul>
<p><strong>Network issues</strong></p>
<ul>
<li>Check sandbox profile allows network.</li>
<li>Verify proxy configuration.</li>
</ul>
<h3 id="debug-mode_1">Debug mode</h3>
<div class="codehilite"><pre><span></span><code><span class="nv">DEBUG</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>gemini<span class="w"> </span>-s<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;debug command&quot;</span>
</code></pre></div>

<p><strong>Note:</strong> If you have <code>DEBUG=true</code> in a project's <code>.env</code> file, it won't affect gemini-cli due to automatic exclusion. Use <code>.gemini/.env</code> files for gemini-cli specific debug settings.</p>
<h3 id="inspect-sandbox">Inspect sandbox</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check environment</span>
gemini<span class="w"> </span>-s<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;run shell command: env | grep SANDBOX&quot;</span>

<span class="c1"># List mounts</span>
gemini<span class="w"> </span>-s<span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;run shell command: mount | grep workspace&quot;</span>
</code></pre></div>

<h2 id="security-notes">Security notes</h2>
<ul>
<li>Sandboxing reduces but doesn't eliminate all risks.</li>
<li>Use the most restrictive profile that allows your work.</li>
<li>Container overhead is minimal after first build.</li>
<li>GUI applications may not work in sandboxes.</li>
</ul>
<h2 id="related-documentation">Related documentation</h2>
<ul>
<li><a href="./cli/configuration.md">Configuration</a>: Full configuration options.</li>
<li><a href="./cli/commands.md">Commands</a>: Available commands.</li>
<li><a href="./troubleshooting.md">Troubleshooting</a>: General troubleshooting.</li>
</ul>
<p>‚îú‚îÄ‚îÄ telemetry.md
  Content:</p>
<h1 id="gemini-cli-observability-guide">Gemini CLI Observability Guide</h1>
<p>Telemetry provides data about Gemini CLI's performance, health, and usage. By enabling it, you can monitor operations, debug issues, and optimize tool usage through traces, metrics, and structured logs.</p>
<p>Gemini CLI's telemetry system is built on the <strong><a href="https://opentelemetry.io/">OpenTelemetry</a> (OTEL)</strong> standard, allowing you to send data to any compatible backend.</p>
<h2 id="enabling-telemetry">Enabling telemetry</h2>
<p>You can enable telemetry in multiple ways. Configuration is primarily managed via the <a href="./cli/configuration.md"><code>.gemini/settings.json</code> file</a> and environment variables, but CLI flags can override these settings for a specific session.</p>
<h3 id="order-of-precedence">Order of precedence</h3>
<p>The following lists the precedence for applying telemetry settings, with items listed higher having greater precedence:</p>
<ol>
<li>
<p><strong>CLI flags (for <code>gemini</code> command):</strong></p>
<ul>
<li><code>--telemetry</code> / <code>--no-telemetry</code>: Overrides <code>telemetry.enabled</code>.</li>
<li><code>--telemetry-target &lt;local|gcp&gt;</code>: Overrides <code>telemetry.target</code>.</li>
<li><code>--telemetry-otlp-endpoint &lt;URL&gt;</code>: Overrides <code>telemetry.otlpEndpoint</code>.</li>
<li><code>--telemetry-log-prompts</code> / <code>--no-telemetry-log-prompts</code>: Overrides <code>telemetry.logPrompts</code>.</li>
<li><code>--telemetry-outfile &lt;path&gt;</code>: Redirects telemetry output to a file. See <a href="#exporting-to-a-file">Exporting to a file</a>.</li>
</ul>
</li>
<li>
<p><strong>Environment variables:</strong></p>
<ul>
<li><code>OTEL_EXPORTER_OTLP_ENDPOINT</code>: Overrides <code>telemetry.otlpEndpoint</code>.</li>
</ul>
</li>
<li>
<p><strong>Workspace settings file (<code>.gemini/settings.json</code>):</strong> Values from the <code>telemetry</code> object in this project-specific file.</p>
</li>
<li>
<p><strong>User settings file (<code>~/.gemini/settings.json</code>):</strong> Values from the <code>telemetry</code> object in this global user file.</p>
</li>
<li>
<p><strong>Defaults:</strong> applied if not set by any of the above.</p>
<ul>
<li><code>telemetry.enabled</code>: <code>false</code></li>
<li><code>telemetry.target</code>: <code>local</code></li>
<li><code>telemetry.otlpEndpoint</code>: <code>http://localhost:4317</code></li>
<li><code>telemetry.logPrompts</code>: <code>true</code></li>
</ul>
</li>
</ol>
<p><strong>For the <code>npm run telemetry -- --target=&lt;gcp|local&gt;</code> script:</strong>
The <code>--target</code> argument to this script <em>only</em> overrides the <code>telemetry.target</code> for the duration and purpose of that script (i.e., choosing which collector to start). It does not permanently change your <code>settings.json</code>. The script will first look at <code>settings.json</code> for a <code>telemetry.target</code> to use as its default.</p>
<h3 id="example-settings">Example settings</h3>
<p>The following code can be added to your workspace (<code>.gemini/settings.json</code>) or user (<code>~/.gemini/settings.json</code>) settings to enable telemetry and send the output to Google Cloud:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;telemetry&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gcp&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;sandbox&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="exporting-to-a-file">Exporting to a file</h3>
<p>You can export all telemetry data to a file for local inspection.</p>
<p>To enable file export, use the <code>--telemetry-outfile</code> flag with a path to your desired output file. This must be run using <code>--telemetry-target=local</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set your desired output file path</span>
<span class="nv">TELEMETRY_FILE</span><span class="o">=</span><span class="s2">&quot;.gemini/telemetry.log&quot;</span>

<span class="c1"># Run Gemini CLI with local telemetry</span>
<span class="c1"># NOTE: --telemetry-otlp-endpoint=&quot;&quot; is required to override the default</span>
<span class="c1"># OTLP exporter and ensure telemetry is written to the local file.</span>
gemini<span class="w"> </span>--telemetry<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--telemetry-target<span class="o">=</span><span class="nb">local</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--telemetry-otlp-endpoint<span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--telemetry-outfile<span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TELEMETRY_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--prompt<span class="w"> </span><span class="s2">&quot;What is OpenTelemetry?&quot;</span>
</code></pre></div>

<h2 id="running-an-otel-collector">Running an OTEL Collector</h2>
<p>An OTEL Collector is a service that receives, processes, and exports telemetry data.
The CLI sends data using the OTLP/gRPC protocol.</p>
<p>Learn more about OTEL exporter standard configuration in <a href="https://opentelemetry.io/docs/languages/sdk-configuration/otlp-exporter/">documentation</a>.</p>
<h3 id="local">Local</h3>
<p>Use the <code>npm run telemetry -- --target=local</code> command to automate the process of setting up a local telemetry pipeline, including configuring the necessary settings in your <code>.gemini/settings.json</code> file. The underlying script installs <code>otelcol-contrib</code> (the OpenTelemetry Collector) and <code>jaeger</code> (The Jaeger UI for viewing traces). To use it:</p>
<ol>
<li>
<p><strong>Run the command</strong>:
    Execute the command from the root of the repository:</p>
<p><code>bash
npm run telemetry -- --target=local</code></p>
<p>The script will:
- Download Jaeger and OTEL if needed.
- Start a local Jaeger instance.
- Start an OTEL collector configured to receive data from Gemini CLI.
- Automatically enable telemetry in your workspace settings.
- On exit, disable telemetry.</p>
</li>
<li>
<p><strong>View traces</strong>:
    Open your web browser and navigate to <strong>http://localhost:16686</strong> to access the Jaeger UI. Here you can inspect detailed traces of Gemini CLI operations.</p>
</li>
<li>
<p><strong>Inspect logs and metrics</strong>:
    The script redirects the OTEL collector output (which includes logs and metrics) to <code>~/.gemini/tmp/&lt;projectHash&gt;/otel/collector.log</code>. The script will provide links to view and a command to tail your telemetry data (traces, metrics, logs) locally.</p>
</li>
<li>
<p><strong>Stop the services</strong>:
    Press <code>Ctrl+C</code> in the terminal where the script is running to stop the OTEL Collector and Jaeger services.</p>
</li>
</ol>
<h3 id="google-cloud">Google Cloud</h3>
<p>Use the <code>npm run telemetry -- --target=gcp</code> command to automate setting up a local OpenTelemetry collector that forwards data to your Google Cloud project, including configuring the necessary settings in your <code>.gemini/settings.json</code> file. The underlying script installs <code>otelcol-contrib</code>. To use it:</p>
<ol>
<li>
<p><strong>Prerequisites</strong>:</p>
<ul>
<li>Have a Google Cloud project ID.</li>
<li>Export the <code>GOOGLE_CLOUD_PROJECT</code> environment variable to make it available to the OTEL collector.
  <code>bash
  export OTLP_GOOGLE_CLOUD_PROJECT="your-project-id"</code></li>
<li>Authenticate with Google Cloud (e.g., run <code>gcloud auth application-default login</code> or ensure <code>GOOGLE_APPLICATION_CREDENTIALS</code> is set).</li>
<li>Ensure your Google Cloud account/service account has the necessary IAM roles: "Cloud Trace Agent", "Monitoring Metric Writer", and "Logs Writer".</li>
</ul>
</li>
<li>
<p><strong>Run the command</strong>:
    Execute the command from the root of the repository:</p>
<p><code>bash
npm run telemetry -- --target=gcp</code></p>
<p>The script will:
- Download the <code>otelcol-contrib</code> binary if needed.
- Start an OTEL collector configured to receive data from Gemini CLI and export it to your specified Google Cloud project.
- Automatically enable telemetry and disable sandbox mode in your workspace settings (<code>.gemini/settings.json</code>).
- Provide direct links to view traces, metrics, and logs in your Google Cloud Console.
- On exit (Ctrl+C), it will attempt to restore your original telemetry and sandbox settings.</p>
</li>
<li>
<p><strong>Run Gemini CLI:</strong>
    In a separate terminal, run your Gemini CLI commands. This generates telemetry data that the collector captures.</p>
</li>
<li>
<p><strong>View telemetry in Google Cloud</strong>:
    Use the links provided by the script to navigate to the Google Cloud Console and view your traces, metrics, and logs.</p>
</li>
<li>
<p><strong>Inspect local collector logs</strong>:
    The script redirects the local OTEL collector output to <code>~/.gemini/tmp/&lt;projectHash&gt;/otel/collector-gcp.log</code>. The script provides links to view and command to tail your collector logs locally.</p>
</li>
<li>
<p><strong>Stop the service</strong>:
    Press <code>Ctrl+C</code> in the terminal where the script is running to stop the OTEL Collector.</p>
</li>
</ol>
<h2 id="logs-and-metric-reference">Logs and metric reference</h2>
<p>The following section describes the structure of logs and metrics generated for Gemini CLI.</p>
<ul>
<li>A <code>sessionId</code> is included as a common attribute on all logs and metrics.</li>
</ul>
<h3 id="logs">Logs</h3>
<p>Logs are timestamped records of specific events. The following events are logged for Gemini CLI:</p>
<ul>
<li><code>gemini_cli.config</code>: This event occurs once at startup with the CLI's configuration.</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code> (string)</li>
<li><code>embedding_model</code> (string)</li>
<li><code>sandbox_enabled</code> (boolean)</li>
<li><code>core_tools_enabled</code> (string)</li>
<li><code>approval_mode</code> (string)</li>
<li><code>api_key_enabled</code> (boolean)</li>
<li><code>vertex_ai_enabled</code> (boolean)</li>
<li><code>code_assist_enabled</code> (boolean)</li>
<li><code>log_prompts_enabled</code> (boolean)</li>
<li><code>file_filtering_respect_git_ignore</code> (boolean)</li>
<li><code>debug_mode</code> (boolean)</li>
<li><code>mcp_servers</code> (string)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.user_prompt</code>: This event occurs when a user submits a prompt.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>prompt_length</code></li>
<li><code>prompt</code> (this attribute is excluded if <code>log_prompts_enabled</code> is configured to be <code>false</code>)</li>
<li><code>auth_type</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.tool_call</code>: This event occurs for each function call.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>function_name</code></li>
<li><code>function_args</code></li>
<li><code>duration_ms</code></li>
<li><code>success</code> (boolean)</li>
<li><code>decision</code> (string: "accept", "reject", "auto_accept", or "modify", if applicable)</li>
<li><code>error</code> (if applicable)</li>
<li><code>error_type</code> (if applicable)</li>
<li><code>metadata</code> (if applicable, dictionary of string -&gt; any)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.api_request</code>: This event occurs when making a request to Gemini API.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>request_text</code> (if applicable)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.api_error</code>: This event occurs if the API request fails.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>error</code></li>
<li><code>error_type</code></li>
<li><code>status_code</code></li>
<li><code>duration_ms</code></li>
<li><code>auth_type</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.api_response</code>: This event occurs upon receiving a response from Gemini API.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>status_code</code></li>
<li><code>duration_ms</code></li>
<li><code>error</code> (optional)</li>
<li><code>input_token_count</code></li>
<li><code>output_token_count</code></li>
<li><code>cached_content_token_count</code></li>
<li><code>thoughts_token_count</code></li>
<li><code>tool_token_count</code></li>
<li><code>response_text</code> (if applicable)</li>
<li><code>auth_type</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.flash_fallback</code>: This event occurs when Gemini CLI switches to flash as fallback.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>auth_type</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.slash_command</code>: This event occurs when a user executes a slash command.</p>
</li>
<li><strong>Attributes</strong>:<ul>
<li><code>command</code> (string)</li>
<li><code>subcommand</code> (string, if applicable)</li>
</ul>
</li>
</ul>
<h3 id="metrics">Metrics</h3>
<p>Metrics are numerical measurements of behavior over time. The following metrics are collected for Gemini CLI:</p>
<ul>
<li>
<p><code>gemini_cli.session.count</code> (Counter, Int): Incremented once per CLI startup.</p>
</li>
<li>
<p><code>gemini_cli.tool.call.count</code> (Counter, Int): Counts tool calls.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>function_name</code></li>
<li><code>success</code> (boolean)</li>
<li><code>decision</code> (string: "accept", "reject", or "modify", if applicable)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.tool.call.latency</code> (Histogram, ms): Measures tool call latency.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>function_name</code></li>
<li><code>decision</code> (string: "accept", "reject", or "modify", if applicable)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.api.request.count</code> (Counter, Int): Counts all API requests.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>status_code</code></li>
<li><code>error_type</code> (if applicable)</li>
</ul>
</li>
<li>
<p><code>gemini_cli.api.request.latency</code> (Histogram, ms): Measures API request latency.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
</ul>
</li>
<li>
<p><code>gemini_cli.token.usage</code> (Counter, Int): Counts the number of tokens used.</p>
</li>
<li>
<p><strong>Attributes</strong>:</p>
<ul>
<li><code>model</code></li>
<li><code>type</code> (string: "input", "output", "thought", "cache", or "tool")</li>
</ul>
</li>
<li>
<p><code>gemini_cli.file.operation.count</code> (Counter, Int): Counts file operations.</p>
</li>
<li><strong>Attributes</strong>:<ul>
<li><code>operation</code> (string: "create", "read", "update"): The type of file operation.</li>
<li><code>lines</code> (Int, if applicable): Number of lines in the file.</li>
<li><code>mimetype</code> (string, if applicable): Mimetype of the file.</li>
<li><code>extension</code> (string, if applicable): File extension of the file.</li>
<li><code>ai_added_lines</code> (Int, if applicable): Number of lines added/changed by AI.</li>
<li><code>ai_removed_lines</code> (Int, if applicable): Number of lines removed/changed by AI.</li>
<li><code>user_added_lines</code> (Int, if applicable): Number of lines added/changed by user in AI proposed changes.</li>
<li><code>user_removed_lines</code> (Int, if applicable): Number of lines removed/changed by user in AI proposed changes.</li>
</ul>
</li>
</ul>
<p>‚îî‚îÄ‚îÄ tools/
  ‚îú‚îÄ‚îÄ file-system.md
    Content:</p>
<h1 id="gemini-cli-file-system-tools">Gemini CLI file system tools</h1>
<p>The Gemini CLI provides a comprehensive suite of tools for interacting with the local file system. These tools allow the Gemini model to read from, write to, list, search, and modify files and directories, all under your control and typically with confirmation for sensitive operations.</p>
<p><strong>Note:</strong> All file system tools operate within a <code>rootDirectory</code> (usually the current working directory where you launched the CLI) for security. Paths that you provide to these tools are generally expected to be absolute or are resolved relative to this root directory.</p>
<h2 id="1-list_directory-readfolder">1. <code>list_directory</code> (ReadFolder)</h2>
<p><code>list_directory</code> lists the names of files and subdirectories directly within a specified directory path. It can optionally ignore entries matching provided glob patterns.</p>
<ul>
<li><strong>Tool name:</strong> <code>list_directory</code></li>
<li><strong>Display name:</strong> ReadFolder</li>
<li><strong>File:</strong> <code>ls.ts</code></li>
<li><strong>Parameters:</strong></li>
<li><code>path</code> (string, required): The absolute path to the directory to list.</li>
<li><code>ignore</code> (array of strings, optional): A list of glob patterns to exclude from the listing (e.g., <code>["*.log", ".git"]</code>).</li>
<li><code>respect_git_ignore</code> (boolean, optional): Whether to respect <code>.gitignore</code> patterns when listing files. Defaults to <code>true</code>.</li>
<li><strong>Behavior:</strong></li>
<li>Returns a list of file and directory names.</li>
<li>Indicates whether each entry is a directory.</li>
<li>Sorts entries with directories first, then alphabetically.</li>
<li><strong>Output (<code>llmContent</code>):</strong> A string like: <code>Directory listing for /path/to/your/folder:\n[DIR] subfolder1\nfile1.txt\nfile2.png</code></li>
<li><strong>Confirmation:</strong> No.</li>
</ul>
<h2 id="2-read_file-readfile">2. <code>read_file</code> (ReadFile)</h2>
<p><code>read_file</code> reads and returns the content of a specified file. This tool handles text, images (PNG, JPG, GIF, WEBP, SVG, BMP), and PDF files. For text files, it can read specific line ranges. Other binary file types are generally skipped.</p>
<ul>
<li><strong>Tool name:</strong> <code>read_file</code></li>
<li><strong>Display name:</strong> ReadFile</li>
<li><strong>File:</strong> <code>read-file.ts</code></li>
<li><strong>Parameters:</strong></li>
<li><code>path</code> (string, required): The absolute path to the file to read.</li>
<li><code>offset</code> (number, optional): For text files, the 0-based line number to start reading from. Requires <code>limit</code> to be set.</li>
<li><code>limit</code> (number, optional): For text files, the maximum number of lines to read. If omitted, reads a default maximum (e.g., 2000 lines) or the entire file if feasible.</li>
<li><strong>Behavior:</strong></li>
<li>For text files: Returns the content. If <code>offset</code> and <code>limit</code> are used, returns only that slice of lines. Indicates if content was truncated due to line limits or line length limits.</li>
<li>For image and PDF files: Returns the file content as a base64-encoded data structure suitable for model consumption.</li>
<li>For other binary files: Attempts to identify and skip them, returning a message indicating it's a generic binary file.</li>
<li><strong>Output:</strong> (<code>llmContent</code>):</li>
<li>For text files: The file content, potentially prefixed with a truncation message (e.g., <code>[File content truncated: showing lines 1-100 of 500 total lines...]\nActual file content...</code>).</li>
<li>For image/PDF files: An object containing <code>inlineData</code> with <code>mimeType</code> and base64 <code>data</code> (e.g., <code>{ inlineData: { mimeType: 'image/png', data: 'base64encodedstring' } }</code>).</li>
<li>For other binary files: A message like <code>Cannot display content of binary file: /path/to/data.bin</code>.</li>
<li><strong>Confirmation:</strong> No.</li>
</ul>
<h2 id="3-write_file-writefile">3. <code>write_file</code> (WriteFile)</h2>
<p><code>write_file</code> writes content to a specified file. If the file exists, it will be overwritten. If the file doesn't exist, it (and any necessary parent directories) will be created.</p>
<ul>
<li><strong>Tool name:</strong> <code>write_file</code></li>
<li><strong>Display name:</strong> WriteFile</li>
<li><strong>File:</strong> <code>write-file.ts</code></li>
<li><strong>Parameters:</strong></li>
<li><code>file_path</code> (string, required): The absolute path to the file to write to.</li>
<li><code>content</code> (string, required): The content to write into the file.</li>
<li><strong>Behavior:</strong></li>
<li>Writes the provided <code>content</code> to the <code>file_path</code>.</li>
<li>Creates parent directories if they don't exist.</li>
<li><strong>Output (<code>llmContent</code>):</strong> A success message, e.g., <code>Successfully overwrote file: /path/to/your/file.txt</code> or <code>Successfully created and wrote to new file: /path/to/new/file.txt</code>.</li>
<li><strong>Confirmation:</strong> Yes. Shows a diff of changes and asks for user approval before writing.</li>
</ul>
<h2 id="4-glob-findfiles">4. <code>glob</code> (FindFiles)</h2>
<p><code>glob</code> finds files matching specific glob patterns (e.g., <code>src/**/*.ts</code>, <code>*.md</code>), returning absolute paths sorted by modification time (newest first).</p>
<ul>
<li><strong>Tool name:</strong> <code>glob</code></li>
<li><strong>Display name:</strong> FindFiles</li>
<li><strong>File:</strong> <code>glob.ts</code></li>
<li><strong>Parameters:</strong></li>
<li><code>pattern</code> (string, required): The glob pattern to match against (e.g., <code>"*.py"</code>, <code>"src/**/*.js"</code>).</li>
<li><code>path</code> (string, optional): The absolute path to the directory to search within. If omitted, searches the tool's root directory.</li>
<li><code>case_sensitive</code> (boolean, optional): Whether the search should be case-sensitive. Defaults to <code>false</code>.</li>
<li><code>respect_git_ignore</code> (boolean, optional): Whether to respect .gitignore patterns when finding files. Defaults to <code>true</code>.</li>
<li><strong>Behavior:</strong></li>
<li>Searches for files matching the glob pattern within the specified directory.</li>
<li>Returns a list of absolute paths, sorted with the most recently modified files first.</li>
<li>Ignores common nuisance directories like <code>node_modules</code> and <code>.git</code> by default.</li>
<li><strong>Output (<code>llmContent</code>):</strong> A message like: <code>Found 5 file(s) matching "*.ts" within src, sorted by modification time (newest first):\nsrc/file1.ts\nsrc/subdir/file2.ts...</code></li>
<li><strong>Confirmation:</strong> No.</li>
</ul>
<h2 id="5-search_file_content-searchtext">5. <code>search_file_content</code> (SearchText)</h2>
<p><code>search_file_content</code> searches for a regular expression pattern within the content of files in a specified directory. Can filter files by a glob pattern. Returns the lines containing matches, along with their file paths and line numbers.</p>
<ul>
<li><strong>Tool name:</strong> <code>search_file_content</code></li>
<li><strong>Display name:</strong> SearchText</li>
<li><strong>File:</strong> <code>grep.ts</code></li>
<li><strong>Parameters:</strong></li>
<li><code>pattern</code> (string, required): The regular expression (regex) to search for (e.g., <code>"function\s+myFunction"</code>).</li>
<li><code>path</code> (string, optional): The absolute path to the directory to search within. Defaults to the current working directory.</li>
<li><code>include</code> (string, optional): A glob pattern to filter which files are searched (e.g., <code>"*.js"</code>, <code>"src/**/*.{ts,tsx}"</code>). If omitted, searches most files (respecting common ignores).</li>
<li><strong>Behavior:</strong></li>
<li>Uses <code>git grep</code> if available in a Git repository for speed; otherwise, falls back to system <code>grep</code> or a JavaScript-based search.</li>
<li>Returns a list of matching lines, each prefixed with its file path (relative to the search directory) and line number.</li>
<li><strong>Output (<code>llmContent</code>):</strong> A formatted string of matches, e.g.:
  ```
  Found 3 matches for pattern "myFunction" in path "." (filter: "*.ts"):</li>
</ul>
<hr />
<p>File: src/utils.ts
  L15: export function myFunction() {
  L22:   myFunction.call();</p>
<hr />
<p>File: src/index.ts
  L5: import { myFunction } from './utils';</p>
<hr />
<p>```
- <strong>Confirmation:</strong> No.</p>
<h2 id="6-replace-edit">6. <code>replace</code> (Edit)</h2>
<p><code>replace</code> replaces text within a file. By default, replaces a single occurrence, but can replace multiple occurrences when <code>expected_replacements</code> is specified. This tool is designed for precise, targeted changes and requires significant context around the <code>old_string</code> to ensure it modifies the correct location.</p>
<ul>
<li><strong>Tool name:</strong> <code>replace</code></li>
<li><strong>Display name:</strong> Edit</li>
<li><strong>File:</strong> <code>edit.ts</code></li>
<li><strong>Parameters:</strong></li>
<li><code>file_path</code> (string, required): The absolute path to the file to modify.</li>
<li>
<p><code>old_string</code> (string, required): The exact literal text to replace.</p>
<p><strong>CRITICAL:</strong> This string must uniquely identify the single instance to change. It should include at least 3 lines of context <em>before</em> and <em>after</em> the target text, matching whitespace and indentation precisely. If <code>old_string</code> is empty, the tool attempts to create a new file at <code>file_path</code> with <code>new_string</code> as content.</p>
</li>
<li>
<p><code>new_string</code> (string, required): The exact literal text to replace <code>old_string</code> with.</p>
</li>
<li>
<p><code>expected_replacements</code> (number, optional): The number of occurrences to replace. Defaults to <code>1</code>.</p>
</li>
<li>
<p><strong>Behavior:</strong></p>
</li>
<li>If <code>old_string</code> is empty and <code>file_path</code> does not exist, creates a new file with <code>new_string</code> as content.</li>
<li>If <code>old_string</code> is provided, it reads the <code>file_path</code> and attempts to find exactly one occurrence of <code>old_string</code>.</li>
<li>If one occurrence is found, it replaces it with <code>new_string</code>.</li>
<li><strong>Enhanced Reliability (Multi-Stage Edit Correction):</strong> To significantly improve the success rate of edits, especially when the model-provided <code>old_string</code> might not be perfectly precise, the tool incorporates a multi-stage edit correction mechanism.<ul>
<li>If the initial <code>old_string</code> isn't found or matches multiple locations, the tool can leverage the Gemini model to iteratively refine <code>old_string</code> (and potentially <code>new_string</code>).</li>
<li>This self-correction process attempts to identify the unique segment the model intended to modify, making the <code>replace</code> operation more robust even with slightly imperfect initial context.</li>
</ul>
</li>
<li><strong>Failure conditions:</strong> Despite the correction mechanism, the tool will fail if:</li>
<li><code>file_path</code> is not absolute or is outside the root directory.</li>
<li><code>old_string</code> is not empty, but the <code>file_path</code> does not exist.</li>
<li><code>old_string</code> is empty, but the <code>file_path</code> already exists.</li>
<li><code>old_string</code> is not found in the file after attempts to correct it.</li>
<li><code>old_string</code> is found multiple times, and the self-correction mechanism cannot resolve it to a single, unambiguous match.</li>
<li><strong>Output (<code>llmContent</code>):</strong></li>
<li>On success: <code>Successfully modified file: /path/to/file.txt (1 replacements).</code> or <code>Created new file: /path/to/new_file.txt with provided content.</code></li>
<li>On failure: An error message explaining the reason (e.g., <code>Failed to edit, 0 occurrences found...</code>, <code>Failed to edit, expected 1 occurrences but found 2...</code>).</li>
<li><strong>Confirmation:</strong> Yes. Shows a diff of the proposed changes and asks for user approval before writing to the file.</li>
</ul>
<p>These file system tools provide a foundation for the Gemini CLI to understand and interact with your local project context.</p>
<p>‚îú‚îÄ‚îÄ index.md
    Content:</p>
<h1 id="gemini-cli-tools">Gemini CLI tools</h1>
<p>The Gemini CLI includes built-in tools that the Gemini model uses to interact with your local environment, access information, and perform actions. These tools enhance the CLI's capabilities, enabling it to go beyond text generation and assist with a wide range of tasks.</p>
<h2 id="overview-of-gemini-cli-tools">Overview of Gemini CLI tools</h2>
<p>In the context of the Gemini CLI, tools are specific functions or modules that the Gemini model can request to be executed. For example, if you ask Gemini to "Summarize the contents of <code>my_document.txt</code>," the model will likely identify the need to read that file and will request the execution of the <code>read_file</code> tool.</p>
<p>The core component (<code>packages/core</code>) manages these tools, presents their definitions (schemas) to the Gemini model, executes them when requested, and returns the results to the model for further processing into a user-facing response.</p>
<p>These tools provide the following capabilities:</p>
<ul>
<li><strong>Access local information:</strong> Tools allow Gemini to access your local file system, read file contents, list directories, etc.</li>
<li><strong>Execute commands:</strong> With tools like <code>run_shell_command</code>, Gemini can run shell commands (with appropriate safety measures and user confirmation).</li>
<li><strong>Interact with the web:</strong> Tools can fetch content from URLs.</li>
<li><strong>Take actions:</strong> Tools can modify files, write new files, or perform other actions on your system (again, typically with safeguards).</li>
<li><strong>Ground responses:</strong> By using tools to fetch real-time or specific local data, Gemini's responses can be more accurate, relevant, and grounded in your actual context.</li>
</ul>
<h2 id="how-to-use-gemini-cli-tools">How to use Gemini CLI tools</h2>
<p>To use Gemini CLI tools, provide a prompt to the Gemini CLI. The process works as follows:</p>
<ol>
<li>You provide a prompt to the Gemini CLI.</li>
<li>The CLI sends the prompt to the core.</li>
<li>The core, along with your prompt and conversation history, sends a list of available tools and their descriptions/schemas to the Gemini API.</li>
<li>The Gemini model analyzes your request. If it determines that a tool is needed, its response will include a request to execute a specific tool with certain parameters.</li>
<li>The core receives this tool request, validates it, and (often after user confirmation for sensitive operations) executes the tool.</li>
<li>The output from the tool is sent back to the Gemini model.</li>
<li>The Gemini model uses the tool's output to formulate its final answer, which is then sent back through the core to the CLI and displayed to you.</li>
</ol>
<p>You will typically see messages in the CLI indicating when a tool is being called and whether it succeeded or failed.</p>
<h2 id="security-and-confirmation">Security and confirmation</h2>
<p>Many tools, especially those that can modify your file system or execute commands (<code>write_file</code>, <code>edit</code>, <code>run_shell_command</code>), are designed with safety in mind. The Gemini CLI will typically:</p>
<ul>
<li><strong>Require confirmation:</strong> Prompt you before executing potentially sensitive operations, showing you what action is about to be taken.</li>
<li><strong>Utilize sandboxing:</strong> All tools are subject to restrictions enforced by sandboxing (see <a href="../sandbox.md">Sandboxing in the Gemini CLI</a>). This means that when operating in a sandbox, any tools (including MCP servers) you wish to use must be available <em>inside</em> the sandbox environment. For example, to run an MCP server through <code>npx</code>, the <code>npx</code> executable must be installed within the sandbox's Docker image or be available in the <code>sandbox-exec</code> environment.</li>
</ul>
<p>It's important to always review confirmation prompts carefully before allowing a tool to proceed.</p>
<h2 id="learn-more-about-gemini-clis-tools">Learn more about Gemini CLI's tools</h2>
<p>Gemini CLI's built-in tools can be broadly categorized as follows:</p>
<ul>
<li><strong><a href="./file-system.md">File System Tools</a>:</strong> For interacting with files and directories (reading, writing, listing, searching, etc.).</li>
<li><strong><a href="./shell.md">Shell Tool</a> (<code>run_shell_command</code>):</strong> For executing shell commands.</li>
<li><strong><a href="./web-fetch.md">Web Fetch Tool</a> (<code>web_fetch</code>):</strong> For retrieving content from URLs.</li>
<li><strong><a href="./web-search.md">Web Search Tool</a> (<code>web_search</code>):</strong> For searching the web.</li>
<li><strong><a href="./multi-file.md">Multi-File Read Tool</a> (<code>read_many_files</code>):</strong> A specialized tool for reading content from multiple files or directories, often used by the <code>@</code> command.</li>
<li><strong><a href="./memory.md">Memory Tool</a> (<code>save_memory</code>):</strong> For saving and recalling information across sessions.</li>
</ul>
<p>Additionally, these tools incorporate:</p>
<ul>
<li><strong><a href="./mcp-server.md">MCP servers</a></strong>: MCP servers act as a bridge between the Gemini model and your local environment or other services like APIs.</li>
<li><strong><a href="../sandbox.md">Sandboxing</a></strong>: Sandboxing isolates the model and its changes from your environment to reduce potential risk.</li>
</ul>
<p>‚îú‚îÄ‚îÄ mcp-server.md
    Content:</p>
<h1 id="mcp-servers-with-the-gemini-cli">MCP servers with the Gemini CLI</h1>
<p>This document provides a guide to configuring and using Model Context Protocol (MCP) servers with the Gemini CLI.</p>
<h2 id="what-is-an-mcp-server">What is an MCP server?</h2>
<p>An MCP server is an application that exposes tools and resources to the Gemini CLI through the Model Context Protocol, allowing it to interact with external systems and data sources. MCP servers act as a bridge between the Gemini model and your local environment or other services like APIs.</p>
<p>An MCP server enables the Gemini CLI to:</p>
<ul>
<li><strong>Discover tools:</strong> List available tools, their descriptions, and parameters through standardized schema definitions.</li>
<li><strong>Execute tools:</strong> Call specific tools with defined arguments and receive structured responses.</li>
<li><strong>Access resources:</strong> Read data from specific resources (though the Gemini CLI primarily focuses on tool execution).</li>
</ul>
<p>With an MCP server, you can extend the Gemini CLI's capabilities to perform actions beyond its built-in features, such as interacting with databases, APIs, custom scripts, or specialized workflows.</p>
<h2 id="core-integration-architecture">Core Integration Architecture</h2>
<p>The Gemini CLI integrates with MCP servers through a sophisticated discovery and execution system built into the core package (<code>packages/core/src/tools/</code>):</p>
<h3 id="discovery-layer-mcp-clientts">Discovery Layer (<code>mcp-client.ts</code>)</h3>
<p>The discovery process is orchestrated by <code>discoverMcpTools()</code>, which:</p>
<ol>
<li><strong>Iterates through configured servers</strong> from your <code>settings.json</code> <code>mcpServers</code> configuration</li>
<li><strong>Establishes connections</strong> using appropriate transport mechanisms (Stdio, SSE, or Streamable HTTP)</li>
<li><strong>Fetches tool definitions</strong> from each server using the MCP protocol</li>
<li><strong>Sanitizes and validates</strong> tool schemas for compatibility with the Gemini API</li>
<li><strong>Registers tools</strong> in the global tool registry with conflict resolution</li>
</ol>
<h3 id="execution-layer-mcp-toolts">Execution Layer (<code>mcp-tool.ts</code>)</h3>
<p>Each discovered MCP tool is wrapped in a <code>DiscoveredMCPTool</code> instance that:</p>
<ul>
<li><strong>Handles confirmation logic</strong> based on server trust settings and user preferences</li>
<li><strong>Manages tool execution</strong> by calling the MCP server with proper parameters</li>
<li><strong>Processes responses</strong> for both the LLM context and user display</li>
<li><strong>Maintains connection state</strong> and handles timeouts</li>
</ul>
<h3 id="transport-mechanisms">Transport Mechanisms</h3>
<p>The Gemini CLI supports three MCP transport types:</p>
<ul>
<li><strong>Stdio Transport:</strong> Spawns a subprocess and communicates via stdin/stdout</li>
<li><strong>SSE Transport:</strong> Connects to Server-Sent Events endpoints</li>
<li><strong>Streamable HTTP Transport:</strong> Uses HTTP streaming for communication</li>
</ul>
<h2 id="how-to-set-up-your-mcp-server">How to set up your MCP server</h2>
<p>The Gemini CLI uses the <code>mcpServers</code> configuration in your <code>settings.json</code> file to locate and connect to MCP servers. This configuration supports multiple servers with different transport mechanisms.</p>
<h3 id="configure-the-mcp-server-in-settingsjson_1">Configure the MCP server in settings.json</h3>
<p>You can configure MCP servers at the global level in the <code>~/.gemini/settings.json</code> file or in your project's root directory, create or open the <code>.gemini/settings.json</code> file. Within the file, add the <code>mcpServers</code> configuration block.</p>
<h3 id="configuration-structure">Configuration Structure</h3>
<p>Add an <code>mcpServers</code> object to your <code>settings.json</code> file:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="w"> </span><span class="err">...</span><span class="kc">f</span><span class="err">ile</span><span class="w"> </span><span class="err">co</span><span class="kc">nta</span><span class="err">i</span><span class="kc">ns</span><span class="w"> </span><span class="err">o</span><span class="kc">t</span><span class="err">her</span><span class="w"> </span><span class="err">co</span><span class="kc">nf</span><span class="err">ig</span><span class="w"> </span><span class="err">objec</span><span class="kc">ts</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;serverName&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;path/to/server&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--arg1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;value1&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;API_KEY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$MY_API_TOKEN&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;cwd&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./server-directory&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30000</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;trust&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="configuration-properties">Configuration Properties</h3>
<p>Each server configuration supports the following properties:</p>
<h4 id="required-one-of-the-following">Required (one of the following)</h4>
<ul>
<li><strong><code>command</code></strong> (string): Path to the executable for Stdio transport</li>
<li><strong><code>url</code></strong> (string): SSE endpoint URL (e.g., <code>"http://localhost:8080/sse"</code>)</li>
<li><strong><code>httpUrl</code></strong> (string): HTTP streaming endpoint URL</li>
</ul>
<h4 id="optional">Optional</h4>
<ul>
<li><strong><code>args</code></strong> (string[]): Command-line arguments for Stdio transport</li>
<li><strong><code>headers</code></strong> (object): Custom HTTP headers when using <code>url</code> or <code>httpUrl</code></li>
<li><strong><code>env</code></strong> (object): Environment variables for the server process. Values can reference environment variables using <code>$VAR_NAME</code> or <code>${VAR_NAME}</code> syntax</li>
<li><strong><code>cwd</code></strong> (string): Working directory for Stdio transport</li>
<li><strong><code>timeout</code></strong> (number): Request timeout in milliseconds (default: 600,000ms = 10 minutes)</li>
<li><strong><code>trust</code></strong> (boolean): When <code>true</code>, bypasses all tool call confirmations for this server (default: <code>false</code>)</li>
<li><strong><code>includeTools</code></strong> (string[]): List of tool names to include from this MCP server. When specified, only the tools listed here will be available from this server (whitelist behavior). If not specified, all tools from the server are enabled by default.</li>
<li><strong><code>excludeTools</code></strong> (string[]): List of tool names to exclude from this MCP server. Tools listed here will not be available to the model, even if they are exposed by the server. <strong>Note:</strong> <code>excludeTools</code> takes precedence over <code>includeTools</code> - if a tool is in both lists, it will be excluded.</li>
</ul>
<h3 id="oauth-support-for-remote-mcp-servers">OAuth Support for Remote MCP Servers</h3>
<p>The Gemini CLI supports OAuth 2.0 authentication for remote MCP servers using SSE or HTTP transports. This enables secure access to MCP servers that require authentication.</p>
<h4 id="automatic-oauth-discovery">Automatic OAuth Discovery</h4>
<p>For servers that support OAuth discovery, you can omit the OAuth configuration and let the CLI discover it automatically:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;discoveredServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.example.com/sse&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>The CLI will automatically:</p>
<ul>
<li>Detect when a server requires OAuth authentication (401 responses)</li>
<li>Discover OAuth endpoints from server metadata</li>
<li>Perform dynamic client registration if supported</li>
<li>Handle the OAuth flow and token management</li>
</ul>
<h4 id="authentication-flow">Authentication Flow</h4>
<p>When connecting to an OAuth-enabled server:</p>
<ol>
<li><strong>Initial connection attempt</strong> fails with 401 Unauthorized</li>
<li><strong>OAuth discovery</strong> finds authorization and token endpoints</li>
<li><strong>Browser opens</strong> for user authentication (requires local browser access)</li>
<li><strong>Authorization code</strong> is exchanged for access tokens</li>
<li><strong>Tokens are stored</strong> securely for future use</li>
<li><strong>Connection retry</strong> succeeds with valid tokens</li>
</ol>
<h4 id="browser-redirect-requirements">Browser Redirect Requirements</h4>
<p><strong>Important:</strong> OAuth authentication requires that your local machine can:</p>
<ul>
<li>Open a web browser for authentication</li>
<li>Receive redirects on <code>http://localhost:7777/oauth/callback</code></li>
</ul>
<p>This feature will not work in:</p>
<ul>
<li>Headless environments without browser access</li>
<li>Remote SSH sessions without X11 forwarding</li>
<li>Containerized environments without browser support</li>
</ul>
<h4 id="managing-oauth-authentication">Managing OAuth Authentication</h4>
<p>Use the <code>/mcp auth</code> command to manage OAuth authentication:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># List servers requiring authentication</span>
/mcp<span class="w"> </span>auth

<span class="c1"># Authenticate with a specific server</span>
/mcp<span class="w"> </span>auth<span class="w"> </span>serverName

<span class="c1"># Re-authenticate if tokens expire</span>
/mcp<span class="w"> </span>auth<span class="w"> </span>serverName
</code></pre></div>

<h4 id="oauth-configuration-properties">OAuth Configuration Properties</h4>
<ul>
<li><strong><code>enabled</code></strong> (boolean): Enable OAuth for this server</li>
<li><strong><code>clientId</code></strong> (string): OAuth client identifier (optional with dynamic registration)</li>
<li><strong><code>clientSecret</code></strong> (string): OAuth client secret (optional for public clients)</li>
<li><strong><code>authorizationUrl</code></strong> (string): OAuth authorization endpoint (auto-discovered if omitted)</li>
<li><strong><code>tokenUrl</code></strong> (string): OAuth token endpoint (auto-discovered if omitted)</li>
<li><strong><code>scopes</code></strong> (string[]): Required OAuth scopes</li>
<li><strong><code>redirectUri</code></strong> (string): Custom redirect URI (defaults to <code>http://localhost:7777/oauth/callback</code>)</li>
<li><strong><code>tokenParamName</code></strong> (string): Query parameter name for tokens in SSE URLs</li>
<li><strong><code>audiences</code></strong> (string[]): Audiences the token is valid for</li>
</ul>
<h4 id="token-management">Token Management</h4>
<p>OAuth tokens are automatically:</p>
<ul>
<li><strong>Stored securely</strong> in <code>~/.gemini/mcp-oauth-tokens.json</code></li>
<li><strong>Refreshed</strong> when expired (if refresh tokens are available)</li>
<li><strong>Validated</strong> before each connection attempt</li>
<li><strong>Cleaned up</strong> when invalid or expired</li>
</ul>
<h4 id="authentication-provider-type">Authentication Provider Type</h4>
<p>You can specify the authentication provider type using the <code>authProviderType</code> property:</p>
<ul>
<li><strong><code>authProviderType</code></strong> (string): Specifies the authentication provider. Can be one of the following:</li>
<li><strong><code>dynamic_discovery</code></strong> (default): The CLI will automatically discover the OAuth configuration from the server.</li>
<li><strong><code>google_credentials</code></strong>: The CLI will use the Google Application Default Credentials (ADC) to authenticate with the server. When using this provider, you must specify the required scopes.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;googleCloudServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;httpUrl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://my-gcp-service.run.app/mcp&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;authProviderType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;google_credentials&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;oauth&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;scopes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://www.googleapis.com/auth/userinfo.email&quot;</span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="example-configurations">Example Configurations</h3>
<h4 id="python-mcp-server-stdio">Python MCP Server (Stdio)</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;pythonTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;-m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;my_mcp_server&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;8080&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;cwd&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./mcp-servers/python&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;DATABASE_URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$DB_CONNECTION_STRING&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;API_KEY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${EXTERNAL_API_KEY}&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="nodejs-mcp-server-stdio">Node.js MCP Server (Stdio)</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;nodeServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;dist/server.js&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--verbose&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;cwd&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./mcp-servers/node&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;trust&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="docker-based-mcp-server">Docker-based MCP Server</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;dockerizedServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;run&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;-i&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;--rm&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;-e&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;API_KEY&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;-v&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;${PWD}:/workspace&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;my-mcp-server:latest&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;API_KEY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$EXTERNAL_SERVICE_TOKEN&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="http-based-mcp-server">HTTP-based MCP Server</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;httpServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;httpUrl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:3000/mcp&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="http-based-mcp-server-with-custom-headers">HTTP-based MCP Server with Custom Headers</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;httpServerWithAuth&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;httpUrl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:3000/mcp&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;headers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Authorization&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bearer your-api-token&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;X-Custom-Header&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;custom-value&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Content-Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="mcp-server-with-tool-filtering">MCP Server with Tool Filtering</h4>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;filteredServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;-m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;my_mcp_server&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;includeTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;safe_tool&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;file_reader&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;data_processor&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="c1">// &quot;excludeTools&quot;: [&quot;dangerous_tool&quot;, &quot;file_deleter&quot;],</span>
<span class="w">      </span><span class="nt">&quot;timeout&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30000</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="discovery-process-deep-dive">Discovery Process Deep Dive</h2>
<p>When the Gemini CLI starts, it performs MCP server discovery through the following detailed process:</p>
<h3 id="1-server-iteration-and-connection">1. Server Iteration and Connection</h3>
<p>For each configured server in <code>mcpServers</code>:</p>
<ol>
<li><strong>Status tracking begins:</strong> Server status is set to <code>CONNECTING</code></li>
<li><strong>Transport selection:</strong> Based on configuration properties:</li>
<li><code>httpUrl</code> ‚Üí <code>StreamableHTTPClientTransport</code></li>
<li><code>url</code> ‚Üí <code>SSEClientTransport</code></li>
<li><code>command</code> ‚Üí <code>StdioClientTransport</code></li>
<li><strong>Connection establishment:</strong> The MCP client attempts to connect with the configured timeout</li>
<li><strong>Error handling:</strong> Connection failures are logged and the server status is set to <code>DISCONNECTED</code></li>
</ol>
<h3 id="2-tool-discovery">2. Tool Discovery</h3>
<p>Upon successful connection:</p>
<ol>
<li><strong>Tool listing:</strong> The client calls the MCP server's tool listing endpoint</li>
<li><strong>Schema validation:</strong> Each tool's function declaration is validated</li>
<li><strong>Tool filtering:</strong> Tools are filtered based on <code>includeTools</code> and <code>excludeTools</code> configuration</li>
<li><strong>Name sanitization:</strong> Tool names are cleaned to meet Gemini API requirements:</li>
<li>Invalid characters (non-alphanumeric, underscore, dot, hyphen) are replaced with underscores</li>
<li>Names longer than 63 characters are truncated with middle replacement (<code>___</code>)</li>
</ol>
<h3 id="3-conflict-resolution">3. Conflict Resolution</h3>
<p>When multiple servers expose tools with the same name:</p>
<ol>
<li><strong>First registration wins:</strong> The first server to register a tool name gets the unprefixed name</li>
<li><strong>Automatic prefixing:</strong> Subsequent servers get prefixed names: <code>serverName__toolName</code></li>
<li><strong>Registry tracking:</strong> The tool registry maintains mappings between server names and their tools</li>
</ol>
<h3 id="4-schema-processing">4. Schema Processing</h3>
<p>Tool parameter schemas undergo sanitization for Gemini API compatibility:</p>
<ul>
<li><strong><code>$schema</code> properties</strong> are removed</li>
<li><strong><code>additionalProperties</code></strong> are stripped</li>
<li><strong><code>anyOf</code> with <code>default</code></strong> have their default values removed (Vertex AI compatibility)</li>
<li><strong>Recursive processing</strong> applies to nested schemas</li>
</ul>
<h3 id="5-connection-management">5. Connection Management</h3>
<p>After discovery:</p>
<ul>
<li><strong>Persistent connections:</strong> Servers that successfully register tools maintain their connections</li>
<li><strong>Cleanup:</strong> Servers that provide no usable tools have their connections closed</li>
<li><strong>Status updates:</strong> Final server statuses are set to <code>CONNECTED</code> or <code>DISCONNECTED</code></li>
</ul>
<h2 id="tool-execution-flow_1">Tool Execution Flow</h2>
<p>When the Gemini model decides to use an MCP tool, the following execution flow occurs:</p>
<h3 id="1-tool-invocation">1. Tool Invocation</h3>
<p>The model generates a <code>FunctionCall</code> with:</p>
<ul>
<li><strong>Tool name:</strong> The registered name (potentially prefixed)</li>
<li><strong>Arguments:</strong> JSON object matching the tool's parameter schema</li>
</ul>
<h3 id="2-confirmation-process">2. Confirmation Process</h3>
<p>Each <code>DiscoveredMCPTool</code> implements sophisticated confirmation logic:</p>
<h4 id="trust-based-bypass">Trust-based Bypass</h4>
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">trust</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// No confirmation needed</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="dynamic-allow-listing">Dynamic Allow-listing</h4>
<p>The system maintains internal allow-lists for:</p>
<ul>
<li><strong>Server-level:</strong> <code>serverName</code> ‚Üí All tools from this server are trusted</li>
<li><strong>Tool-level:</strong> <code>serverName.toolName</code> ‚Üí This specific tool is trusted</li>
</ul>
<h4 id="user-choice-handling">User Choice Handling</h4>
<p>When confirmation is required, users can choose:</p>
<ul>
<li><strong>Proceed once:</strong> Execute this time only</li>
<li><strong>Always allow this tool:</strong> Add to tool-level allow-list</li>
<li><strong>Always allow this server:</strong> Add to server-level allow-list</li>
<li><strong>Cancel:</strong> Abort execution</li>
</ul>
<h3 id="3-execution">3. Execution</h3>
<p>Upon confirmation (or trust bypass):</p>
<ol>
<li><strong>Parameter preparation:</strong> Arguments are validated against the tool's schema</li>
<li><strong>MCP call:</strong> The underlying <code>CallableTool</code> invokes the server with:</li>
</ol>
<p><code>typescript
   const functionCalls = [
     {
       name: this.serverToolName, // Original server tool name
       args: params,
     },
   ];</code></p>
<ol>
<li><strong>Response processing:</strong> Results are formatted for both LLM context and user display</li>
</ol>
<h3 id="4-response-handling">4. Response Handling</h3>
<p>The execution result contains:</p>
<ul>
<li><strong><code>llmContent</code>:</strong> Raw response parts for the language model's context</li>
<li><strong><code>returnDisplay</code>:</strong> Formatted output for user display (often JSON in markdown code blocks)</li>
</ul>
<h2 id="how-to-interact-with-your-mcp-server">How to interact with your MCP server</h2>
<h3 id="using-the-mcp-command">Using the <code>/mcp</code> Command</h3>
<p>The <code>/mcp</code> command provides comprehensive information about your MCP server setup:</p>
<div class="codehilite"><pre><span></span><code>/mcp
</code></pre></div>

<p>This displays:</p>
<ul>
<li><strong>Server list:</strong> All configured MCP servers</li>
<li><strong>Connection status:</strong> <code>CONNECTED</code>, <code>CONNECTING</code>, or <code>DISCONNECTED</code></li>
<li><strong>Server details:</strong> Configuration summary (excluding sensitive data)</li>
<li><strong>Available tools:</strong> List of tools from each server with descriptions</li>
<li><strong>Discovery state:</strong> Overall discovery process status</li>
</ul>
<h3 id="example-mcp-output">Example <code>/mcp</code> Output</h3>
<div class="codehilite"><pre><span></span><code>MCP Servers Status:

üì° pythonTools (CONNECTED)
  Command: python -m my_mcp_server --port 8080
  Working Directory: ./mcp-servers/python
  Timeout: 15000ms
  Tools: calculate_sum, file_analyzer, data_processor

üîå nodeServer (DISCONNECTED)
  Command: node dist/server.js --verbose
  Error: Connection refused

üê≥ dockerizedServer (CONNECTED)
  Command: docker run -i --rm -e API_KEY my-mcp-server:latest
  Tools: docker__deploy, docker__status

Discovery State: COMPLETED
</code></pre></div>

<h3 id="tool-usage">Tool Usage</h3>
<p>Once discovered, MCP tools are available to the Gemini model like built-in tools. The model will automatically:</p>
<ol>
<li><strong>Select appropriate tools</strong> based on your requests</li>
<li><strong>Present confirmation dialogs</strong> (unless the server is trusted)</li>
<li><strong>Execute tools</strong> with proper parameters</li>
<li><strong>Display results</strong> in a user-friendly format</li>
</ol>
<h2 id="status-monitoring-and-troubleshooting">Status Monitoring and Troubleshooting</h2>
<h3 id="connection-states">Connection States</h3>
<p>The MCP integration tracks several states:</p>
<h4 id="server-status-mcpserverstatus">Server Status (<code>MCPServerStatus</code>)</h4>
<ul>
<li><strong><code>DISCONNECTED</code>:</strong> Server is not connected or has errors</li>
<li><strong><code>CONNECTING</code>:</strong> Connection attempt in progress</li>
<li><strong><code>CONNECTED</code>:</strong> Server is connected and ready</li>
</ul>
<h4 id="discovery-state-mcpdiscoverystate">Discovery State (<code>MCPDiscoveryState</code>)</h4>
<ul>
<li><strong><code>NOT_STARTED</code>:</strong> Discovery hasn't begun</li>
<li><strong><code>IN_PROGRESS</code>:</strong> Currently discovering servers</li>
<li><strong><code>COMPLETED</code>:</strong> Discovery finished (with or without errors)</li>
</ul>
<h3 id="common-issues-and-solutions">Common Issues and Solutions</h3>
<h4 id="server-wont-connect">Server Won't Connect</h4>
<p><strong>Symptoms:</strong> Server shows <code>DISCONNECTED</code> status</p>
<p><strong>Troubleshooting:</strong></p>
<ol>
<li><strong>Check configuration:</strong> Verify <code>command</code>, <code>args</code>, and <code>cwd</code> are correct</li>
<li><strong>Test manually:</strong> Run the server command directly to ensure it works</li>
<li><strong>Check dependencies:</strong> Ensure all required packages are installed</li>
<li><strong>Review logs:</strong> Look for error messages in the CLI output</li>
<li><strong>Verify permissions:</strong> Ensure the CLI can execute the server command</li>
</ol>
<h4 id="no-tools-discovered">No Tools Discovered</h4>
<p><strong>Symptoms:</strong> Server connects but no tools are available</p>
<p><strong>Troubleshooting:</strong></p>
<ol>
<li><strong>Verify tool registration:</strong> Ensure your server actually registers tools</li>
<li><strong>Check MCP protocol:</strong> Confirm your server implements the MCP tool listing correctly</li>
<li><strong>Review server logs:</strong> Check stderr output for server-side errors</li>
<li><strong>Test tool listing:</strong> Manually test your server's tool discovery endpoint</li>
</ol>
<h4 id="tools-not-executing">Tools Not Executing</h4>
<p><strong>Symptoms:</strong> Tools are discovered but fail during execution</p>
<p><strong>Troubleshooting:</strong></p>
<ol>
<li><strong>Parameter validation:</strong> Ensure your tool accepts the expected parameters</li>
<li><strong>Schema compatibility:</strong> Verify your input schemas are valid JSON Schema</li>
<li><strong>Error handling:</strong> Check if your tool is throwing unhandled exceptions</li>
<li><strong>Timeout issues:</strong> Consider increasing the <code>timeout</code> setting</li>
</ol>
<h4 id="sandbox-compatibility">Sandbox Compatibility</h4>
<p><strong>Symptoms:</strong> MCP servers fail when sandboxing is enabled</p>
<p><strong>Solutions:</strong></p>
<ol>
<li><strong>Docker-based servers:</strong> Use Docker containers that include all dependencies</li>
<li><strong>Path accessibility:</strong> Ensure server executables are available in the sandbox</li>
<li><strong>Network access:</strong> Configure sandbox to allow necessary network connections</li>
<li><strong>Environment variables:</strong> Verify required environment variables are passed through</li>
</ol>
<h3 id="debugging-tips">Debugging Tips</h3>
<ol>
<li><strong>Enable debug mode:</strong> Run the CLI with <code>--debug</code> for verbose output</li>
<li><strong>Check stderr:</strong> MCP server stderr is captured and logged (INFO messages filtered)</li>
<li><strong>Test isolation:</strong> Test your MCP server independently before integrating</li>
<li><strong>Incremental setup:</strong> Start with simple tools before adding complex functionality</li>
<li><strong>Use <code>/mcp</code> frequently:</strong> Monitor server status during development</li>
</ol>
<h2 id="important-notes">Important Notes</h2>
<h3 id="security-considerations_1">Security Considerations</h3>
<ul>
<li><strong>Trust settings:</strong> The <code>trust</code> option bypasses all confirmation dialogs. Use cautiously and only for servers you completely control</li>
<li><strong>Access tokens:</strong> Be security-aware when configuring environment variables containing API keys or tokens</li>
<li><strong>Sandbox compatibility:</strong> When using sandboxing, ensure MCP servers are available within the sandbox environment</li>
<li><strong>Private data:</strong> Using broadly scoped personal access tokens can lead to information leakage between repositories</li>
</ul>
<h3 id="performance-and-resource-management">Performance and Resource Management</h3>
<ul>
<li><strong>Connection persistence:</strong> The CLI maintains persistent connections to servers that successfully register tools</li>
<li><strong>Automatic cleanup:</strong> Connections to servers providing no tools are automatically closed</li>
<li><strong>Timeout management:</strong> Configure appropriate timeouts based on your server's response characteristics</li>
<li><strong>Resource monitoring:</strong> MCP servers run as separate processes and consume system resources</li>
</ul>
<h3 id="schema-compatibility">Schema Compatibility</h3>
<ul>
<li><strong>Property stripping:</strong> The system automatically removes certain schema properties (<code>$schema</code>, <code>additionalProperties</code>) for Gemini API compatibility</li>
<li><strong>Name sanitization:</strong> Tool names are automatically sanitized to meet API requirements</li>
<li><strong>Conflict resolution:</strong> Tool name conflicts between servers are resolved through automatic prefixing</li>
</ul>
<p>This comprehensive integration makes MCP servers a powerful way to extend the Gemini CLI's capabilities while maintaining security, reliability, and ease of use.</p>
<h2 id="returning-rich-content-from-tools">Returning Rich Content from Tools</h2>
<p>MCP tools are not limited to returning simple text. You can return rich, multi-part content, including text, images, audio, and other binary data in a single tool response. This allows you to build powerful tools that can provide diverse information to the model in a single turn.</p>
<p>All data returned from the tool is processed and sent to the model as context for its next generation, enabling it to reason about or summarize the provided information.</p>
<h3 id="how-it-works_4">How It Works</h3>
<p>To return rich content, your tool's response must adhere to the MCP specification for a <a href="https://modelcontextprotocol.io/specification/2025-06-18/server/tools#tool-result"><code>CallToolResult</code></a>. The <code>content</code> field of the result should be an array of <code>ContentBlock</code> objects. The Gemini CLI will correctly process this array, separating text from binary data and packaging it for the model.</p>
<p>You can mix and match different content block types in the <code>content</code> array. The supported block types include:</p>
<ul>
<li><code>text</code></li>
<li><code>image</code></li>
<li><code>audio</code></li>
<li><code>resource</code> (embedded content)</li>
<li><code>resource_link</code></li>
</ul>
<h3 id="example-returning-text-and-an-image">Example: Returning Text and an Image</h3>
<p>Here is an example of a valid JSON response from an MCP tool that returns both a text description and an image:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Here is the logo you requested.&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BASE64_ENCODED_IMAGE_DATA_HERE&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;mimeType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image/png&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The logo was created in 2025.&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>When the Gemini CLI receives this response, it will:</p>
<ol>
<li>Extract all the text and combine it into a single <code>functionResponse</code> part for the model.</li>
<li>Present the image data as a separate <code>inlineData</code> part.</li>
<li>Provide a clean, user-friendly summary in the CLI, indicating that both text and an image were received.</li>
</ol>
<p>This enables you to build sophisticated tools that can provide rich, multi-modal context to the Gemini model.</p>
<h2 id="mcp-prompts-as-slash-commands">MCP Prompts as Slash Commands</h2>
<p>In addition to tools, MCP servers can expose predefined prompts that can be executed as slash commands within the Gemini CLI. This allows you to create shortcuts for common or complex queries that can be easily invoked by name.</p>
<h3 id="defining-prompts-on-the-server">Defining Prompts on the Server</h3>
<p>Here's a small example of a stdio MCP server that defines prompts:</p>
<div class="codehilite"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">McpServer</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@modelcontextprotocol/sdk/server/mcp.js&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@modelcontextprotocol/sdk/server/stdio.js&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">z</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;zod&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpServer</span><span class="p">({</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prompt-server&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">registerPrompt</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;poem-writer&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Poem Writer&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Write a nice haiku&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">argsSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">(),</span><span class="w"> </span><span class="nx">mood</span><span class="o">:</span><span class="w"> </span><span class="kt">z.string</span><span class="p">().</span><span class="nx">optional</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">({</span><span class="w"> </span><span class="nx">title</span><span class="p">,</span><span class="w"> </span><span class="nx">mood</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Write a haiku</span><span class="si">${</span><span class="nx">mood</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">` with the mood </span><span class="si">${</span><span class="nx">mood</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb"> called </span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">. Note that a haiku is 5 syllables followed by 7 syllables followed by 5 syllables `</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">  </span><span class="p">}),</span>
<span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
<span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</code></pre></div>

<p>This can be included in <code>settings.json</code> under <code>mcpServers</code> with:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&quot;nodeServer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;filename.ts&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="invoking-prompts">Invoking Prompts</h3>
<p>Once a prompt is discovered, you can invoke it using its name as a slash command. The CLI will automatically handle parsing arguments.</p>
<div class="codehilite"><pre><span></span><code>/poem-writer<span class="w"> </span>--title<span class="o">=</span><span class="s2">&quot;Gemini CLI&quot;</span><span class="w"> </span>--mood<span class="o">=</span><span class="s2">&quot;reverent&quot;</span>
</code></pre></div>

<p>or, using positional arguments:</p>
<div class="codehilite"><pre><span></span><code>/poem-writer<span class="w"> </span><span class="s2">&quot;Gemini CLI&quot;</span><span class="w"> </span>reverent
</code></pre></div>

<p>When you run this command, the Gemini CLI executes the <code>prompts/get</code> method on the MCP server with the provided arguments. The server is responsible for substituting the arguments into the prompt template and returning the final prompt text. The CLI then sends this prompt to the model for execution. This provides a convenient way to automate and share common workflows.</p>
<h2 id="managing-mcp-servers-with-gemini-mcp">Managing MCP Servers with <code>gemini mcp</code></h2>
<p>While you can always configure MCP servers by manually editing your <code>settings.json</code> file, the Gemini CLI provides a convenient set of commands to manage your server configurations programmatically. These commands streamline the process of adding, listing, and removing MCP servers without needing to directly edit JSON files.</p>
<h3 id="adding-a-server-gemini-mcp-add">Adding a Server (<code>gemini mcp add</code>)</h3>
<p>The <code>add</code> command configures a new MCP server in your <code>settings.json</code>. Based on the scope (<code>-s, --scope</code>), it will be added to either the user config <code>~/.gemini/settings.json</code> or the project config <code>.gemini/settings.json</code> file.</p>
<p><strong>Command:</strong></p>
<div class="codehilite"><pre><span></span><code>gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span><span class="o">[</span>options<span class="o">]</span><span class="w"> </span>&lt;name&gt;<span class="w"> </span>&lt;commandOrUrl&gt;<span class="w"> </span><span class="o">[</span>args...<span class="o">]</span>
</code></pre></div>

<ul>
<li><code>&lt;name&gt;</code>: A unique name for the server.</li>
<li><code>&lt;commandOrUrl&gt;</code>: The command to execute (for <code>stdio</code>) or the URL (for <code>http</code>/<code>sse</code>).</li>
<li><code>[args...]</code>: Optional arguments for a <code>stdio</code> command.</li>
</ul>
<p><strong>Options (Flags):</strong></p>
<ul>
<li><code>-s, --scope</code>: Configuration scope (user or project). [default: "project"]</li>
<li><code>-t, --transport</code>: Transport type (stdio, sse, http). [default: "stdio"]</li>
<li><code>-e, --env</code>: Set environment variables (e.g. -e KEY=value).</li>
<li><code>-H, --header</code>: Set HTTP headers for SSE and HTTP transports (e.g. -H "X-Api-Key: abc123" -H "Authorization: Bearer abc123").</li>
<li><code>--timeout</code>: Set connection timeout in milliseconds.</li>
<li><code>--trust</code>: Trust the server (bypass all tool call confirmation prompts).</li>
<li><code>--description</code>: Set the description for the server.</li>
<li><code>--include-tools</code>: A comma-separated list of tools to include.</li>
<li><code>--exclude-tools</code>: A comma-separated list of tools to exclude.</li>
</ul>
<h4 id="adding-an-stdio-server">Adding an stdio server</h4>
<p>This is the default transport for running local servers.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Basic syntax</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>&lt;name&gt;<span class="w"> </span>&lt;command&gt;<span class="w"> </span><span class="o">[</span>args...<span class="o">]</span>

<span class="c1"># Example: Adding a local server</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>my-stdio-server<span class="w"> </span>-e<span class="w"> </span><span class="nv">API_KEY</span><span class="o">=</span><span class="m">123</span><span class="w"> </span>/path/to/server<span class="w"> </span>arg1<span class="w"> </span>arg2<span class="w"> </span>arg3

<span class="c1"># Example: Adding a local python server</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>python-server<span class="w"> </span>python<span class="w"> </span>server.py<span class="w"> </span>--port<span class="w"> </span><span class="m">8080</span>
</code></pre></div>

<h4 id="adding-an-http-server">Adding an HTTP server</h4>
<p>This transport is for servers that use the streamable HTTP transport.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Basic syntax</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>--transport<span class="w"> </span>http<span class="w"> </span>&lt;name&gt;<span class="w"> </span>&lt;url&gt;

<span class="c1"># Example: Adding an HTTP server</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>--transport<span class="w"> </span>http<span class="w"> </span>http-server<span class="w"> </span>https://api.example.com/mcp/

<span class="c1"># Example: Adding an HTTP server with an authentication header</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>--transport<span class="w"> </span>http<span class="w"> </span>secure-http<span class="w"> </span>https://api.example.com/mcp/<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer abc123&quot;</span>
</code></pre></div>

<h4 id="adding-an-sse-server">Adding an SSE server</h4>
<p>This transport is for servers that use Server-Sent Events (SSE).</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Basic syntax</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>--transport<span class="w"> </span>sse<span class="w"> </span>&lt;name&gt;<span class="w"> </span>&lt;url&gt;

<span class="c1"># Example: Adding an SSE server</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>--transport<span class="w"> </span>sse<span class="w"> </span>sse-server<span class="w"> </span>https://api.example.com/sse/

<span class="c1"># Example: Adding an SSE server with an authentication header</span>
gemini<span class="w"> </span>mcp<span class="w"> </span>add<span class="w"> </span>--transport<span class="w"> </span>sse<span class="w"> </span>secure-sse<span class="w"> </span>https://api.example.com/sse/<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer abc123&quot;</span>
</code></pre></div>

<h3 id="listing-servers-gemini-mcp-list">Listing Servers (<code>gemini mcp list</code>)</h3>
<p>To view all MCP servers currently configured, use the <code>list</code> command. It displays each server's name, configuration details, and connection status.</p>
<p><strong>Command:</strong></p>
<div class="codehilite"><pre><span></span><code>gemini<span class="w"> </span>mcp<span class="w"> </span>list
</code></pre></div>

<p><strong>Example Output:</strong></p>
<div class="codehilite"><pre><span></span><code>‚úì<span class="w"> </span>stdio-server:<span class="w"> </span>command:<span class="w"> </span>python3<span class="w"> </span>server.py<span class="w"> </span><span class="o">(</span>stdio<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Connected
‚úì<span class="w"> </span>http-server:<span class="w"> </span>https://api.example.com/mcp<span class="w"> </span><span class="o">(</span>http<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Connected
‚úó<span class="w"> </span>sse-server:<span class="w"> </span>https://api.example.com/sse<span class="w"> </span><span class="o">(</span>sse<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Disconnected
</code></pre></div>

<h3 id="removing-a-server-gemini-mcp-remove">Removing a Server (<code>gemini mcp remove</code>)</h3>
<p>To delete a server from your configuration, use the <code>remove</code> command with the server's name.</p>
<p><strong>Command:</strong></p>
<div class="codehilite"><pre><span></span><code>gemini<span class="w"> </span>mcp<span class="w"> </span>remove<span class="w"> </span>&lt;name&gt;
</code></pre></div>

<p><strong>Example:</strong></p>
<div class="codehilite"><pre><span></span><code>gemini<span class="w"> </span>mcp<span class="w"> </span>remove<span class="w"> </span>my-server
</code></pre></div>

<p>This will find and delete the "my-server" entry from the <code>mcpServers</code> object in the appropriate <code>settings.json</code> file based on the scope (<code>-s, --scope</code>).</p>
<p>‚îú‚îÄ‚îÄ memory.md
    Content:</p>
<h1 id="memory-tool-save_memory">Memory Tool (<code>save_memory</code>)</h1>
<p>This document describes the <code>save_memory</code> tool for the Gemini CLI.</p>
<h2 id="description">Description</h2>
<p>Use <code>save_memory</code> to save and recall information across your Gemini CLI sessions. With <code>save_memory</code>, you can direct the CLI to remember key details across sessions, providing personalized and directed assistance.</p>
<h3 id="arguments">Arguments</h3>
<p><code>save_memory</code> takes one argument:</p>
<ul>
<li><code>fact</code> (string, required): The specific fact or piece of information to remember. This should be a clear, self-contained statement written in natural language.</li>
</ul>
<h2 id="how-to-use-save_memory-with-the-gemini-cli">How to use <code>save_memory</code> with the Gemini CLI</h2>
<p>The tool appends the provided <code>fact</code> to a special <code>GEMINI.md</code> file located in the user's home directory (<code>~/.gemini/GEMINI.md</code>). This file can be configured to have a different name.</p>
<p>Once added, the facts are stored under a <code>## Gemini Added Memories</code> section. This file is loaded as context in subsequent sessions, allowing the CLI to recall the saved information.</p>
<p>Usage:</p>
<div class="codehilite"><pre><span></span><code>save_memory(fact=&quot;Your fact here.&quot;)
</code></pre></div>

<h3 id="save_memory-examples"><code>save_memory</code> examples</h3>
<p>Remember a user preference:</p>
<div class="codehilite"><pre><span></span><code>save_memory(fact=&quot;My preferred programming language is Python.&quot;)
</code></pre></div>

<p>Store a project-specific detail:</p>
<div class="codehilite"><pre><span></span><code>save_memory(fact=&quot;The project I&#39;m currently working on is called &#39;gemini-cli&#39;.&quot;)
</code></pre></div>

<h2 id="important-notes_1">Important notes</h2>
<ul>
<li><strong>General usage:</strong> This tool should be used for concise, important facts. It is not intended for storing large amounts of data or conversational history.</li>
<li><strong>Memory file:</strong> The memory file is a plain text Markdown file, so you can view and edit it manually if needed.</li>
</ul>
<p>‚îú‚îÄ‚îÄ multi-file.md
    Content:</p>
<h1 id="multi-file-read-tool-read_many_files">Multi File Read Tool (<code>read_many_files</code>)</h1>
<p>This document describes the <code>read_many_files</code> tool for the Gemini CLI.</p>
<h2 id="description_1">Description</h2>
<p>Use <code>read_many_files</code> to read content from multiple files specified by paths or glob patterns. The behavior of this tool depends on the provided files:</p>
<ul>
<li>For text files, this tool concatenates their content into a single string.</li>
<li>For image (e.g., PNG, JPEG), PDF, audio (MP3, WAV), and video (MP4, MOV) files, it reads and returns them as base64-encoded data, provided they are explicitly requested by name or extension.</li>
</ul>
<p><code>read_many_files</code> can be used to perform tasks such as getting an overview of a codebase, finding where specific functionality is implemented, reviewing documentation, or gathering context from multiple configuration files.</p>
<p><strong>Note:</strong> <code>read_many_files</code> looks for files following the provided paths or glob patterns. A directory path such as <code>"/docs"</code> will return an empty result; the tool requires a pattern such as <code>"/docs/*"</code> or <code>"/docs/*.md"</code> to identify the relevant files.</p>
<h3 id="arguments_1">Arguments</h3>
<p><code>read_many_files</code> takes the following arguments:</p>
<ul>
<li><code>paths</code> (list[string], required): An array of glob patterns or paths relative to the tool's target directory (e.g., <code>["src/**/*.ts"]</code>, <code>["README.md", "docs/*", "assets/logo.png"]</code>).</li>
<li><code>exclude</code> (list[string], optional): Glob patterns for files/directories to exclude (e.g., <code>["**/*.log", "temp/"]</code>). These are added to default excludes if <code>useDefaultExcludes</code> is true.</li>
<li><code>include</code> (list[string], optional): Additional glob patterns to include. These are merged with <code>paths</code> (e.g., <code>["*.test.ts"]</code> to specifically add test files if they were broadly excluded, or <code>["images/*.jpg"]</code> to include specific image types).</li>
<li><code>recursive</code> (boolean, optional): Whether to search recursively. This is primarily controlled by <code>**</code> in glob patterns. Defaults to <code>true</code>.</li>
<li><code>useDefaultExcludes</code> (boolean, optional): Whether to apply a list of default exclusion patterns (e.g., <code>node_modules</code>, <code>.git</code>, non image/pdf binary files). Defaults to <code>true</code>.</li>
<li><code>respect_git_ignore</code> (boolean, optional): Whether to respect .gitignore patterns when finding files. Defaults to true.</li>
</ul>
<h2 id="how-to-use-read_many_files-with-the-gemini-cli">How to use <code>read_many_files</code> with the Gemini CLI</h2>
<p><code>read_many_files</code> searches for files matching the provided <code>paths</code> and <code>include</code> patterns, while respecting <code>exclude</code> patterns and default excludes (if enabled).</p>
<ul>
<li>For text files: it reads the content of each matched file (attempting to skip binary files not explicitly requested as image/PDF) and concatenates it into a single string, with a separator <code>--- {filePath} ---</code> between the content of each file. Uses UTF-8 encoding by default.</li>
<li>For image and PDF files: if explicitly requested by name or extension (e.g., <code>paths: ["logo.png"]</code> or <code>include: ["*.pdf"]</code>), the tool reads the file and returns its content as a base64 encoded string.</li>
<li>The tool attempts to detect and skip other binary files (those not matching common image/PDF types or not explicitly requested) by checking for null bytes in their initial content.</li>
</ul>
<p>Usage:</p>
<div class="codehilite"><pre><span></span><code>read_many_files(paths=[&quot;Your files or paths here.&quot;], include=[&quot;Additional files to include.&quot;], exclude=[&quot;Files to exclude.&quot;], recursive=False, useDefaultExcludes=false, respect_git_ignore=true)
</code></pre></div>

<h2 id="read_many_files-examples"><code>read_many_files</code> examples</h2>
<p>Read all TypeScript files in the <code>src</code> directory:</p>
<div class="codehilite"><pre><span></span><code>read_many_files(paths=[&quot;src/**/*.ts&quot;])
</code></pre></div>

<p>Read the main README, all Markdown files in the <code>docs</code> directory, and a specific logo image, excluding a specific file:</p>
<div class="codehilite"><pre><span></span><code>read_many_files(paths=[&quot;README.md&quot;, &quot;docs/**/*.md&quot;, &quot;assets/logo.png&quot;], exclude=[&quot;docs/OLD_README.md&quot;])
</code></pre></div>

<p>Read all JavaScript files but explicitly include test files and all JPEGs in an <code>images</code> folder:</p>
<div class="codehilite"><pre><span></span><code>read_many_files(paths=[&quot;**/*.js&quot;], include=[&quot;**/*.test.js&quot;, &quot;images/**/*.jpg&quot;], useDefaultExcludes=False)
</code></pre></div>

<h2 id="important-notes_2">Important notes</h2>
<ul>
<li><strong>Binary file handling:</strong></li>
<li><strong>Image/PDF/Audio/Video files:</strong> The tool can read common image types (PNG, JPEG, etc.), PDF, audio (mp3, wav), and video (mp4, mov) files, returning them as base64 encoded data. These files <em>must</em> be explicitly targeted by the <code>paths</code> or <code>include</code> patterns (e.g., by specifying the exact filename like <code>video.mp4</code> or a pattern like <code>*.mov</code>).</li>
<li><strong>Other binary files:</strong> The tool attempts to detect and skip other types of binary files by examining their initial content for null bytes. The tool excludes these files from its output.</li>
<li><strong>Performance:</strong> Reading a very large number of files or very large individual files can be resource-intensive.</li>
<li><strong>Path specificity:</strong> Ensure paths and glob patterns are correctly specified relative to the tool's target directory. For image/PDF files, ensure the patterns are specific enough to include them.</li>
<li><strong>Default excludes:</strong> Be aware of the default exclusion patterns (like <code>node_modules</code>, <code>.git</code>) and use <code>useDefaultExcludes=False</code> if you need to override them, but do so cautiously.</li>
</ul>
<p>‚îú‚îÄ‚îÄ shell.md
    Content:</p>
<h1 id="shell-tool-run_shell_command">Shell Tool (<code>run_shell_command</code>)</h1>
<p>This document describes the <code>run_shell_command</code> tool for the Gemini CLI.</p>
<h2 id="description_2">Description</h2>
<p>Use <code>run_shell_command</code> to interact with the underlying system, run scripts, or perform command-line operations. <code>run_shell_command</code> executes a given shell command. On Windows, the command will be executed with <code>cmd.exe /c</code>. On other platforms, the command will be executed with <code>bash -c</code>.</p>
<h3 id="arguments_2">Arguments</h3>
<p><code>run_shell_command</code> takes the following arguments:</p>
<ul>
<li><code>command</code> (string, required): The exact shell command to execute.</li>
<li><code>description</code> (string, optional): A brief description of the command's purpose, which will be shown to the user.</li>
<li><code>directory</code> (string, optional): The directory (relative to the project root) in which to execute the command. If not provided, the command runs in the project root.</li>
</ul>
<h2 id="how-to-use-run_shell_command-with-the-gemini-cli">How to use <code>run_shell_command</code> with the Gemini CLI</h2>
<p>When using <code>run_shell_command</code>, the command is executed as a subprocess. <code>run_shell_command</code> can start background processes using <code>&amp;</code>. The tool returns detailed information about the execution, including:</p>
<ul>
<li><code>Command</code>: The command that was executed.</li>
<li><code>Directory</code>: The directory where the command was run.</li>
<li><code>Stdout</code>: Output from the standard output stream.</li>
<li><code>Stderr</code>: Output from the standard error stream.</li>
<li><code>Error</code>: Any error message reported by the subprocess.</li>
<li><code>Exit Code</code>: The exit code of the command.</li>
<li><code>Signal</code>: The signal number if the command was terminated by a signal.</li>
<li><code>Background PIDs</code>: A list of PIDs for any background processes started.</li>
</ul>
<p>Usage:</p>
<div class="codehilite"><pre><span></span><code>run_shell_command(command=&quot;Your commands.&quot;, description=&quot;Your description of the command.&quot;, directory=&quot;Your execution directory.&quot;)
</code></pre></div>

<h2 id="run_shell_command-examples"><code>run_shell_command</code> examples</h2>
<p>List files in the current directory:</p>
<div class="codehilite"><pre><span></span><code>run_shell_command(command=&quot;ls -la&quot;)
</code></pre></div>

<p>Run a script in a specific directory:</p>
<div class="codehilite"><pre><span></span><code>run_shell_command(command=&quot;./my_script.sh&quot;, directory=&quot;scripts&quot;, description=&quot;Run my custom script&quot;)
</code></pre></div>

<p>Start a background server:</p>
<div class="codehilite"><pre><span></span><code>run_shell_command(command=&quot;npm run dev &amp;&quot;, description=&quot;Start development server in background&quot;)
</code></pre></div>

<h2 id="important-notes_3">Important notes</h2>
<ul>
<li><strong>Security:</strong> Be cautious when executing commands, especially those constructed from user input, to prevent security vulnerabilities.</li>
<li><strong>Interactive commands:</strong> Avoid commands that require interactive user input, as this can cause the tool to hang. Use non-interactive flags if available (e.g., <code>npm init -y</code>).</li>
<li><strong>Error handling:</strong> Check the <code>Stderr</code>, <code>Error</code>, and <code>Exit Code</code> fields to determine if a command executed successfully.</li>
<li><strong>Background processes:</strong> When a command is run in the background with <code>&amp;</code>, the tool will return immediately and the process will continue to run in the background. The <code>Background PIDs</code> field will contain the process ID of the background process.</li>
</ul>
<h2 id="environment-variables">Environment Variables</h2>
<p>When <code>run_shell_command</code> executes a command, it sets the <code>GEMINI_CLI=1</code> environment variable in the subprocess's environment. This allows scripts or tools to detect if they are being run from within the Gemini CLI.</p>
<h2 id="command-restrictions">Command Restrictions</h2>
<p>You can restrict the commands that can be executed by the <code>run_shell_command</code> tool by using the <code>coreTools</code> and <code>excludeTools</code> settings in your configuration file.</p>
<ul>
<li><code>coreTools</code>: To restrict <code>run_shell_command</code> to a specific set of commands, add entries to the <code>coreTools</code> list in the format <code>run_shell_command(&lt;command&gt;)</code>. For example, <code>"coreTools": ["run_shell_command(git)"]</code> will only allow <code>git</code> commands. Including the generic <code>run_shell_command</code> acts as a wildcard, allowing any command not explicitly blocked.</li>
<li><code>excludeTools</code>: To block specific commands, add entries to the <code>excludeTools</code> list in the format <code>run_shell_command(&lt;command&gt;)</code>. For example, <code>"excludeTools": ["run_shell_command(rm)"]</code> will block <code>rm</code> commands.</li>
</ul>
<p>The validation logic is designed to be secure and flexible:</p>
<ol>
<li><strong>Command Chaining Disabled</strong>: The tool automatically splits commands chained with <code>&amp;&amp;</code>, <code>||</code>, or <code>;</code> and validates each part separately. If any part of the chain is disallowed, the entire command is blocked.</li>
<li><strong>Prefix Matching</strong>: The tool uses prefix matching. For example, if you allow <code>git</code>, you can run <code>git status</code> or <code>git log</code>.</li>
<li><strong>Blocklist Precedence</strong>: The <code>excludeTools</code> list is always checked first. If a command matches a blocked prefix, it will be denied, even if it also matches an allowed prefix in <code>coreTools</code>.</li>
</ol>
<h3 id="command-restriction-examples">Command Restriction Examples</h3>
<p><strong>Allow only specific command prefixes</strong></p>
<p>To allow only <code>git</code> and <code>npm</code> commands, and block all others:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;coreTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run_shell_command(git)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;run_shell_command(npm)&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><code>git status</code>: Allowed</li>
<li><code>npm install</code>: Allowed</li>
<li><code>ls -l</code>: Blocked</li>
</ul>
<p><strong>Block specific command prefixes</strong></p>
<p>To block <code>rm</code> and allow all other commands:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;coreTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run_shell_command&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;excludeTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run_shell_command(rm)&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><code>rm -rf /</code>: Blocked</li>
<li><code>git status</code>: Allowed</li>
<li><code>npm install</code>: Allowed</li>
</ul>
<p><strong>Blocklist takes precedence</strong></p>
<p>If a command prefix is in both <code>coreTools</code> and <code>excludeTools</code>, it will be blocked.</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;coreTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run_shell_command(git)&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;excludeTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run_shell_command(git push)&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><code>git push origin main</code>: Blocked</li>
<li><code>git status</code>: Allowed</li>
</ul>
<p><strong>Block all shell commands</strong></p>
<p>To block all shell commands, add the <code>run_shell_command</code> wildcard to <code>excludeTools</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;excludeTools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run_shell_command&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<ul>
<li><code>ls -l</code>: Blocked</li>
<li><code>any other command</code>: Blocked</li>
</ul>
<h2 id="security-note-for-excludetools">Security Note for <code>excludeTools</code></h2>
<p>Command-specific restrictions in <code>excludeTools</code> for <code>run_shell_command</code> are based on simple string matching and can be easily bypassed. This feature is <strong>not a security mechanism</strong> and should not be relied upon to safely execute untrusted code. It is recommended to use <code>coreTools</code> to explicitly select commands
that can be executed.</p>
<p>‚îú‚îÄ‚îÄ web-fetch.md
    Content:</p>
<h1 id="web-fetch-tool-web_fetch">Web Fetch Tool (<code>web_fetch</code>)</h1>
<p>This document describes the <code>web_fetch</code> tool for the Gemini CLI.</p>
<h2 id="description_3">Description</h2>
<p>Use <code>web_fetch</code> to summarize, compare, or extract information from web pages. The <code>web_fetch</code> tool processes content from one or more URLs (up to 20) embedded in a prompt. <code>web_fetch</code> takes a natural language prompt and returns a generated response.</p>
<h3 id="arguments_3">Arguments</h3>
<p><code>web_fetch</code> takes one argument:</p>
<ul>
<li><code>prompt</code> (string, required): A comprehensive prompt that includes the URL(s) (up to 20) to fetch and specific instructions on how to process their content. For example: <code>"Summarize https://example.com/article and extract key points from https://another.com/data"</code>. The prompt must contain at least one URL starting with <code>http://</code> or <code>https://</code>.</li>
</ul>
<h2 id="how-to-use-web_fetch-with-the-gemini-cli">How to use <code>web_fetch</code> with the Gemini CLI</h2>
<p>To use <code>web_fetch</code> with the Gemini CLI, provide a natural language prompt that contains URLs. The tool will ask for confirmation before fetching any URLs. Once confirmed, the tool will process URLs through Gemini API's <code>urlContext</code>.</p>
<p>If the Gemini API cannot access the URL, the tool will fall back to fetching content directly from the local machine. The tool will format the response, including source attribution and citations where possible. The tool will then provide the response to the user.</p>
<p>Usage:</p>
<div class="codehilite"><pre><span></span><code>web_fetch(prompt=&quot;Your prompt, including a URL such as https://google.com.&quot;)
</code></pre></div>

<h2 id="web_fetch-examples"><code>web_fetch</code> examples</h2>
<p>Summarize a single article:</p>
<div class="codehilite"><pre><span></span><code>web_fetch(prompt=&quot;Can you summarize the main points of https://example.com/news/latest&quot;)
</code></pre></div>

<p>Compare two articles:</p>
<div class="codehilite"><pre><span></span><code>web_fetch(prompt=&quot;What are the differences in the conclusions of these two papers: https://arxiv.org/abs/2401.0001 and https://arxiv.org/abs/2401.0002?&quot;)
</code></pre></div>

<h2 id="important-notes_4">Important notes</h2>
<ul>
<li><strong>URL processing:</strong> <code>web_fetch</code> relies on the Gemini API's ability to access and process the given URLs.</li>
<li><strong>Output quality:</strong> The quality of the output will depend on the clarity of the instructions in the prompt.</li>
</ul>
<p>‚îú‚îÄ‚îÄ web-search.md
    Content:</p>
<h1 id="web-search-tool-google_web_search">Web Search Tool (<code>google_web_search</code>)</h1>
<p>This document describes the <code>google_web_search</code> tool.</p>
<h2 id="description_4">Description</h2>
<p>Use <code>google_web_search</code> to perform a web search using Google Search via the Gemini API. The <code>google_web_search</code> tool returns a summary of web results with sources.</p>
<h3 id="arguments_4">Arguments</h3>
<p><code>google_web_search</code> takes one argument:</p>
<ul>
<li><code>query</code> (string, required): The search query.</li>
</ul>
<h2 id="how-to-use-google_web_search-with-the-gemini-cli">How to use <code>google_web_search</code> with the Gemini CLI</h2>
<p>The <code>google_web_search</code> tool sends a query to the Gemini API, which then performs a web search. <code>google_web_search</code> will return a generated response based on the search results, including citations and sources.</p>
<p>Usage:</p>
<div class="codehilite"><pre><span></span><code>google_web_search(query=&quot;Your query goes here.&quot;)
</code></pre></div>

<h2 id="google_web_search-examples"><code>google_web_search</code> examples</h2>
<p>Get information on a topic:</p>
<div class="codehilite"><pre><span></span><code>google_web_search(query=&quot;latest advancements in AI-powered code generation&quot;)
</code></pre></div>

<h2 id="important-notes_5">Important notes</h2>
<ul>
<li><strong>Response returned:</strong> The <code>google_web_search</code> tool returns a processed summary, not a raw list of search results.</li>
<li><strong>Citations:</strong> The response includes citations to the sources used to generate the summary.</li>
</ul>
<p>‚îú‚îÄ‚îÄ tos-privacy.md
  Content:</p>
<h1 id="gemini-cli-terms-of-service-and-privacy-notice">Gemini CLI: Terms of Service and Privacy Notice</h1>
<p>Gemini CLI is an open-source tool that lets you interact with Google's powerful language models directly from your command-line interface. The Terms of Service and Privacy Notices that apply to your usage of the Gemini CLI depend on the type of account you use to authenticate with Google.</p>
<p>This article outlines the specific terms and privacy policies applicable for different account types and authentication methods. Note: See <a href="./quota-and-pricing.md">quotas and pricing</a> for the quota and pricing details that apply to your usage of the Gemini CLI.</p>
<h2 id="how-to-determine-your-authentication-method">How to determine your authentication method</h2>
<p>Your authentication method refers to the method you use to log into and access the Gemini CLI. There are four ways to authenticate:</p>
<ul>
<li>Logging in with your Google account to Gemini Code Assist for Individuals</li>
<li>Logging in with your Google account to Gemini Code Assist for Workspace, Standard, or Enterprise Users</li>
<li>Using an API key with Gemini Developer</li>
<li>Using an API key with Vertex AI GenAI API</li>
</ul>
<p>For each of these four methods of authentication, different Terms of Service and Privacy Notices may apply.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Authentication</th>
<th style="text-align: left;">Account</th>
<th style="text-align: left;">Terms of Service</th>
<th style="text-align: left;">Privacy Notice</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Gemini Code Assist via Google</td>
<td style="text-align: left;">Individual</td>
<td style="text-align: left;"><a href="https://policies.google.com/terms?hl=en-US">Google Terms of Service</a></td>
<td style="text-align: left;"><a href="https://developers.google.com/gemini-code-assist/resources/privacy-notice-gemini-code-assist-individuals">Gemini Code Assist Privacy Notice for Individuals</a></td>
</tr>
<tr>
<td style="text-align: left;">Gemini Code Assist via Google</td>
<td style="text-align: left;">Standard/Enterprise</td>
<td style="text-align: left;"><a href="https://cloud.google.com/terms">Google Cloud Platform Terms of Service</a></td>
<td style="text-align: left;"><a href="https://cloud.google.com/gemini/docs/codeassist/security-privacy-compliance#standard_and_enterprise_data_protection_and_privacy">Gemini Code Assist Privacy Notice for Standard and Enterprise</a></td>
</tr>
<tr>
<td style="text-align: left;">Gemini Developer API</td>
<td style="text-align: left;">Unpaid</td>
<td style="text-align: left;"><a href="https://ai.google.dev/gemini-api/terms#unpaid-services">Gemini API Terms of Service - Unpaid Services</a></td>
<td style="text-align: left;"><a href="https://policies.google.com/privacy">Google Privacy Policy</a></td>
</tr>
<tr>
<td style="text-align: left;">Gemini Developer API</td>
<td style="text-align: left;">Paid</td>
<td style="text-align: left;"><a href="https://ai.google.dev/gemini-api/terms#paid-services">Gemini API Terms of Service - Paid Services</a></td>
<td style="text-align: left;"><a href="https://policies.google.com/privacy">Google Privacy Policy</a></td>
</tr>
<tr>
<td style="text-align: left;">Vertex AI Gen API</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"><a href="https://cloud.google.com/terms/service-terms/">Google Cloud Platform Service Terms</a></td>
<td style="text-align: left;"><a href="https://cloud.google.com/terms/cloud-privacy-notice">Google Cloud Privacy Notice</a></td>
</tr>
</tbody>
</table>
<h2 id="1-if-you-have-logged-in-with-your-google-account-to-gemini-code-assist-for-individuals">1. If you have logged in with your Google account to Gemini Code Assist for Individuals</h2>
<p>For users who use their Google account to access <a href="https://developers.google.com/gemini-code-assist/docs/overview#supported-features-gca">Gemini Code Assist for Individuals</a>, these Terms of Service and Privacy Notice documents apply:</p>
<ul>
<li><strong>Terms of Service:</strong> Your use of the Gemini CLI is governed by the <a href="https://policies.google.com/terms?hl=en-US">Google Terms of Service</a>.</li>
<li><strong>Privacy Notice:</strong> The collection and use of your data is described in the <a href="https://developers.google.com/gemini-code-assist/resources/privacy-notice-gemini-code-assist-individuals">Gemini Code Assist Privacy Notice for Individuals</a>.</li>
</ul>
<h2 id="2-if-you-have-logged-in-with-your-google-account-to-gemini-code-assist-for-workspace-standard-or-enterprise-users">2. If you have logged in with your Google account to Gemini Code Assist for Workspace, Standard, or Enterprise Users</h2>
<p>For users who use their Google account to access the <a href="https://cloud.google.com/gemini/docs/codeassist/overview#editions-overview">Standard or Enterprise edition</a> of Gemini Code Assist, these Terms of Service and Privacy Notice documents apply:</p>
<ul>
<li><strong>Terms of Service:</strong> Your use of the Gemini CLI is governed by the <a href="https://cloud.google.com/terms">Google Cloud Platform Terms of Service</a>.</li>
<li><strong>Privacy Notice:</strong> The collection and use of your data is described in the <a href="https://cloud.google.com/gemini/docs/codeassist/security-privacy-compliance#standard_and_enterprise_data_protection_and_privacy">Gemini Code Assist Privacy Notices for Standard and Enterprise Users</a>.</li>
</ul>
<h2 id="3-if-you-have-logged-in-with-a-gemini-api-key-to-the-gemini-developer-api">3. If you have logged in with a Gemini API key to the Gemini Developer API</h2>
<p>If you are using a Gemini API key for authentication with the <a href="https://ai.google.dev/gemini-api/docs">Gemini Developer API</a>, these Terms of Service and Privacy Notice documents apply:</p>
<ul>
<li><strong>Terms of Service:</strong> Your use of the Gemini CLI is governed by the <a href="https://ai.google.dev/gemini-api/terms">Gemini API Terms of Service</a>. These terms may differ depending on whether you are using an unpaid or paid service:</li>
<li>For unpaid services, refer to the <a href="https://ai.google.dev/gemini-api/terms#unpaid-services">Gemini API Terms of Service - Unpaid Services</a>.</li>
<li>For paid services, refer to the <a href="https://ai.google.dev/gemini-api/terms#paid-services">Gemini API Terms of Service - Paid Services</a>.</li>
<li><strong>Privacy Notice:</strong> The collection and use of your data is described in the <a href="https://policies.google.com/privacy">Google Privacy Policy</a>.</li>
</ul>
<h2 id="4-if-you-have-logged-in-with-a-gemini-api-key-to-the-vertex-ai-genai-api">4. If you have logged in with a Gemini API key to the Vertex AI GenAI API</h2>
<p>If you are using a Gemini API key for authentication with a <a href="https://cloud.google.com/vertex-ai/generative-ai/docs/reference/rest">Vertex AI GenAI API</a> backend, these Terms of Service and Privacy Notice documents apply:</p>
<ul>
<li><strong>Terms of Service:</strong> Your use of the Gemini CLI is governed by the <a href="https://cloud.google.com/terms/service-terms/">Google Cloud Platform Service Terms</a>.</li>
<li><strong>Privacy Notice:</strong> The collection and use of your data is described in the <a href="https://cloud.google.com/terms/cloud-privacy-notice">Google Cloud Privacy Notice</a>.</li>
</ul>
<h3 id="usage-statistics-opt-out">Usage Statistics Opt-Out</h3>
<p>You may opt-out from sending Usage Statistics to Google by following the instructions available here: <a href="./cli/configuration.md#usage-statistics">Usage Statistics Configuration</a>.</p>
<h2 id="frequently-asked-questions-faq-for-the-gemini-cli">Frequently Asked Questions (FAQ) for the Gemini CLI</h2>
<h3 id="1-is-my-code-including-prompts-and-answers-used-to-train-googles-models">1. Is my code, including prompts and answers, used to train Google's models?</h3>
<p>Whether your code, including prompts and answers, is used to train Google's models depends on the type of authentication method you use and your account type.</p>
<p>By default (if you have not opted out):</p>
<ul>
<li><strong>Google account with Gemini Code Assist for Individuals</strong>: Yes. When you use your personal Google account, the <a href="https://developers.google.com/gemini-code-assist/resources/privacy-notice-gemini-code-assist-individuals">Gemini Code Assist Privacy Notice for Individuals</a> applies. Under this notice,
  your <strong>prompts, answers, and related code are collected</strong> and may be used to improve Google's products, including for model training.</li>
<li><strong>Google account with Gemini Code Assist for Workspace, Standard, or Enterprise</strong>: No. For these accounts, your data is governed by the <a href="https://cloud.google.com/gemini/docs/codeassist/security-privacy-compliance#standard_and_enterprise_data_protection_and_privacy">Gemini Code Assist Privacy Notices</a> terms, which treat your inputs as confidential. Your <strong>prompts, answers, and related code are not collected</strong> and are not used to train models.</li>
<li><strong>Gemini API key via the Gemini Developer API</strong>: Whether your code is collected or used depends on whether you are using an unpaid or paid service.</li>
<li><strong>Unpaid services</strong>: Yes. When you use the Gemini API key via the Gemini Developer API with an unpaid service, the <a href="https://ai.google.dev/gemini-api/terms#unpaid-services">Gemini API Terms of Service - Unpaid Services</a> terms apply. Under this notice, your <strong>prompts, answers, and related code are collected</strong> and may be used to improve Google's products, including for model training.</li>
<li><strong>Paid services</strong>: No. When you use the Gemini API key via the Gemini Developer API with a paid service, the <a href="https://ai.google.dev/gemini-api/terms#paid-services">Gemini API Terms of Service - Paid Services</a> terms apply, which treats your inputs as confidential. Your <strong>prompts, answers, and related code are not collected</strong> and are not used to train models.</li>
<li><strong>Gemini API key via the Vertex AI GenAI API</strong>: No. For these accounts, your data is governed by the <a href="https://cloud.google.com/terms/cloud-privacy-notice">Google Cloud Privacy Notice</a> terms, which treat your inputs as confidential. Your <strong>prompts, answers, and related code are not collected</strong> and are not used to train models.</li>
</ul>
<p>For more information about opting out, refer to the next question.</p>
<h3 id="2-what-are-usage-statistics-and-what-does-the-opt-out-control">2. What are Usage Statistics and what does the opt-out control?</h3>
<p>The <strong>Usage Statistics</strong> setting is the single control for all optional data collection in the Gemini CLI.</p>
<p>The data it collects depends on your account and authentication type:</p>
<ul>
<li><strong>Google account with Gemini Code Assist for Individuals</strong>: When enabled, this setting allows Google to collect both anonymous telemetry (for example, commands run and performance metrics) and <strong>your prompts and answers, including code,</strong> for model improvement.</li>
<li><strong>Google account with Gemini Code Assist for Workspace, Standard, or Enterprise</strong>: This setting only controls the collection of anonymous telemetry. Your prompts and answers, including code, are never collected, regardless of this setting.</li>
<li><strong>Gemini API key via the Gemini Developer API</strong>:
  <strong>Unpaid services</strong>: When enabled, this setting allows Google to collect both anonymous telemetry (like commands run and performance metrics) and <strong>your prompts and answers, including code,</strong> for model improvement. When disabled we will use your data as described in <a href="https://ai.google.dev/gemini-api/terms#data-use-unpaid">How Google Uses Your Data</a>.
  <strong>Paid services</strong>: This setting only controls the collection of anonymous telemetry. Google logs prompts and responses for a limited period of time, solely for the purpose of detecting violations of the Prohibited Use Policy and any required legal or regulatory disclosures.</li>
<li><strong>Gemini API key via the Vertex AI GenAI API:</strong> This setting only controls the collection of anonymous telemetry. Your prompts and answers, including code, are never collected, regardless of this setting.</li>
</ul>
<p>Please refer to the Privacy Notice that applies to your authentication method for more information about what data is collected and how this data is used.</p>
<p>You can disable Usage Statistics for any account type by following the instructions in the <a href="./cli/configuration.md#usage-statistics">Usage Statistics Configuration</a> documentation.</p>
<p>‚îú‚îÄ‚îÄ troubleshooting.md
  Content:</p>
<h1 id="troubleshooting-guide">Troubleshooting guide</h1>
<p>This guide provides solutions to common issues and debugging tips, including topics on:</p>
<ul>
<li>Authentication or login errors</li>
<li>Frequently asked questions (FAQs)</li>
<li>Debugging tips</li>
<li>Existing GitHub Issues similar to yours or creating new Issues</li>
</ul>
<h2 id="authentication-or-login-errors">Authentication or login errors</h2>
<ul>
<li><strong>Error: <code>Failed to login. Message: Request contains an invalid argument</code></strong></li>
<li>Users with Google Workspace accounts or Google Cloud accounts
    associated with their Gmail accounts may not be able to activate the free
    tier of the Google Code Assist plan.</li>
<li>For Google Cloud accounts, you can work around this by setting
    <code>GOOGLE_CLOUD_PROJECT</code> to your project ID.</li>
<li>Alternatively, you can obtain the Gemini API key from
    <a href="http://aistudio.google.com/app/apikey">Google AI Studio</a>, which also includes a
    separate free tier.</li>
</ul>
<h2 id="frequently-asked-questions-faqs">Frequently asked questions (FAQs)</h2>
<ul>
<li><strong>Q: How do I update Gemini CLI to the latest version?</strong></li>
<li>
<p>A: If you installed it globally via <code>npm</code>, update it using the command <code>npm install -g @google/gemini-cli@latest</code>. If you compiled it from source, pull the latest changes from the repository, and then rebuild using the command <code>npm run build</code>.</p>
</li>
<li>
<p><strong>Q: Where are the Gemini CLI configuration or settings files stored?</strong></p>
</li>
<li>
<p>A: The Gemini CLI configuration is stored in two <code>settings.json</code> files:</p>
<ol>
<li>In your home directory: <code>~/.gemini/settings.json</code>.</li>
<li>In your project's root directory: <code>./.gemini/settings.json</code>.</li>
</ol>
<p>Refer to <a href="./cli/configuration.md">Gemini CLI Configuration</a> for more details.</p>
</li>
<li>
<p><strong>Q: Why don't I see cached token counts in my stats output?</strong></p>
</li>
<li>A: Cached token information is only displayed when cached tokens are being used. This feature is available for API key users (Gemini API key or Google Cloud Vertex AI) but not for OAuth users (such as Google Personal/Enterprise accounts like Google Gmail or Google Workspace, respectively). This is because the Gemini Code Assist API does not support cached content creation. You can still view your total token usage using the <code>/stats</code> command in Gemini CLI.</li>
</ul>
<h2 id="common-error-messages-and-solutions">Common error messages and solutions</h2>
<ul>
<li><strong>Error: <code>EADDRINUSE</code> (Address already in use) when starting an MCP server.</strong></li>
<li><strong>Cause:</strong> Another process is already using the port that the MCP server is trying to bind to.</li>
<li>
<p><strong>Solution:</strong>
    Either stop the other process that is using the port or configure the MCP server to use a different port.</p>
</li>
<li>
<p><strong>Error: Command not found (when attempting to run Gemini CLI with <code>gemini</code>).</strong></p>
</li>
<li><strong>Cause:</strong> Gemini CLI is not correctly installed or it is not in your system's <code>PATH</code>.</li>
<li>
<p><strong>Solution:</strong>
    The update depends on how you installed Gemini CLI:</p>
<ul>
<li>If you installed <code>gemini</code> globally, check that your <code>npm</code> global binary directory is in your <code>PATH</code>. You can update Gemini CLI using the command <code>npm install -g @google/gemini-cli@latest</code>.</li>
<li>If you are running <code>gemini</code> from source, ensure you are using the correct command to invoke it (e.g., <code>node packages/cli/dist/index.js ...</code>). To update Gemini CLI, pull the latest changes from the repository, and then rebuild using the command <code>npm run build</code>.</li>
</ul>
</li>
<li>
<p><strong>Error: <code>MODULE_NOT_FOUND</code> or import errors.</strong></p>
</li>
<li><strong>Cause:</strong> Dependencies are not installed correctly, or the project hasn't been built.</li>
<li>
<p><strong>Solution:</strong></p>
<ol>
<li>Run <code>npm install</code> to ensure all dependencies are present.</li>
<li>Run <code>npm run build</code> to compile the project.</li>
<li>Verify that the build completed successfully with <code>npm run start</code>.</li>
</ol>
</li>
<li>
<p><strong>Error: "Operation not permitted", "Permission denied", or similar.</strong></p>
</li>
<li><strong>Cause:</strong> When sandboxing is enabled, Gemini CLI may attempt operations that are restricted by your sandbox configuration, such as writing outside the project directory or system temp directory.</li>
<li>
<p><strong>Solution:</strong> Refer to the <a href="./cli/configuration.md#sandboxing">Configuration: Sandboxing</a> documentation for more information, including how to customize your sandbox configuration.</p>
</li>
<li>
<p><strong>Gemini CLI is not running in interactive mode in "CI" environments</strong></p>
</li>
<li><strong>Issue:</strong> The Gemini CLI does not enter interactive mode (no prompt appears) if an environment variable starting with <code>CI_</code> (e.g., <code>CI_TOKEN</code>) is set. This is because the <code>is-in-ci</code> package, used by the underlying UI framework, detects these variables and assumes a non-interactive CI environment.</li>
<li><strong>Cause:</strong> The <code>is-in-ci</code> package checks for the presence of <code>CI</code>, <code>CONTINUOUS_INTEGRATION</code>, or any environment variable with a <code>CI_</code> prefix. When any of these are found, it signals that the environment is non-interactive, which prevents the Gemini CLI from starting in its interactive mode.</li>
<li>
<p><strong>Solution:</strong> If the <code>CI_</code> prefixed variable is not needed for the CLI to function, you can temporarily unset it for the command. e.g., <code>env -u CI_TOKEN gemini</code></p>
</li>
<li>
<p><strong>DEBUG mode not working from project .env file</strong></p>
</li>
<li><strong>Issue:</strong> Setting <code>DEBUG=true</code> in a project's <code>.env</code> file doesn't enable debug mode for gemini-cli.</li>
<li><strong>Cause:</strong> The <code>DEBUG</code> and <code>DEBUG_MODE</code> variables are automatically excluded from project <code>.env</code> files to prevent interference with gemini-cli behavior.</li>
<li><strong>Solution:</strong> Use a <code>.gemini/.env</code> file instead, or configure the <code>excludedProjectEnvVars</code> setting in your <code>settings.json</code> to exclude fewer variables.</li>
</ul>
<h2 id="debugging-tips_1">Debugging Tips</h2>
<ul>
<li><strong>CLI debugging:</strong></li>
<li>Use the <code>--verbose</code> flag (if available) with CLI commands for more detailed output.</li>
<li>
<p>Check the CLI logs, often found in a user-specific configuration or cache directory.</p>
</li>
<li>
<p><strong>Core debugging:</strong></p>
</li>
<li>Check the server console output for error messages or stack traces.</li>
<li>Increase log verbosity if configurable.</li>
<li>
<p>Use Node.js debugging tools (e.g., <code>node --inspect</code>) if you need to step through server-side code.</p>
</li>
<li>
<p><strong>Tool issues:</strong></p>
</li>
<li>If a specific tool is failing, try to isolate the issue by running the simplest possible version of the command or operation the tool performs.</li>
<li>For <code>run_shell_command</code>, check that the command works directly in your shell first.</li>
<li>
<p>For <em>file system tools</em>, verify that paths are correct and check the permissions.</p>
</li>
<li>
<p><strong>Pre-flight checks:</strong></p>
</li>
<li>Always run <code>npm run preflight</code> before committing code. This can catch many common issues related to formatting, linting, and type errors.</li>
</ul>
<h2 id="existing-github-issues-similar-to-yours-or-creating-new-issues">Existing GitHub Issues similar to yours or creating new Issues</h2>
<p>If you encounter an issue that was not covered here in this <em>Troubleshooting guide</em>, consider searching the Gemini CLI <a href="https://github.com/google-gemini/gemini-cli/issues">Issue tracker on GitHub</a>. If you can't find an issue similar to yours, consider creating a new GitHub Issue with a detailed description. Pull requests are also welcome!</p>
        </div>
        <div class="footer">
            Generated on 2025-08-30 07:50:53
        </div>
    </div>
</body>
</html>